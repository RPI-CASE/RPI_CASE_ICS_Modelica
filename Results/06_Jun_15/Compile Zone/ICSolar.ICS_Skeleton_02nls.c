/* Non Linear Systems */
/* Simulation code for ICSolar.ICS_Skeleton generated by the OpenModelica Compiler 1.9.1 Beta4 (r22666) (RML version). */

#include "openmodelica.h"
#include "openmodelica_func.h"
#include "simulation_data.h"
#include "simulation/simulation_info_xml.h"
#include "simulation/simulation_runtime.h"
#include "util/omc_error.h"
#include "simulation/solver/model_help.h"
#include "simulation/solver/delay.h"
#include "simulation/solver/linearSystem.h"
#include "simulation/solver/nonlinearSystem.h"
#include "simulation/solver/mixedSystem.h"

#include <assert.h>
#include <string.h>

#include "ICSolar.ICS_Skeleton_functions.h"
#include "ICSolar.ICS_Skeleton_model.h"
#include "ICSolar.ICS_Skeleton_literals.h"




#if defined(HPCOM) && !defined(_OPENMP)
  #error "HPCOM requires OpenMP or the results are wrong"
#endif
#if defined(_OPENMP)
  #include <omp.h>
#else
  /* dummy omp defines */
  #define omp_get_max_threads() 1
#endif

#define threadData data->threadData

/* dummy REAL_ATTRIBUTE */
const REAL_ATTRIBUTE dummyREAL_ATTRIBUTE = omc_dummyRealAttribute;
#include "ICSolar.ICS_Skeleton_12jac.h"
#if defined(__cplusplus)
extern "C" {
#endif

/*
 equation index: 2138
 type: SIMPLE_ASSIGN
 ics_context1._weaDat._tWetBul_TDryBulXi._XiSat = DIVISION(0.621964713077499, -0.378035286922501 + 0.001634903221903779 * ics_context1.weaDat.pAtm * exp(-17.2799 - DIVISION(-4102.99, -35.719 + ics_context1.weatherBus.TWetBul)))
 */
void ICSolar_ICS_Skeleton_eqFunction_2138(DATA *data)
{
  const int equationIndexes[2] = {1,2138};
  TRACE_PUSH
  $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat = DIVISION_SIM(0.621964713077499,(-0.378035286922501 + (0.001634903221903779 * ($Pics_context1$PweaDat$PpAtm * exp((-17.2799 - DIVISION_SIM(-4102.99,(-35.719 + $Pics_context1$PweatherBus$PTWetBul),"-35.719 + ics_context1.weatherBus.TWetBul",equationIndexes)))))),"-0.378035286922501 + 0.001634903221903779 * ics_context1.weaDat.pAtm * exp(-17.2799 - DIVISION(-4102.99, -35.719 + ics_context1.weatherBus.TWetBul))",equationIndexes);
  TRACE_POP
}
void initializeStaticNLSData2140(void *inData, void *inNlsData)
{
  DATA* data = (DATA*) inData;
  NONLINEAR_SYSTEM_DATA* nlsData = (NONLINEAR_SYSTEM_DATA*) inNlsData;
  int i=0;
  /* static nls data for $Pics_context1$PweatherBus$PTWetBul */
  nlsData->nominal[i] = $P$ATTRIBUTE$Pics_context1$PweatherBus$PTWetBul.nominal;
  nlsData->min[i]     = $P$ATTRIBUTE$Pics_context1$PweatherBus$PTWetBul.min;
  nlsData->max[i++]   = $P$ATTRIBUTE$Pics_context1$PweatherBus$PTWetBul.max;
}

void residualFunc2140(void* dataIn, const double* xloc, double* res, const int* iflag)
{
  DATA* data = (DATA*) dataIn;
  const int equationIndexes[2] = {1,2140};
  $Pics_context1$PweatherBus$PTWetBul = xloc[0];
  ICSolar_ICS_Skeleton_eqFunction_2138(data);
  res[0] = (($Pics_context1$PweatherBus$PTWetBul * ((1006.0 * (1.0 - $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat)) + (1860.0 * $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat))) + ((-2501014.5 * ($Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiDryBul - $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat)) - ($Pics_context1$PTOutside$PT * ((1006.0 * (1.0 - $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiDryBul)) + (1860.0 * $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiDryBul)))));
}

/*
 equation index: 5323
 type: SIMPLE_ASSIGN
 ics_context1._weaDat._tWetBul_TDryBulXi._XiSat = DIVISION(0.621964713077499, -0.378035286922501 + 0.001634903221903779 * ics_context1.weaDat.pAtm * exp(-17.2799 - DIVISION(-4102.99, -35.719 + ics_context1.weatherBus.TWetBul)))
 */
void ICSolar_ICS_Skeleton_eqFunction_5323(DATA *data)
{
  const int equationIndexes[2] = {1,5323};
  TRACE_PUSH
  $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat = DIVISION_SIM(0.621964713077499,(-0.378035286922501 + (0.001634903221903779 * ($Pics_context1$PweaDat$PpAtm * exp((-17.2799 - DIVISION_SIM(-4102.99,(-35.719 + $Pics_context1$PweatherBus$PTWetBul),"-35.719 + ics_context1.weatherBus.TWetBul",equationIndexes)))))),"-0.378035286922501 + 0.001634903221903779 * ics_context1.weaDat.pAtm * exp(-17.2799 - DIVISION(-4102.99, -35.719 + ics_context1.weatherBus.TWetBul))",equationIndexes);
  TRACE_POP
}
void initializeStaticNLSData5325(void *inData, void *inNlsData)
{
  DATA* data = (DATA*) inData;
  NONLINEAR_SYSTEM_DATA* nlsData = (NONLINEAR_SYSTEM_DATA*) inNlsData;
  int i=0;
  /* static nls data for $Pics_context1$PweatherBus$PTWetBul */
  nlsData->nominal[i] = $P$ATTRIBUTE$Pics_context1$PweatherBus$PTWetBul.nominal;
  nlsData->min[i]     = $P$ATTRIBUTE$Pics_context1$PweatherBus$PTWetBul.min;
  nlsData->max[i++]   = $P$ATTRIBUTE$Pics_context1$PweatherBus$PTWetBul.max;
}

void residualFunc5325(void* dataIn, const double* xloc, double* res, const int* iflag)
{
  DATA* data = (DATA*) dataIn;
  const int equationIndexes[2] = {1,5325};
  $Pics_context1$PweatherBus$PTWetBul = xloc[0];
  ICSolar_ICS_Skeleton_eqFunction_5323(data);
  res[0] = (($Pics_context1$PweatherBus$PTWetBul * ((1006.0 * (1.0 - $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat)) + (1860.0 * $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat))) + ((-2501014.5 * ($Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiDryBul - $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat)) - ($Pics_context1$PTOutside$PT * ((1006.0 * (1.0 - $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiDryBul)) + (1860.0 * $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiDryBul)))));
}

/* funtion initialize non-linear systems */
void ICSolar_ICS_Skeleton_initialNonLinearSystem(int nNonLinearSystems, NONLINEAR_SYSTEM_DATA* nonLinearSystemData)
{
  assertStreamPrint(NULL, nNonLinearSystems > 0, "Internal Error: nNonLinearSystems mismatch!");
  nonLinearSystemData[0].equationIndex = 2140;
  nonLinearSystemData[0].size = 1;
  nonLinearSystemData[0].method = 0;
  nonLinearSystemData[0].residualFunc = residualFunc2140;
  nonLinearSystemData[0].analyticalJacobianColumn = NULL;
  nonLinearSystemData[0].initialAnalyticalJacobian = NULL;
  nonLinearSystemData[0].jacobianIndex = -1;
  nonLinearSystemData[0].initializeStaticNLSData = initializeStaticNLSData2140;
  assertStreamPrint(NULL, nNonLinearSystems > 1, "Internal Error: nNonLinearSystems mismatch!");
  nonLinearSystemData[1].equationIndex = 5325;
  nonLinearSystemData[1].size = 1;
  nonLinearSystemData[1].method = 0;
  nonLinearSystemData[1].residualFunc = residualFunc5325;
  nonLinearSystemData[1].analyticalJacobianColumn = NULL;
  nonLinearSystemData[1].initialAnalyticalJacobian = NULL;
  nonLinearSystemData[1].jacobianIndex = -1;
  nonLinearSystemData[1].initializeStaticNLSData = initializeStaticNLSData5325;
}

#if defined(__cplusplus)
}
#endif

