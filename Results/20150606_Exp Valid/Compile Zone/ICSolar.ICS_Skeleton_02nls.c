/* Non Linear Systems */
/* Simulation code for ICSolar.ICS_Skeleton generated by the OpenModelica Compiler 1.9.1 Beta2 (r19512) (RML version). */

#include "openmodelica.h"
#include "openmodelica_func.h"
#include "simulation_data.h"
#include "simulation/simulation_info_xml.h"
#include "simulation/simulation_runtime.h"
#include "util/omc_error.h"
#include "simulation/solver/model_help.h"
#include "simulation/solver/delay.h"
#include "simulation/solver/linearSystem.h"
#include "simulation/solver/nonlinearSystem.h"
#include "simulation/solver/mixedSystem.h"

#include <assert.h>
#include <string.h>

#include "ICSolar.ICS_Skeleton_functions.h"
#include "ICSolar.ICS_Skeleton_model.h"
#include "ICSolar.ICS_Skeleton_literals.h"



#if defined(HPCOM) && !defined(_OPENMP)
  #error "HPCOM requires OpenMP or the results are wrong"
#endif
#if defined(_OPENMP)
  #include <omp.h>
#else
  /* dummy omp defines */
  #define omp_get_max_threads() 1
#endif

#define threadData data->threadData

/* dummy REAL_ATTRIBUTE */
const REAL_ATTRIBUTE dummyREAL_ATTRIBUTE = omc_dummyRealAttribute;
#include "ICSolar.ICS_Skeleton_12jac.h"
void initializeStaticNLSData1867(void *inData, void *inNlsData)
{
  DATA* data = (DATA*) inData;
  NONLINEAR_SYSTEM_DATA* nlsData = (NONLINEAR_SYSTEM_DATA*) inNlsData;
  int i=0;
  /* static nls data for $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat */
  nlsData->nominal[i] = $P$ATTRIBUTE$Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat.nominal;
  nlsData->min[i]     = $P$ATTRIBUTE$Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat.min;
  nlsData->max[i++]   = $P$ATTRIBUTE$Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat.max;
  /* static nls data for $Pics_context1$PweatherBus$PTWetBul */
  nlsData->nominal[i] = $P$ATTRIBUTE$Pics_context1$PweatherBus$PTWetBul.nominal;
  nlsData->min[i]     = $P$ATTRIBUTE$Pics_context1$PweatherBus$PTWetBul.min;
  nlsData->max[i++]   = $P$ATTRIBUTE$Pics_context1$PweatherBus$PTWetBul.max;
}

void residualFunc1867(void* dataIn, double* xloc, double* res, integer* iflag)
{
  DATA* data = (DATA*) dataIn;
  const int equationIndexes[2] = {1,1867};
  modelica_real tmp3439;
  #ifdef _OMC_MEASURE_TIME
  SIM_PROF_ADD_NCALL_EQ(modelInfoXmlGetEquation(&data->modelData.modelDataXml,1867).profileBlockIndex,1);
  #endif
  $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat = xloc[0];
  $Pics_context1$PweatherBus$PTWetBul = xloc[1];
  res[0] = (($Pics_context1$PweatherBus$PTWetBul * ((1006.0 * (1.0 - $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat)) + (1860.0 * $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat))) + (((-$Pics_context1$PTOutside$PT) * ((1006.0 * (1.0 - $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiDryBul)) + (1860.0 * $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiDryBul))) + (-2501014.5 * ($Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiDryBul - $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat))));
  tmp3439 = exp((17.2799 + DIVISION_SIM(-4102.99,(-35.719 + $Pics_context1$PweatherBus$PTWetBul),"-35.719 + ics_context1.weatherBus.TWetBul",equationIndexes)));
  res[1] = (-0.621964713077499 + ($Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat * (-0.378035286922501 + DIVISION_SIM($Pics_context1$PweaDat$PpAtm,(tmp3439 * 611.657),"exp(17.2799 + DIVISION(-4102.99, -35.719 + ics_context1.weatherBus.TWetBul)) * 611.657",equationIndexes))));
}
void initializeStaticNLSData4572(void *inData, void *inNlsData)
{
  DATA* data = (DATA*) inData;
  NONLINEAR_SYSTEM_DATA* nlsData = (NONLINEAR_SYSTEM_DATA*) inNlsData;
  int i=0;
  /* static nls data for $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat */
  nlsData->nominal[i] = $P$ATTRIBUTE$Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat.nominal;
  nlsData->min[i]     = $P$ATTRIBUTE$Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat.min;
  nlsData->max[i++]   = $P$ATTRIBUTE$Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat.max;
  /* static nls data for $Pics_context1$PweatherBus$PTWetBul */
  nlsData->nominal[i] = $P$ATTRIBUTE$Pics_context1$PweatherBus$PTWetBul.nominal;
  nlsData->min[i]     = $P$ATTRIBUTE$Pics_context1$PweatherBus$PTWetBul.min;
  nlsData->max[i++]   = $P$ATTRIBUTE$Pics_context1$PweatherBus$PTWetBul.max;
}

void residualFunc4572(void* dataIn, double* xloc, double* res, integer* iflag)
{
  DATA* data = (DATA*) dataIn;
  const int equationIndexes[2] = {1,4572};
  modelica_real tmp3440;
  #ifdef _OMC_MEASURE_TIME
  SIM_PROF_ADD_NCALL_EQ(modelInfoXmlGetEquation(&data->modelData.modelDataXml,4572).profileBlockIndex,1);
  #endif
  $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat = xloc[0];
  $Pics_context1$PweatherBus$PTWetBul = xloc[1];
  res[0] = (($Pics_context1$PweatherBus$PTWetBul * ((1006.0 * (1.0 - $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat)) + (1860.0 * $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat))) + (((-$Pics_context1$PTOutside$PT) * ((1006.0 * (1.0 - $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiDryBul)) + (1860.0 * $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiDryBul))) + (-2501014.5 * ($Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiDryBul - $Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat))));
  tmp3440 = exp((17.2799 + DIVISION_SIM(-4102.99,(-35.719 + $Pics_context1$PweatherBus$PTWetBul),"-35.719 + ics_context1.weatherBus.TWetBul",equationIndexes)));
  res[1] = (-0.621964713077499 + ($Pics_context1$PweaDat$PtWetBul_TDryBulXi$PXiSat * (-0.378035286922501 + DIVISION_SIM($Pics_context1$PweaDat$PpAtm,(tmp3440 * 611.657),"exp(17.2799 + DIVISION(-4102.99, -35.719 + ics_context1.weatherBus.TWetBul)) * 611.657",equationIndexes))));
}

/* funtion initialize non-linear systems */
void ICSolar_ICS_Skeleton_initialNonLinearSystem(NONLINEAR_SYSTEM_DATA* nonLinearSystemData)
{
  nonLinearSystemData[0].equationIndex = 1867;
  nonLinearSystemData[0].size = 2;
  nonLinearSystemData[0].method = 0;
  nonLinearSystemData[0].residualFunc = residualFunc1867;
  nonLinearSystemData[0].analyticalJacobianColumn = NULL;
  nonLinearSystemData[0].initialAnalyticalJacobian = NULL;
  nonLinearSystemData[0].jacobianIndex = -1;
  nonLinearSystemData[0].initializeStaticNLSData = initializeStaticNLSData1867;
  
  nonLinearSystemData[1].equationIndex = 4572;
  nonLinearSystemData[1].size = 2;
  nonLinearSystemData[1].method = 0;
  nonLinearSystemData[1].residualFunc = residualFunc4572;
  nonLinearSystemData[1].analyticalJacobianColumn = NULL;
  nonLinearSystemData[1].initialAnalyticalJacobian = NULL;
  nonLinearSystemData[1].jacobianIndex = -1;
  nonLinearSystemData[1].initializeStaticNLSData = initializeStaticNLSData4572;
  
}


