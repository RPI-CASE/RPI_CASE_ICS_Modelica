package ICSolar "Integrated Concentrating Solar simulation, packaged for hierarchy construction"
  extends Modelica.Icons.Package;

  model ICS_Skeleton "This model calculates the electrical and thermal generation of ICSolar. This model is used as a skeleton piece to hold together the other models until it is packages as an FMU."
    extends ICSolar.Parameters;
    //extends ICSolar.measured_data;
    /////////////////////
    /// Measured Data ///
    /////////////////////
    Modelica.Blocks.Sources.CombiTimeTable IC_Data_all(tableOnFile = true, fileName = Path + "20150323\\ICSFdata.txt", tableName = "DNI_THTFin_vdot", nout = 3, columns = {2, 3, 4}) annotation(Placement(visible = true, transformation(origin = {-80, 0}, extent = {{-15, -15}, {15, 15}}, rotation = 0)));
    Real measured_DNI = IC_Data_all.y[1];
    Real measured_T_HTFin = IC_Data_all.y[2];
    Real measured_vFlow = IC_Data_all.y[3];
    Modelica.Blocks.Sources.CombiTimeTable measured_T_cav_in(tableOnFile = true, fileName = Path + "20150323\\T_Cav_data.txt", tableName = "T_Cav");
    Real measured_T_amb = measured_T_cav_in.y[1];
    ////////////////////////////
    ///  Energy /Exergy Var. ///
    ////////////////////////////
    Real temp_flowport_a = ics_envelopecassette1.flowport_a.H_flow / (0.00137691 * 4177);
    Real temp_flowport_b = abs(ics_envelopecassette1.flowport_b.H_flow / (0.00137691 * 4177));
    Real Q_arrayTotal = abs(ics_envelopecassette1.flowport_b.H_flow) - ics_envelopecassette1.flowport_a.H_flow;
    Real E_arrayTotal = ics_envelopecassette1.Power_Electric;
    // Area of modules is assumed to be 0.3^2
    Real eta_Q = Q_arrayTotal / (measured_DNI * GlassArea);
    Real eta_E = ics_envelopecassette1.Power_Electric / (measured_DNI * GlassArea);
    // m_dot*cp*(1 - Tamb/T2)
    Real Ex_carnot_arrayTotal = Q_arrayTotal * (1 - TAmb / temp_flowport_b);
    // m_dot*cp*(T2 - T1 - Tamb*ln(T2/T1))
    // note log in OMedit is the natural log.  Log is log10 in OM
    Real Ex_arrayTotal = 0.00137691 * 4177 * (temp_flowport_b - temp_flowport_a - TAmb * log(temp_flowport_b / temp_flowport_a)) + ics_envelopecassette1.Power_Electric;
    //epsilon = the Exergenic efficiency (~93% for sunlight)
    Real Ex_epsilon = Ex_arrayTotal / (measured_DNI * GlassArea * 0.93);
    ////////////////////////
    /// Init. Components ///
    ////////////////////////
    // IC Comp.
    ICSolar.ICS_Context ics_context1(SurfOrientation = 40 * 2 * Modelica.Constants.pi / 360) annotation(Placement(visible = true, transformation(origin = {-180, 40}, extent = {{-25, -25}, {25, 25}}, rotation = 0)));
    ICSolar.Envelope.ICS_EnvelopeCassette_Twelve ics_envelopecassette1 annotation(Placement(visible = true, transformation(origin = {20, 40}, extent = {{-25, -25}, {25, 25}}, rotation = 0)));
    // Fluid Comp.
    Modelica.Thermal.FluidHeatFlow.Sources.Ambient Source(medium = mediumHTF, useTemperatureInput = true, constantAmbientPressure = 101325, constantAmbientTemperature = TAmb) "Thermal fluid source" annotation(Placement(visible = true, transformation(origin = {-60, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 180)));
    Modelica.Thermal.FluidHeatFlow.Sources.VolumeFlow Pump(constantVolumeFlow = OneBranchFlow, m = 0.1, medium = mediumHTF, T0 = TAmb, T0fixed = false, useVolumeFlowInput = true) "Fluid pump for thermal fluid" annotation(Placement(visible = true, transformation(origin = {-20, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    Modelica.Thermal.FluidHeatFlow.Sources.Ambient Sink(medium = mediumHTF, constantAmbientPressure = 101325, constantAmbientTemperature = TAmb) "Thermal fluid sink, will be replaced with a tank later" annotation(Placement(visible = true, transformation(origin = {80, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
  equation
    connect(measured_T_HTFin, Source.ambientTemperature) annotation(Line(points = {{-123.5, -60}, {-87.8769, -60}, {-87.8769, -32.9846}, {-70.1538, -32.9846}, {-70.1538, -32.9846}}, color = {0, 0, 127}));
    connect(measured_vFlow, Pump.volumeFlow) annotation(Line(points = {{-63.5, 0}, {-20.1846, 0}, {-20.1846, -29.5385}, {-20.1846, -29.5385}}, color = {0, 0, 127}));
    connect(Source.flowPort, Pump.flowPort_a) annotation(Line(points = {{-50, -40}, {-37.8122, -39.5049}, {-30, -40}}));
    connect(Pump.flowPort_b, ics_envelopecassette1.flowport_a) annotation(Line(points = {{-10, -40}, {-8.16759, -39.5049}, {-4.3554, 17.6597}, {6.25, 18.75}, {-3.75, 18.75}}));
    connect(ics_envelopecassette1.flowport_b, Sink.flowPort) annotation(Line(points = {{45, 40}, {60.0812, 40}, {60.0812, -20.2977}, {70, -20.2977}, {70, -20}}, color = {255, 0, 0}));
    connect(ics_context1.AOI, ics_envelopecassette1.AOI) annotation(Line(points = {{-155, 30}, {-5, 30}}));
    connect(ics_context1.SunAzi, ics_envelopecassette1.SunAzi) annotation(Line(points = {{-155, 35}, {-5, 35}}));
    connect(ics_context1.SunAlt, ics_envelopecassette1.SunAlt) annotation(Line(points = {{-155, 40}, {-5, 40}}));
    connect(ics_context1.SurfOrientation_out, ics_envelopecassette1.SurfaceOrientation) annotation(Line(points = {{-155, 45}, {-5, 45}}));
    connect(ics_context1.SurfTilt_out, ics_envelopecassette1.SurfaceTilt) annotation(Line(points = {{-155, 50}, {-5, 50}}));
    connect(ics_context1.TDryBul, ics_envelopecassette1.TAmb_in) annotation(Line(points = {{-155, 55}, {-5, 55}}));
    connect(ics_context1.DNI, ics_envelopecassette1.DNI) annotation(Line(points = {{-155, 25}, {-5, 25}}, color = {0, 0, 127}));
    annotation(Diagram(coordinateSystem(preserveAspectRatio = false, extent = {{-200, -100}, {200, 100}}), graphics), experiment(StartTime = 7.137e+06, StopTime = 7.1412e+06, Tolerance = 1e-06, Interval = 10));
  end ICS_Skeleton;

  model ICS_Context "This model provides the pieces necessary to set up the context to run the simulation, in FMU practice this will be cut out and provided from the EnergyPlus file"
    extends ICSolar.Parameters;
    parameter Real Lat = BuildingLatitude "Latitude";
    parameter Real SurfOrientation = BuildingOrientation "Surface orientation: Change 'S' to 'W','E', or 'N' for other orientations";
    parameter Real SurfTilt = ArrayTilt "Tilt of the ICSolar array";
    Buildings.BoundaryConditions.WeatherData.ReaderTMY3 weaDat(filNam = "modelica://ICSolar/weatherdata/USA_NY_New.York-Central.Park.725033_TMY3.mos", pAtmSou = Buildings.BoundaryConditions.Types.DataSource.Parameter, TDryBul(displayUnit = "K"), TDewPoi(displayUnit = "K"), totSkyCovSou = Buildings.BoundaryConditions.Types.DataSource.Parameter, opaSkyCovSou = Buildings.BoundaryConditions.Types.DataSource.Parameter, totSkyCov = 0.01, opaSkyCov = 0.01) "Weather data reader for New York Central Park" annotation(Placement(visible = true, transformation(origin = {-40, 20}, extent = {{-20, -20}, {20, 20}}, rotation = 0)));
    Buildings.BoundaryConditions.SolarGeometry.BaseClasses.Declination decAng "Solar declination (seasonal offset)" annotation(Placement(visible = true, transformation(origin = {-40, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    Buildings.BoundaryConditions.SolarGeometry.BaseClasses.SolarHourAngle solHouAng "Solar hour angle" annotation(Placement(visible = true, transformation(origin = {-40, -80}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    Buildings.BoundaryConditions.WeatherData.Bus weatherBus "Connector to put variables from the weather file" annotation(Placement(visible = true, transformation(origin = {20, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {20, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    Buildings.HeatTransfer.Sources.PrescribedTemperature TOutside "Outside temperature" annotation(Placement(visible = true, transformation(origin = {60, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    Modelica.Blocks.Interfaces.RealOutput SurfOrientation_out "Surface Orientation" annotation(Placement(visible = true, transformation(origin = {100, 80}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    Modelica.Blocks.Interfaces.RealOutput SurfTilt_out "Surface tilt" annotation(Placement(visible = true, transformation(origin = {100, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    Modelica.Blocks.Interfaces.RealOutput SunAlt "Solar altitude" annotation(Placement(visible = true, transformation(origin = {100, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    Modelica.Blocks.Interfaces.RealOutput SunAzi "Solar azimuth" annotation(Placement(visible = true, transformation(origin = {100, -80}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    Modelica.Blocks.Interfaces.RealOutput AOI "Angle of incidence" annotation(Placement(visible = true, transformation(origin = {100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    Modelica.Blocks.Interfaces.RealOutput DNI "Direct normal irradiance" annotation(Placement(visible = true, transformation(origin = {100, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    // Modelica.Blocks.Sources.CombiTimeTable ICSg8_Egen_data_11252013(extrapolation = Modelica.Blocks.Types.Extrapolation.Periodic, smoothness = Modelica.Blocks.Types.Smoothness.ConstantSegments, table = [0, 0; 28561626.199, 0.0; 28561636.32, 0.0; 28561646.261, 0.0; 28561656.197, 0.0; 28561666.207, 0.0; 28561676.262, 0.0; 28561686.195, 0.0; 28561696.208, 0.0; 28561706.385, 0.0; 28561716.208, 0.0; 28561726.209, 0.0; 28561736.192, 0.0; 28561777.538, 0.0; 28561786.19, 0.0; 28561796.189, 0.0; 28561806.321, 0.0; 28561816.188, 0.0; 28561826.203, 0.0; 28561836.187, 0.0; 28561846.186, 0.0; 28561856.345, 0.0; 28561866.185, 0.0; 28561876.184, 0.0; 28561886.184, 0.0; 28561896.183, 0.0; 28561906.25, 0.0; 28561916.182, 0.0; 28561926.182, 0.0; 28561936.37, 0.0; 28561946.18, 0.0; 28561956.18, 0.0; 28561966.179, 0.0; 28561976.2, 0.0; 28561986.178, 0.0; 28561996.203, 0.0; 28562006.177, 0.0; 28562016.176, 0.0; 28562026.199, 0.0; 28562036.175, 0.0; 28562046.175, 0.0; 28562056.2, 0.0; 28562066.174, 0.0; 28562076.173, 0.0; 28562086.199, 24.8; 28562096.252, 25.8; 28562106.433, 25.3; 28562116.171, 25.1; 28562126.17, 25.4; 28562136.17, 25.9; 28562146.201, 26.1; 28562156.168, 26.0; 28562166.168, 25.8; 28562176.197, 25.9; 28562186.167, 25.9; 28562196.195, 25.9; 28562206.166, 25.8; 28562216.197, 25.9; 28562226.164, 26.0; 28562236.164, 26.0; 28562246.163, 26.1; 28562256.203, 26.0; 28562266.162, 26.1; 28562276.532, 26.1; 28562286.321, 26.1; 28562296.197, 26.1; 28562306.16, 26.0; 28562316.159, 26.0; 28562326.159, 25.9; 28562336.158, 26.1; 28562346.194, 26.0; 28562356.618, 26.0; 28562366.585, 25.9; 28562492.064, 25.9; 28562496.149, 8.800000000000001; 28562506.148, 25.7; 28562516.188, 25.9; 28562526.187, 25.8; 28562536.147, 25.7; 28562546.146, 25.6; 28562556.146, 25.7; 28562566.539, 25.7; 28562576.144, 25.7; 28562586.144, 25.6; 28562596.143, 25.5; 28562606.143, 25.6; 28562616.142, 25.5; 28562626.142, 25.5; 28562636.184, 25.5; 28562646.14, 25.6; 28562656.14, 25.5; 28562666.139, 25.6; 28562676.139, 25.5; 28562686.138, 25.4; 28562696.138, 25.4; 28562706.137, 25.3; 28562716.136, 25.4; 28562726.136, 25.3; 28562736.184, 25.4; 28562746.135, 25.4; 28562756.134, 25.3; 28562766.134, 25.4; 28562776.133, 23.9; 28562786.132, 23.1; 28562796.181, 25.0; 28562806.131, 25.2; 28562816.183, 25.2; 28562826.13, 25.2; 28562836.183, 25.2; 28562846.129, 25.2; 28562856.128, 25.2; 28562866.182, 25.2; 28562876.127, 25.1; 28562886.127, 25.2; 28562896.178, 25.2; 28562906.192, 25.2; 28562916.125, 25.2; 28562926.124, 25.2; 28562936.124, 25.2; 28562946.123, 25.1; 28562956.854, 25.2; 28562966.122, 25.1; 28562976.122, 25.2; 28562986.121, 25.1; 28562996.12, 25.1; 28563006.12, 25.1; 28563016.119, 25.1; 28563026.119, 25.1; 28563036.118, 25.2; 28563046.183, 25.0; 28563056.117, 25.0; 28563066.116, 24.9; 28563076.116, 24.9; 28563086.223, 24.9; 28563096.115, 24.9; 28563106.177, 24.9; 28563116.114, 24.8; 28563126.113, 24.9; 28563136.763, 24.9; 28563146.112, 24.9; 28563156.174, 24.7; 28563166.111, 24.8; 28563176.11, 24.8; 28563186.11, 24.7; 28563196.109, 24.7; 28563206.108, 24.7; 28563216.875, 24.7; 28563226.107, 24.6; 28563236.171, 24.6; 28563246.106, 24.7; 28563256.106, 24.7; 28563266.105, 24.6; 28563276.104, 24.6; 28563286.104, 24.6; 28563296.103, 24.6; 28563306.103, 24.6; 28563316.102, 24.5; 28563326.178, 24.5; 28563336.17, 24.4; 28563346.1, 24.6; 28563356.17, 24.6; 28563366.167, 24.5; 28563376.099, 24.5; 28563386.168, 24.2; 28563396.098, 24.2; 28563406.097, 24.4; 28563416.168, 24.3; 28563426.096, 24.5; 28563437.118, 24.3; 28563446.095, 24.3; 28563456.166, 24.4; 28563466.094, 24.4; 28563476.093, 24.3; 28563486.168, 24.3; 28563496.092, 24.3; 28563506.233, 24.4; 28563516.091, 24.2; 28563526.09, 24.1; 28563536.174, 24.1; 28563546.167, 24.1; 28563556.088, 24.1; 28563566.088, 24.1; 28563576.167, 24.1; 28563586.087, 24.1; 28563596.086, 24.1; 28563606.085, 23.9; 28563616.085, 24.0; 28563626.084, 24.0; 28563636.168, 24.0; 28563646.083, 23.9; 28563656.083, 23.9; 28563666.161, 23.9; 28563676.081, 23.9; 28563686.081, 23.9; 28563696.08, 23.8; 28563706.08, 23.8; 28563716.079, 23.9; 28563726.079, 23.8; 28563736.078, 23.8; 28563746.077, 23.8; 28563756.077, 23.8; 28563766.076, 23.8; 28563776.076, 23.8; 28563786.075, 23.8; 28563796.075, 23.8; 28563806.074, 23.7; 28563816.073, 23.7; 28563826.073, 23.7; 28563836.072, 23.7; 28563846.072, 23.6; 28563856.071, 23.7; 28563866.162, 23.7; 28563876.159, 23.6; 28563886.069, 23.6; 28563896.069, 23.6; 28563906.068, 23.5; 28563916.068, 23.6; 28563926.159, 23.5; 28563936.067, 23.6; 28563946.066, 23.5; 28563956.065, 23.5; 28563966.065, 23.5; 28563976.064, 23.6; 28563986.064, 23.5; 28563996.163, 23.4; 28564006.063, 23.5; 28564016.062, 23.5; 28564026.063, 23.4; 28564036.155, 23.4; 28564046.06, 0.0; 28564056.06, 23.5; 28564066.155, 23.4; 28564076.059, 23.3; 28564086.058, 23.3; 28564096.154, 23.3; 28564106.158, 23.4; 28564116.056, 23.3; 28564126.056, 23.3; 28564136.055, 23.2; 28564146.055, 23.2; 28564156.054, 23.3; 28564166.053, 23.3; 28564176.053, 23.3; 28564186.052, 23.2; 28564196.052, 23.2; 28564206.051, 23.2; 28564216.051, 23.1; 28564226.05, 23.1; 28564236.157, 23.1; 28564246.049, 23.0; 28564256.048, 23.0; 28564266.048, 23.0; 28564276.047, 23.0; 28564286.047, 23.1; 28564296.046, 23.0; 28564306.156, 23.0; 28564316.148, 22.8; 28564326.044, 22.9; 28564336.155, 22.8; 28564346.043, 22.8; 28564356.043, 22.4; 28564366.042, 22.8; 28564376.041, 22.8; 28564386.041, 22.8; 28564396.15, 22.8; 28564406.153, 22.7; 28564416.039, 22.6; 28564426.039, 22.6; 28564436.038, 22.6; 28564446.037, 22.7; 28564456.037, 22.6; 28564466.036, 22.6; 28564476.935, 22.4; 28564487.708, 22.4; 28564496.035, 22.4; 28564506.034, 22.3; 28564516.033, 22.3; 28564526.033, 22.1; 28564536.035, 22.1; 28564546.155, 22.4; 28564556.044, 22.4; 28564566.049, 22.3; 28564576.053, 22.3; 28564586.057, 22.1; 28564596.062, 22.0; 28564606.066, 22.1; 28564616.071, 22.0; 28564626.075, 22.0; 28564636.08, 22.1; 28564646.084, 22.1; 28564656.088, 22.1; 28564666.277, 22.1; 28564676.097, 21.9; 28564686.102, 22.1; 28564696.106, 22.0; 28564706.111, 22.0; 28564716.115, 22.3; 28564726.119, 22.0; 28564737.719, 22.1; 28564746.128, 22.1; 28564756.133, 22.0; 28564766.293, 22.1; 28564776.142, 22.0; 28564786.146, 21.9; 28564796.15, 21.9; 28564806.155, 21.9; 28564816.159, 21.8; 28564826.164, 21.9; 28564836.166, 21.7; 28564846.168, 21.6; 28564856.295, 21.5; 28564866.17, 21.4; 28564876.299, 21.3; 28564886.173, 21.4; 28564896.306, 21.4; 28564906.307, 21.3; 28564916.306, 21.4; 28564926.309, 21.3; 28564936.18, 21.4; 28564946.182, 21.2; 28564956.183, 21.3; 28564966.185, 21.2; 28564976.186, 21.0; 28564986.188, 21.0; 28564996.189, 20.8; 28565006.19, 20.9; 28565016.323, 20.9; 28565026.193, 20.8; 28565036.195, 20.7; 28565046.334, 20.5; 28565056.198, 20.4; 28565066.199, 20.3; 28565076.339, 20.1; 28565088.297, 20.0; 28565096.203, 19.8; 28565106.205, 19.4; 28565116.206, 19.3; 28565126.208, 19.0; 28565136.209, 18.5; 28565146.209, 18.3; 28565156.349, 18.1; 28565168.487, 18.0; 28565176.352, 17.9; 28565186.211, 18.0; 28565196.212, 18.0; 28565206.356, 18.0; 28565216.349, 17.9; 28565226.213, 18.0; 28565236.363, 17.9; 28565247.61, 18.1; 28565256.36, 18.1; 28565266.36, 18.1; 28565276.215, 18.2; 28565288.329, 18.4; 28565296.363, 18.4; 28565306.361, 18.7; 28565316.217, 18.7; 28565326.365, 18.8; 28565336.218, 19.2; 28565346.218, 19.3; 28565356.218, 19.5; 28565366.219, 19.4; 28565376.219, 19.3; 28565386.366, 19.3; 28565397.935, 19.2; 28565406.221, 19.3; 28565416.221, 19.5; 28565426.379, 19.7; 28565436.374, 19.1; 28565446.222, 19.1; 28565456.371, 19.0; 28565466.373, 18.3; 28565478.263, 17.9; 28565488.418, 17.8; 28565496.378, 18.1; 28565506.225, 18.6; 28565516.225, 18.5; 28565526.382, 18.5; 28565536.226, 18.5; 28565546.227, 18.2; 28565556.227, 17.8; 28565566.227, 17.1; 28565576.228, 16.0; 28565586.228, 15.1; 28565596.229, 14.5; 28565606.384, 14.2; 28565616.23, 13.3; 28565626.23, 13.4; 28565637.968, 13.7; 28565646.231, 13.7; 28565656.385, 14.3; 28565666.232, 15.4; 28565676.232, 16.4; 28565686.233, 16.6; 28565696.233, 16.1; 28565706.393, 15.1; 28565718.766, 14.4; 28565726.392, 13.5; 28565736.235, 13.0; 28565746.235, 13.8; 28565756.399, 15.1; 28565766.408, 15.8; 28565776.236, 15.6; 28565786.402, 14.6; 28565796.412, 13.5; 28565806.403, 12.9; 28565817.933, 12.3; 28565826.595, 11.6; 28565836.239, 11.7; 28565848.516, 11.9; 28565856.24, 12.0; 28565866.24, 12.1; 28565876.241, 12.6; 28565886.241, 13.2; 28565898.65, 12.2; 28565906.242, 12.0; 28565916.242, 10.7; 28565926.243, 9.1; 28565936.243, 7.6; 28565946.244, 6.1; 28565956.244, 4.7; 28565966.413, 3.4; 28565976.245, 2.3; 28565986.413, 1.5; 28565996.246, 1.0; 28566006.246, 0.6; 28566016.247, 0.4; 28566026.42, 0.3; 28566036.248, 0.2; 28566046.425, 0.2; 28566056.248, 0.1; 28566066.249, 0.1; 28566076.249, 0.0; 28566086.25, 0.0; 28566096.25, 0.0; 28566106.428, 0.0; 28566116.251, 0.0; 28566126.251, 0.0; 28566136.455, 0.0; 28566148.668, 0.0; 28566156.253, 0.0; 28566166.441, 0.0; 28566176.429, 0.0; 28566186.435, 0.0; 28566196.429, 0.0; 28566206.435, 0.0; 28566216.255, 0.0; 28566229.023, 0.0; 28566236.256, 0.0; 28566246.434, 0.0; 28566259.013, 0.0; 28566266.257, 0.0; 28566276.442, 0.0; 28566286.258, 0.0; 28566296.259, 0.0; 28566306.452, 0.0; 28566316.259, 0.0; 28566326.444, 0.0; 28566336.442, 0.0; 28566346.261, 0.0; 28566356.447, 0.0; 28566366.45, 0.0; 28566376.262, 0.0; 28566386.262, 0.0; 28566396.263, 0.0; 28566406.446, 0.0; 28566416.453, 0.0; 28566426.264, 0.0; 28566436.454, 0.0; 28566446.458, 0.0; 28566456.265, 0.0; 28566468.931, 0.0; 28566476.266, 0.0; 28566487.038, 0.0; 28566496.267, 0.0; 28566506.268, 0.0; 28566516.268, 0.0; 28566526.268, 0.0; 28566536.269, 0.0; 28566546.269, 0.0; 28566556.27, 0.0; 28566566.459, 0.0; 28566576.463, 0.0; 28566586.47, 0.0; 28566596.271, 0.0; 28566606.272, 0.0; 28566616.272, 0.0; 28566626.273, 0.0; 28566636.465, 0.0; 28566636.466, 0; 3.15569e8, 0]) annotation(Placement(visible = true, transformation(origin = {-22, 66}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    // Modelica.Blocks.Interfaces.RealOutput ICSg8_Egen_data_11252013_conn "egen data from icsg8" annotation(Placement(visible = true, transformation(origin = {100, 42}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    // Modelica.Blocks.Sources.CombiTimeTable ICSg8_Qgen_data_11252013(extrapolation = Modelica.Blocks.Types.Extrapolation.Periodic, smoothness = Modelica.Blocks.Types.Smoothness.ConstantSegments, table = [0, 0; 28561622.622, 2.9; 28561633.075, 3.9; 28561643.572, 23.4; 28561654.096, 47.8; 28561662.587, 60.1; 28561673.035, 65.3; 28561683.502, 73.40000000000001; 28561694.002, 73.3; 28561702.412, 73.5; 28561712.86, 76.09999999999999; 28561723.285, 77.3; 28561733.811, 77.8; 28561737.976, 77.90000000000001; 28561783.794, 89.7; 28561792.155, 91.7; 28561802.608, 92.5; 28561813.105, 93.8; 28561823.635, 95.09999999999999; 28561834.054, 96.3; 28561842.426, 98.3; 28561852.85, 100.5; 28561863.288, 102.2; 28561873.733, 103.7; 28561882.099, 103.7; 28561892.454, 102.8; 28561902.92, 103.1; 28561913.333, 102.6; 28561921.998, 101.2; 28561932.579, 98.90000000000001; 28561943.041, 97.59999999999999; 28561953.463, 90.59999999999999; 28561963.962, 85.40000000000001; 28561972.308, 88.09999999999999; 28561982.794, 89.2; 28561993.402, 92.09999999999999; 28562003.928, 95.7; 28562012.445, 100.0; 28562022.883, 105.6; 28562033.444, 109.2; 28562043.927, 111.3; 28562052.284, 112.3; 28562062.735, 113.1; 28562073.187, 113.5; 28562083.685, 112.8; 28562092.066, 102.8; 28562102.501, 91.90000000000001; 28562112.984, 86.40000000000001; 28562123.493, 83.40000000000001; 28562133.961, 82.7; 28562142.322, 82.7; 28562152.822, 82.8; 28562163.292, 82.5; 28562173.724, 81.7; 28562182.086, 78.0; 28562192.571, 69.5; 28562203.082, 61.2; 28562213.503, 58.6; 28562223.999, 57.9; 28562232.377, 57.6; 28562242.847, 57.5; 28562253.325, 57.3; 28562263.829, 57.4; 28562272.299, 57.5; 28562282.749, 39.9; 28562293.202, 40.9; 28562303.696, 40.9; 28562312.089, 40.0; 28562322.604, 38.8; 28562333.041, 38.5; 28562343.478, 38.4; 28562353.946, 38.2; 28562362.337, 38.2; 28562366.594, 38.3; 28562492.064, 38.7; 28562502.449, 42.9; 28562512.917, 41.6; 28562523.385, 40.2; 28562533.96, 39.9; 28562542.353, 39.9; 28562552.819, 40.0; 28562563.392, 40.0; 28562573.845, 40.0; 28562582.206, 40.0; 28562592.624, 39.9; 28562603.06, 40.0; 28562613.495, 39.9; 28562623.874, 40.0; 28562632.283, 39.9; 28562642.778, 39.8; 28562653.165, 39.8; 28562663.577, 39.9; 28562671.978, 39.8; 28562682.433, 39.7; 28562692.928, 39.6; 28562703.414, 39.4; 28562711.914, 39.4; 28562722.443, 39.3; 28562732.97, 39.2; 28562743.452, 39.3; 28562753.876, 39.2; 28562762.255, 39.4; 28562772.69, 39.0; 28562783.169, 37.2; 28562793.625, 36.5; 28562801.981, 37.6; 28562812.463, 38.6; 28562822.904, 38.7; 28562833.386, 38.8; 28562843.989, 38.9; 28562852.351, 38.7; 28562862.806, 38.5; 28562873.306, 38.3; 28562883.815, 38.7; 28562892.213, 38.5; 28562902.736, 38.2; 28562913.267, 38.1; 28562923.879, 38.5; 28562932.219, 38.6; 28562942.691, 38.6; 28562953.189, 38.3; 28562963.656, 38.2; 28562972.156, 37.8; 28562982.64, 37.6; 28562993.181, 37.6; 28563003.695, 37.7; 28563012.124, 37.7; 28563022.726, 37.7; 28563033.224, 37.4; 28563043.679, 37.2; 28563052.099, 37.2; 28563062.633, 37.2; 28563073.037, 37.3; 28563083.552, 37.4; 28563093.971, 37.4; 28563102.345, 37.5; 28563112.861, 37.4; 28563123.293, 37.4; 28563133.719, 37.4; 28563142.089, 37.4; 28563152.574, 37.5; 28563163.154, 37.4; 28563173.621, 37.4; 28563182.087, 37.5; 28563192.592, 37.5; 28563203.038, 37.5; 28563213.629, 37.5; 28563222.007, 37.6; 28563232.568, 37.8; 28563243.081, 37.8; 28563253.578, 37.9; 28563261.926, 37.8; 28563272.424, 37.6; 28563282.903, 37.5; 28563293.403, 37.4; 28563303.856, 37.2; 28563312.33, 37.1; 28563322.824, 37.0; 28563333.257, 37.1; 28563343.71, 37.1; 28563352.104, 37.2; 28563362.606, 37.3; 28563373.104, 37.2; 28563383.508, 37.2; 28563393.973, 37.1; 28563402.368, 37.1; 28563412.836, 37.1; 28563423.272, 36.9; 28563433.748, 36.9; 28563442.126, 36.9; 28563452.598, 37.0; 28563463.064, 37.2; 28563473.449, 37.2; 28563483.875, 37.4; 28563492.199, 37.5; 28563502.589, 37.6; 28563513.012, 37.9; 28563523.554, 38.0; 28563531.92, 37.9; 28563542.325, 38.1; 28563552.806, 37.9; 28563563.274, 38.0; 28563573.722, 37.9; 28563582.176, 37.9; 28563592.673, 38.0; 28563603.124, 38.0; 28563613.598, 37.9; 28563621.94, 37.8; 28563632.409, 37.9; 28563642.89, 38.0; 28563653.297, 37.9; 28563663.778, 37.9; 28563672.095, 37.9; 28563682.525, 38.0; 28563693.012, 37.9; 28563703.574, 37.9; 28563711.934, 37.8; 28563722.443, 37.8; 28563732.927, 37.8; 28563743.379, 37.7; 28563753.845, 37.6; 28563762.304, 37.6; 28563772.802, 37.3; 28563783.239, 37.2; 28563793.721, 37.2; 28563802.08, 37.3; 28563812.565, 37.2; 28563823.041, 37.2; 28563833.514, 37.0; 28563841.965, 37.1; 28563852.447, 37.3; 28563862.931, 37.3; 28563873.459, 37.3; 28563883.942, 37.2; 28563892.288, 37.2; 28563902.712, 37.1; 28563913.196, 37.1; 28563923.689, 37.2; 28563932.112, 37.3; 28563942.659, 37.2; 28563953.141, 37.2; 28563963.577, 37.2; 28563972.02, 37.2; 28563982.423, 37.1; 28563992.936, 37.1; 28564003.417, 37.1; 28564013.92, 37.1; 28564022.296, 37.2; 28564032.748, 37.1; 28564043.226, 37.1; 28564053.663, 37.0; 28564062.044, 37.1; 28564072.476, 37.0; 28564082.93, 36.8; 28564093.331, 36.8; 28564103.816, 36.9; 28564112.221, 36.9; 28564122.812, 36.9; 28564133.346, 36.7; 28564143.721, 36.6; 28564152.077, 36.5; 28564162.497, 36.6; 28564172.95, 36.6; 28564183.389, 36.7; 28564193.851, 36.6; 28564202.323, 36.6; 28564212.825, 36.6; 28564223.335, 36.6; 28564233.848, 36.5; 28564242.214, 36.5; 28564252.681, 36.5; 28564263.142, 36.5; 28564273.615, 36.5; 28564282.056, 36.4; 28564292.504, 36.4; 28564302.958, 36.4; 28564313.374, 36.4; 28564323.808, 36.3; 28564332.129, 36.3; 28564342.669, 36.3; 28564353.155, 36.1; 28564363.592, 36.2; 28564371.967, 36.3; 28564382.389, 36.3; 28564392.822, 36.4; 28564403.317, 36.3; 28564413.697, 36.3; 28564422.041, 36.4; 28564432.614, 36.3; 28564443.179, 36.3; 28564453.782, 36.3; 28564462.175, 36.4; 28564472.642, 36.2; 28564483.094, 36.2; 28564493.528, 36.2; 28564501.898, 36.1; 28564512.374, 35.9; 28564522.811, 35.9; 28564533.267, 35.4; 28564543.734, 35.7; 28564552.151, 35.8; 28564562.554, 35.9; 28564572.984, 36.0; 28564583.424, 35.8; 28564591.93, 35.8; 28564602.341, 35.7; 28564612.826, 35.6; 28564623.252, 35.6; 28564633.756, 35.6; 28564642.17, 35.6; 28564652.638, 35.7; 28564663.163, 35.7; 28564673.709, 35.7; 28564682.112, 35.7; 28564692.593, 35.8; 28564703.098, 35.7; 28564713.558, 35.8; 28564721.982, 35.8; 28564732.452, 35.8; 28564742.865, 35.9; 28564753.272, 36.1; 28564763.733, 36.0; 28564772.078, 36.1; 28564782.539, 35.9; 28564792.994, 35.9; 28564803.449, 35.9; 28564813.942, 35.9; 28564822.303, 35.9; 28564832.7, 35.8; 28564843.169, 35.8; 28564853.715, 35.8; 28564862.094, 35.6; 28564872.519, 35.6; 28564882.941, 35.4; 28564893.407, 35.6; 28564903.832, 35.5; 28564912.174, 35.6; 28564922.613, 35.7; 28564933.05, 35.8; 28564943.463, 35.7; 28564953.944, 35.6; 28564962.353, 35.4; 28564972.93, 35.4; 28564983.555, 35.4; 28564994.008, 35.3; 28565002.338, 35.2; 28565012.767, 35.1; 28565023.204, 35.1; 28565033.643, 35.0; 28565042.021, 34.8; 28565052.459, 34.7; 28565062.94, 34.5; 28565073.383, 34.3; 28565083.805, 34.2; 28565092.167, 34.0; 28565102.607, 33.6; 28565113.073, 33.2; 28565123.527, 32.8; 28565132.011, 32.6; 28565142.467, 32.1; 28565153.058, 31.7; 28565163.495, 31.3; 28565173.902, 31.2; 28565182.231, 31.1; 28565192.639, 31.1; 28565203.119, 31.1; 28565213.62, 31.0; 28565224.093, 31.0; 28565232.402, 30.9; 28565242.89, 31.0; 28565253.308, 31.1; 28565263.666, 31.2; 28565274.103, 31.4; 28565282.486, 31.6; 28565292.917, 31.7; 28565303.448, 31.8; 28565313.884, 31.9; 28565322.263, 32.2; 28565332.764, 32.7; 28565343.312, 33.1; 28565353.871, 33.5; 28565362.247, 33.8; 28565372.767, 33.7; 28565383.206, 33.6; 28565393.765, 32.6; 28565402.155, 33.0; 28565412.684, 33.0; 28565423.138, 33.5; 28565433.635, 33.9; 28565444.105, 33.1; 28565452.45, 33.2; 28565462.889, 33.0; 28565473.33, 32.1; 28565483.781, 31.7; 28565492.142, 31.6; 28565502.606, 31.7; 28565513.032, 32.0; 28565523.469, 32.0; 28565533.999, 32.0; 28565542.313, 32.0; 28565552.769, 31.5; 28565563.188, 30.8; 28565573.653, 29.5; 28565584.09, 28.0; 28565592.42, 27.0; 28565602.891, 26.1; 28565613.362, 25.1; 28565623.858, 23.8; 28565632.237, 23.8; 28565642.642, 23.9; 28565653.059, 24.1; 28565663.611, 25.2; 28565674.043, 26.7; 28565682.469, 27.8; 28565692.936, 28.3; 28565703.488, 27.5; 28565713.924, 26.4; 28565722.318, 25.5; 28565732.736, 24.2; 28565743.187, 23.8; 28565753.608, 25.0; 28565764.077, 26.6; 28565772.502, 27.2; 28565782.985, 26.8; 28565793.499, 25.5; 28565803.894, 24.1; 28565812.24, 23.2; 28565822.77, 22.1; 28565833.238, 21.1; 28565843.676, 20.9; 28565854.11, 21.0; 28565862.507, 21.1; 28565873.03, 21.7; 28565883.421, 23.3; 28565893.971, 25.0; 28565902.376, 25.6; 28565912.817, 27.0; 28565923.345, 26.6; 28565933.783, 25.8; 28565944.14, 24.6; 28565952.501, 23.4; 28565962.923, 21.3; 28565973.391, 18.6; 28565983.863, 15.9; 28565992.238, 13.9; 28566002.663, 11.5; 28566013.084, 9.4; 28566023.489, 7.3; 28566033.938, 5.5; 28566042.3, 4.3; 28566052.726, 3.0; 28566063.175, 2.1; 28566073.631, 1.1; 28566084.1, 0.5; 28566092.427, 0.2; 28566102.928, -0.2; 28566113.365, -0.6; 28566123.829, -0.6; 28566132.18, -0.7; 28566142.629, -0.8; 28566153.085, -0.8; 28566163.519, -0.9; 28566173.943, -1.1; 28566182.29, -1.2; 28566192.728, -1.3; 28566203.165, -1.3; 28566213.614, -1.3; 28566224.051, -1.3; 28566232.379, -1.4; 28566242.883, -1.5; 28566253.321, -1.5; 28566263.704, -1.5; 28566274.148, -1.6; 28566282.541, -1.7; 28566292.991, -1.7; 28566303.444, -1.7; 28566313.943, -1.7; 28566322.288, -1.8; 28566332.789, -1.8; 28566343.181, -1.8; 28566353.603, -1.8; 28566364.068, -1.9; 28566372.402, -1.9; 28566382.839, -1.8; 28566393.333, -1.6; 28566403.759, -1.5; 28566412.117, -1.8; 28566422.589, -2.1; 28566433.21, -2.1; 28566443.728, -2.2; 28566452.054, -2.2; 28566462.633, -2.3; 28566473.135, -2.7; 28566483.6, -2.9; 28566494.118, -3.1; 28566502.668, -3.3; 28566513.162, -3.3; 28566523.602, -3.4; 28566534.052, -3.6; 28566542.444, -3.7; 28566552.913, -3.9; 28566563.416, -4.0; 28566573.896, -4.2; 28566582.321, -4.3; 28566592.728, -4.5; 28566603.121, -4.6; 28566613.619, -4.6; 28566624.105, -4.8; 28566632.477, -4.9; 28566632.478, 0; 3.15569e8, 0]) annotation(Placement(visible = true, transformation(origin = {0, 80}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_b TDryBul "Dry bulb temperature" annotation(Placement(visible = true, transformation(origin = {100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    // Modelica.Blocks.Interfaces.RealOutput Q_gen "don't know why these experiment outputs get stuck in context, but here they are" annotation(Placement(visible = true, transformation(origin = {100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
  protected
    Real del_c = Modelica.Math.cos(decAng.decAng);
    Real del_s = Modelica.Math.sin(decAng.decAng);
    Real phi_c = Modelica.Math.cos(Lat);
    Real phi_s = Modelica.Math.sin(Lat);
    Real omg_c = Modelica.Math.cos(solHouAng.solHouAng);
    Real omg_s = Modelica.Math.sin(solHouAng.solHouAng);
    Real bet_c = Modelica.Math.cos(Modelica.Constants.pi / 2 - SurfTilt);
    Real bet_s = Modelica.Math.sin(Modelica.Constants.pi / 2 - SurfTilt);
    Real gam_c = Modelica.Math.cos(SurfOrientation);
    Real gam_s = Modelica.Math.sin(SurfOrientation);
  equation
    //connect(ICSFg8_DNI_Nov252013.y[1], DNI) annotation(Line(points = {{51, -80}, {65.7602, -80}, {65.7602, -19.7775}, {93.9431, -19.7775}, {93.9431, -19.7775}}, color = {0, 0, 127}));
    //connect(ICSg8_Egen_data_11252013.y[1], ICSg8_Egen_data_11252013_conn) annotation(Line(points = {{-11, 66}, {12, 66}, {12, 54}, {54, 54}, {69.5748, 53.8443}, {100, 40}, {100, 42}}, color = {0, 0, 127}));
    //[[11252013]]
    //connect(ICSg8_Qgen_data_11252013.y[1], Q_gen) annotation(Line(points = {{11, 80}, {16.0544, 80}, {16.0544, 42.9932}, {72.9252, 42.9932}, {72.9252, 19.8639}, {100, 19.8639}, {100, 20}}, color = {0, 0, 127}));
    connect(TOutside.port, TDryBul) annotation(Line(points = {{70, 20}, {97.8229, 0}, {100, 0}}));
    connect(weatherBus.HDirNor, DNI) "Connects Hourly Direct Normal Irradiance from the weather file to the DNI output of context";
    connect(SurfOrientation, SurfOrientation_out) "Connects Surface Orientation Parameter to Surface Orientation Output";
    connect(SurfTilt, SurfTilt_out) "Connects Surface Tilt Parameter to Surface Tilt Output";
    connect(weatherBus.TDryBul, TOutside.T) "Connects the weather file Dry Bult to the TOutside prescribed temperature model" annotation(Line(points = {{20, 20}, {47.0247, 20}, {48, 20}}));
    // connect(weatherBus, HDirTil.weaBus) "Connects the weather bus to the irradiance based on wall tilt calculation model (HDirTil)" annotation(Line(points = {{20, 20}, {19.7388, 20}, {19.7388, -17.4165}, {-3.48331, -17.4165}, {-3.48331, -40.0581}, {10, -40.0581}, {10, -40}}));
    // connect(HDirTil.inc, AOI) "Connects incident angle to angle of incidence out" annotation(Line(points = {{31, -44}, {45.5733, -44}, {45.5733, -40.0581}, {100, -40.0581}, {100, -40}}));
    connect(weatherBus.solTim, solHouAng.solTim) "Connects solar time to solar hour angle model" annotation(Line(points = {{20, 20}, {19.7388, 20}, {19.7388, -17.4165}, {-63.5704, -17.4165}, {-63.5704, -79.8258}, {-52, -79.8258}, {-52, -80}}));
    connect(weatherBus.cloTim, decAng.nDay) "Calculates clock time to day number" annotation(Line(points = {{20, 20}, {19.7388, 20}, {19.7388, -17.4165}, {-63.5704, -17.4165}, {-63.5704, -40.0581}, {-52, -40.0581}, {-52, -40}}));
    connect(weaDat.weaBus, weatherBus) "Connects weather data to weather bus" annotation(Line(points = {{-20, 20}, {20.6096, 20}, {20, 20}}));
    //Uses the decAng and solHouAng to calculate the Declination and Solar Hour angles
    SunAlt = Modelica.Math.asin(Modelica.Math.sin(Lat) * Modelica.Math.sin(decAng.decAng) + Modelica.Math.cos(Lat) * Modelica.Math.cos(decAng.decAng) * Modelica.Math.cos(solHouAng.solHouAng));
    //Eq 1.6.6 Solar Engineering of Thermal Processes - Duff & Beckman
    SunAzi = sign(Modelica.Math.sin(solHouAng.solHouAng)) * abs(Modelica.Math.acos((Modelica.Math.cos(abs(Modelica.Constants.pi / 2 - SunAlt)) * Modelica.Math.sin(Lat) - Modelica.Math.sin(decAng.decAng)) / (Modelica.Math.cos(Lat) * Modelica.Math.sin(abs(Modelica.Constants.pi / 2 - SunAlt)))));
    //Eq 1.6.2 Solar Engineering of Thermal Processes - Duff & Beckman
    // Ask about the origin of this AOI when we can get AOI from HDirTil component.
    AOI = Modelica.Math.acos(del_s * phi_s * bet_c - del_s * phi_c * bet_s * gam_c + del_c * phi_c * bet_c * omg_c + del_c * phi_s * bet_s * gam_c * omg_c + del_c * bet_s * gam_s * omg_s);
    annotation(Diagram(coordinateSystem(preserveAspectRatio = false, extent = {{-100, -100}, {100, 100}}), graphics));
  end ICS_Context;

  package Envelope "Package of all the Envelope components to create an Integrated Concentrating Solar simulation"
    extends Modelica.Icons.Package;

    model ICS_EnvelopeCassette "This model in the Envelope Cassette (Double-Skin Facade) that houses the ICSolar Stack and Modules. This presents a building envelope"
      extends ICSolar.Parameters;
      Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a TAmb_in "Ambient cavity temperature" annotation(Placement(visible = true, transformation(origin = {-100, 80}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_a flowport_a(medium = mediumHTF) "Thermal fluid inflow port, before heat exchange" annotation(Placement(visible = true, transformation(origin = {-100, -80}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-95, -85}, extent = {{-5, -5}, {5, 5}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput DNI "DNI from weather file" annotation(Placement(visible = true, transformation(origin = {-100, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput AOI "Angle of incidence" annotation(Placement(visible = true, transformation(origin = {-100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput SunAlt "Altitude of the sun " annotation(Placement(visible = true, transformation(origin = {-100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput SunAzi "Azimuth of the sun " annotation(Placement(visible = true, transformation(origin = {-100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput SurfaceOrientation annotation(Placement(visible = true, transformation(origin = {-100, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput SurfaceTilt annotation(Placement(visible = true, transformation(origin = {-100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealOutput Power_Electric "Electric power generated" annotation(Placement(visible = true, transformation(origin = {100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 60}, extent = {{-20, -20}, {20, 20}}, rotation = 0)));
      Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_b flowport_b(medium = mediumHTF) "Thermal fluid outflow port, after heat exchange" annotation(Placement(visible = true, transformation(origin = {100, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      // Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_b Power_Heat "Heat power generated" annotation(Placement(visible = true, transformation(origin = {100,-60}, extent = {{-10,-10},{10,10}}, rotation = 0), iconTransformation(origin = {100,-60}, extent = {{-10,-10},{10,10}}, rotation = 0)));
      // Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort generated_enthalpy "Placeholder to make" annotation(Placement(visible = false));
      Modelica.Thermal.HeatTransfer.Sources.FixedTemperature T_indoors(T = Temp_Indoor) annotation(Placement(visible = true, transformation(origin = {-20, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      ICSolar.Envelope.CavityHeatBalance cavityheatbalance1 annotation(Placement(visible = true, transformation(origin = {20, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      // ICSolar.Envelope.ICS_GlazingLosses glazingLossesInner(Trans_glaz = 0.76) annotation(Placement(visible = true, transformation(origin = {60, -60}, extent = {{-15, -15}, {15, 15}}, rotation = 0)));
      ICSolar.Envelope.ICS_GlazingLosses glazingLossesOuter annotation(Placement(visible = true, transformation(origin = {-60, 60}, extent = {{-15, -15}, {15, 15}}, rotation = 0)));
      ICSolar.Envelope.RotationMatrixForSphericalCood rotationmatrixforsphericalcood1 annotation(Placement(visible = true, transformation(origin = {-60, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      // Modelica.Blocks.Interfaces.RealOutput DNI_toIndoors "the DNI that slips past the modules and gets through the interior-side glazing" annotation(Placement(visible = true, transformation(origin = {100, -80}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      // ICSolar.Envelope.DNIReduction_AreaFraction dnireduction_areafraction1 annotation(Placement(visible = true, transformation(origin = {-20, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      constant Real GND = 0 "Ground input for stack power flow, Real";
      //  constant Modelica.Blocks.Sources.Constant GND(k = 0) "a zero source for the Real electrical input" annotation(Placement(visible = true, transformation(origin = {-20, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      ICSolar.Stack.ICS_Stack ics_stack1 annotation(Placement(visible = true, transformation(origin = {40, 0}, extent = {{-25, -25}, {25, 25}}, rotation = 0)));
      ICSolar.Stack.ICS_Stack2 ics_stack2 annotation(Placement(visible = true, transformation(origin = {40, -60}, extent = {{-25, -25}, {25, 25}}, rotation = 0)));
      Modelica.Blocks.Sources.CombiTimeTable DNI_measured(tableOnFile = true, fileName = "modelica://ICSolar/20150323/ICSFdata_DNI.txt", tableName = "DNI", extrapolation = Modelica.Blocks.Types.Extrapolation.HoldLastPoint, smoothness = Modelica.Blocks.Types.Smoothness.ConstantSegments, columns = {2}) annotation(Placement(visible = true, transformation(origin = {-60, 20}, extent = {{-15, -15}, {15, 15}}, rotation = 0)));
    equation
      //  pre-stacks
      //DNI into cavity
      connect(DNI, glazingLossesOuter.DNI) annotation(Line(points = {{-100, 60}, {-75, 60}, {-75, 64}, {-70, 69}, {-75, 69}}));
      connect(AOI, glazingLossesOuter.AOI) annotation(Line(points = {{-100, 40}, {-84, 40}, {-84, 45}, {-70, 51}, {-75, 51}}));
      connect(SunAlt, rotationmatrixforsphericalcood1.SunAlt) annotation(Line(points = {{-100, 20}, {-81.4634, 20}, {-81.2162, -16.5426}, {-69.7528, -16.445}, {-70, -16}}, color = {0, 0, 127}));
      connect(SunAzi, rotationmatrixforsphericalcood1.SunAzi) annotation(Line(points = {{-100, 0}, {-87.0732, 0}, {-86.826, -11.9084}, {-69.7528, -12.445}, {-70, -12}}, color = {0, 0, 127}));
      connect(SurfaceOrientation, rotationmatrixforsphericalcood1.SurfaceOrientation) annotation(Line(points = {{-100, -20}, {-83.9024, -20}, {-83.6552, -20.2011}, {-69.7528, -20.445}, {-70, -20}}, color = {0, 0, 127}));
      connect(SurfaceTilt, rotationmatrixforsphericalcood1.SurfaceTilt) annotation(Line(points = {{-100, -40}, {-85.6098, -40}, {-85.3626, -24.5913}, {-69.7528, -24.445}, {-70, -24}}, color = {0, 0, 127}));
      //how much self-shading
      //thermal balance
      connect(T_indoors.port, cavityheatbalance1.Interior) annotation(Line(points = {{-10, 60}, {-1.48368, 60}, {-1.48368, 55.7864}, {10, 55.7864}, {10, 56}}));
      connect(TAmb_in, cavityheatbalance1.Exterior) annotation(Line(points = {{-100, 80}, {5.04451, 80}, {5.04451, 65.8754}, {10, 66}, {10, 66}}));
      //prep the stacks inputs:
      ics_stack1.Power_in = 0;
      connect(ics_stack2.Power_in, ics_stack1.Power_out);
      connect(ics_stack2.Power_out, Power_Electric);
      connect(rotationmatrixforsphericalcood1.arrayYaw, ics_stack1.arrayYaw);
      connect(rotationmatrixforsphericalcood1.arrayPitch, ics_stack1.arrayPitch);
      connect(rotationmatrixforsphericalcood1.arrayYaw, ics_stack2.arrayYaw);
      connect(rotationmatrixforsphericalcood1.arrayPitch, ics_stack2.arrayPitch);
      //  connect(glazingLossesOuter.SurfDirNor, ics_stack1.DNI);
      // connect(glazingLossesOuter.SurfDirNor, ics_stack2.DNI);
      connect(DNI_measured.y[1], ics_stack2.DNI);
      connect(DNI_measured.y[1], ics_stack1.DNI);
      connect(ics_stack1.flowport_a1, flowport_a);
      connect(ics_stack1.flowport_b1, ics_stack2.flowport_a1);
      connect(ics_stack2.flowport_b1, flowport_b);
      connect(ics_stack1.TAmb_in, cavityheatbalance1.ICS_Heat);
      connect(ics_stack2.TAmb_in, cavityheatbalance1.ICS_Heat);
    end ICS_EnvelopeCassette;

    model ICS_GlazingLosses "This model calculates the transmittance of a single glass layer and discounts the DNI by the absorption and reflection"
      extends ICSolar.Parameters;
      parameter Real Trans_glaz = Trans_glazinglosses "Good glass: Guardian Ultraclear 6mm: 0.87. For our studio IGUs, measured 0.71. But give it 0.74, because we measured at ~28degrees, which will increase absorptance losses.";
      Modelica.Blocks.Interfaces.RealOutput Trans_glaz_transient "momentary transmittance of exterior glazing" annotation(Placement(visible = true, transformation(origin = {100, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealOutput SurfDirNor "Surface direct normal solar irradiance" annotation(Placement(visible = true, transformation(origin = {100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput AOI "Angle of incidence" annotation(Placement(visible = true, transformation(origin = {-100, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput DNI "Direct normal irradiance" annotation(Placement(visible = true, transformation(origin = {-100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    equation
      if AOI <= 1.57 then
        SurfDirNor = DNI * ((-1.03279 * AOI ^ 6) + 3.67852 * AOI ^ 5 + (-5.11451 * AOI ^ 4) + 3.27596 * AOI ^ 3 + (-0.9393 * AOI ^ 2) + 0.09071 * AOI + 0.96) * ((-0.1167 * AOI ^ 3) + 0.139 * AOI ^ 2 + (-0.0643 * AOI ^ 1) + 0.95) * Trans_glaz / (0.96 * 0.95) "Fresnel Reflection and material absorption losses from Polyfits where P_Transmitted(AOI)";
        //direct normal attenuated by...
        //first the fresnel losses polynomial fit, from snell's and indices of refraction ("fresnel loss with glazing.xlsx")
        //then the absorption losses polynomial fit, working from guardian UltraWhite data
        //working off their catalog at https://glassanalytics.guardian.com/PerformanceCalculator.aspx,and "Guardian UltraWhite specs.xlsx"
        //the final Trans_glaz/(other constants) brings the normal transmittance in-line with 6mm guardian UltraWhite solar transmittance of 87%, or whatever the studio-measured empirical trans is.
        //baseline absorptance transmission from guardian data for 6mm glass is ~95%
        //note: spectral mismatch between glazing and CCA was investigated, deemed negigible ("spectral transmittance of glazing and CPV performance.xlsx")
        //updated by NEN nov9-14
      else
        SurfDirNor = 0;
      end if;
      if DNI > 0 then
        Trans_glaz_transient = SurfDirNor / DNI;
      else
        Trans_glaz_transient = Trans_glaz;
      end if;
      annotation(Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Text(origin = {-2.81, 1.48}, extent = {{-67, 33.14}, {67, -33.14}}, textString = "Glazing Losses")}), experiment(StartTime = 1, StopTime = 31536000.0, Tolerance = 1e-006, Interval = 3600));
    end ICS_GlazingLosses;

    model ICS_SelfShading "This model multiplies the DNI in by a shaded factor determined from the solar altitude and azimuth"
      Modelica.Blocks.Interfaces.RealOutput DNI_out "DNI after shading factor multiplication" annotation(Placement(visible = true, transformation(origin = {100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput DNI_in "DNI in before shading factor multiplication" annotation(Placement(visible = true, transformation(origin = {-100, 80}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 80}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Math.Product product1 "Multiplication of DNI and shading factor" annotation(Placement(visible = true, transformation(origin = {20, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput arrayPitch "pitch (up/down) angle of 2axis tracking array (rads)" annotation(Placement(visible = true, transformation(origin = {-100, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput arrayYaw "yaw (left/right) angle of tracking array (in radians)" annotation(Placement(visible = true, transformation(origin = {-100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Tables.CombiTable2D Shading(table = [0, -3.1415926, -1.04719, -0.959927, -0.872667, -0.785397, -0.6981270000000001, -0.610867, -0.523597, -0.436327, -0.349067, -0.261797, -0.174837, -0.08726730000000001, 0, 0.08726730000000001, 0.174837, 0.261797, 0.349067, 0.436327, 0.523597, 0.610867, 0.6981270000000001, 0.785397, 0.872667, 0.959927, 1.04719, 3.1415926; -0.872665, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0; -0.785398, 0, 0, 0.515733288, 0.582273933, 0.644111335, 0.700774874, 0.751833306, 0.796898047, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.796898047, 0.751833306, 0.700774874, 0.644111335, 0.582273933, 0.515733288, 0, 0; -0.698132, 0, 0, 0.558719885, 0.630806722, 0.697798298, 0.759184768, 0.814498944, 0.86331985, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.86331985, 0.814498944, 0.759184768, 0.697798298, 0.630806722, 0.558719885, 0, 0; -0.610865, 0, 0, 0.5974542859999999, 0.674538691, 0.746174596, 0.811816808, 0.870965752, 0.923171268, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.923171268, 0.870965752, 0.811816808, 0.746174596, 0.674538691, 0.5974542859999999, 0, 0; -0.523599, 0, 0, 0.6316417, 0.713137013, 0.788872054, 0.8582704330000001, 0.920803986, 0.975996795, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.975996795, 0.920803986, 0.8582704330000001, 0.788872054, 0.713137013, 0.6316417, 0, 0; -0.436332, 0, 0, 0.639557866, 0.722074534, 0.798758738, 0.869026865, 0.932344131, 0.988228655, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.988228655, 0.932344131, 0.869026865, 0.798758738, 0.722074534, 0.639557866, 0, 0; -0.349066, 0, 0, 0.639557866, 0.722074534, 0.798758738, 0.869026865, 0.932344131, 0.988228655, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.988228655, 0.932344131, 0.869026865, 0.798758738, 0.722074534, 0.639557866, 0, 0; -0.261799, 0, 0, 0.639557866, 0.722074534, 0.798758738, 0.869026865, 0.932344131, 0.988228655, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.988228655, 0.932344131, 0.869026865, 0.798758738, 0.722074534, 0.639557866, 0, 0; -0.174533, 0, 0, 0.639557866, 0.722074534, 0.798758738, 0.869026865, 0.932344131, 0.988228655, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.988228655, 0.932344131, 0.869026865, 0.798758738, 0.722074534, 0.639557866, 0, 0; -0.087266, 0, 0, 0.639557866, 0.722074534, 0.798758738, 0.869026865, 0.932344131, 0.988228655, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.988228655, 0.932344131, 0.869026865, 0.798758738, 0.722074534, 0.639557866, 0, 0; 0, 0, 0, 0.639557866, 0.722074534, 0.798758738, 0.869026865, 0.932344131, 0.988228655, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.988228655, 0.932344131, 0.869026865, 0.798758738, 0.722074534, 0.639557866, 0, 0; 0.087266, 0, 0, 0.639557866, 0.722074534, 0.798758738, 0.869026865, 0.932344131, 0.988228655, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.988228655, 0.932344131, 0.869026865, 0.798758738, 0.722074534, 0.639557866, 0, 0; 0.174533, 0, 0, 0.639557866, 0.722074534, 0.798758738, 0.869026865, 0.932344131, 0.988228655, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.988228655, 0.932344131, 0.869026865, 0.798758738, 0.722074534, 0.639557866, 0, 0; 0.261799, 0, 0, 0.639557866, 0.722074534, 0.798758738, 0.869026865, 0.932344131, 0.988228655, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.988228655, 0.932344131, 0.869026865, 0.798758738, 0.722074534, 0.639557866, 0, 0; 0.349066, 0, 0, 0.639557866, 0.722074534, 0.798758738, 0.869026865, 0.932344131, 0.988228655, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.988228655, 0.932344131, 0.869026865, 0.798758738, 0.722074534, 0.639557866, 0, 0; 0.436332, 0, 0, 0.639557866, 0.722074534, 0.798758738, 0.869026865, 0.932344131, 0.988228655, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.988228655, 0.932344131, 0.869026865, 0.798758738, 0.722074534, 0.639557866, 0, 0; 0.523599, 0, 0, 0.6316417, 0.713137013, 0.788872054, 0.8582704330000001, 0.920803986, 0.975996795, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.975996795, 0.920803986, 0.8582704330000001, 0.788872054, 0.713137013, 0.6316417, 0, 0; 0.610865, 0, 0, 0.5974542859999999, 0.674538691, 0.746174596, 0.811816808, 0.870965752, 0.923171268, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.923171268, 0.870965752, 0.811816808, 0.746174596, 0.674538691, 0.5974542859999999, 0, 0; 0.698132, 0, 0, 0.558719885, 0.630806722, 0.697798298, 0.759184768, 0.814498944, 0.86331985, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.86331985, 0.814498944, 0.759184768, 0.697798298, 0.630806722, 0.558719885, 0, 0; 0.785398, 0, 0, 0.515733288, 0.582273933, 0.644111335, 0.700774874, 0.751833306, 0.796898047, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.796898047, 0.751833306, 0.700774874, 0.644111335, 0.582273933, 0.515733288, 0, 0; 0.872665, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]) "Shading factors based on altitude and azimuth" annotation(Placement(visible = true, transformation(origin = {-40, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    equation
      connect(arrayYaw, Shading.u2) annotation(Line(points = {{-100, -40}, {-88.2927, -40}, {-88.2927, -45.3659}, {-32, -46}, {-52, -46}}, color = {0, 0, 127}));
      connect(arrayPitch, Shading.u1) annotation(Line(points = {{-100, -20}, {-84.39019999999999, -20}, {-84.39019999999999, -32.6829}, {-32, -34}, {-52, -34}}, color = {0, 0, 127}));
      //  connect(DNI_transmitted_table.y, DNI_transmitted) annotation(Line(points = {{-9, 0}, {33.7415, 0}, {33.7415, -20.1361}, {93.0612, -20.1361}, {93.0612, -20.1361}}, color = {0, 0, 127}));
      //  connect(rotationmatrixforsphericalcood1.SurfYaw, DNI_transmitted_table.u2) annotation(Line(points = {{-50, -34}, {-45.1701, -34}, {-45.1701, -5.71429}, {-33.7415, -5.71429}, {-33.7415, -5.71429}}, color = {0, 0, 127}));
      //  connect(rotationmatrixforsphericalcood1.SurfPitch, DNI_transmitted_table.u1) annotation(Line(points = {{-50, -44}, {-42.7211, -44}, {-42.7211, 6.80272}, {-33.4694, 6.80272}, {-33.4694, 6.80272}}, color = {0, 0, 127}));
      product1.u2 = if Shading.y < 0 then 0 else Shading.y;
      connect(product1.y, DNI_out) "DNI after multiplication connected to output of model" annotation(Line(points = {{31, 40}, {58.5909, 40}, {58.5909, 19.7775}, {100, 19.7775}, {100, 20}}));
      //connect(Shading.y,product1.u2) "Shading factor connecting to product" annotation(Line(points = {{-9,-40},{-0.741656,-40},{-0.741656,33.869},{8,33.869},{8,34}}));
      connect(DNI_in, product1.u1) "Model input DNI connecting to product" annotation(Line(points = {{-100, 80}, {-36.3412, 80}, {-36.3412, 45.9827}, {8, 45.9827}, {8, 46}}));
      annotation(Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Text(origin = {-4.59, 2.51}, extent = {{-72.63, 35.36}, {72.63, -35.36}}, textString = "Self Shading")}));
    end ICS_SelfShading;

    class RotationMatrixForSphericalCood "This models changes the reference frame from the Solar Altitude / Aizmuth to the surface yaw and pitch angles based on building orientatino and surface tilt"
      // parameter Real RollAng = 0;  Not included in current model verison
      Modelica.Blocks.Interfaces.RealOutput arrayYaw annotation(Placement(visible = true, transformation(origin = {100, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 60}, extent = {{-15, -15}, {15, 15}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealOutput arrayPitch annotation(Placement(visible = true, transformation(origin = {100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, -40}, extent = {{-15, -15}, {15, 15}}, rotation = 0)));
      // Construction of Spherical to Cartesain Matrix
      Real phi = 3 * Modelica.Constants.pi / 2 - SunAzi;
      Real theta = Modelica.Constants.pi / 2 - SunAlt "Solar Zeneth Angle";
      Real PitchAng = SurfaceTilt "Tilt back from Vertical Position";
      Real YawAng = SurfaceOrientation "Zero is direct SOUTH";
      Real vSphToCart[3, 1] = [Modelica.Math.sin(theta) * Modelica.Math.cos(phi); Modelica.Math.sin(theta) * Modelica.Math.sin(phi); Modelica.Math.cos(theta)];
      // Result of Cartesian to Spherical
      Real vCartToSph[3, 1];
      // Rotation around X-axis --> RollAng
      Real Rx[3, 3] = [1, 0, 0; 0, Modelica.Math.cos(PitchAng), -1 * Modelica.Math.sin(PitchAng); 0, Modelica.Math.sin(PitchAng), Modelica.Math.cos(PitchAng)];
      // Rotation around Y-axis --> PitchAng
      //	Real Ry[3,3] = [Modelica.Math.cos(-1*PitchAng),0,Modelica.Math.sin(-1*PitchAng);0,1,0;-1 * Modelica.Math.sin(-1*PitchAng),0,Modelica.Math.cos(-1*PitchAng)];
      // Rotation around the Z-axis --> YawAng
      Real Rz[3, 3] = [Modelica.Math.cos(YawAng), -1 * Modelica.Math.sin(YawAng), 0; Modelica.Math.sin(YawAng), Modelica.Math.cos(YawAng), 0; 0, 0, 1];
      Modelica.Blocks.Interfaces.RealInput SunAzi annotation(Placement(visible = true, transformation(origin = {-100, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 80}, extent = {{-15, -15}, {15, 15}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput SunAlt annotation(Placement(visible = true, transformation(origin = {-100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 40}, extent = {{-15, -15}, {15, 15}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput SurfaceOrientation annotation(Placement(visible = true, transformation(origin = {-100, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 0}, extent = {{-15, -15}, {15, 15}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput SurfaceTilt annotation(Placement(visible = true, transformation(origin = {-100, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -40}, extent = {{-15, -15}, {15, 15}}, rotation = 0)));
    equation
      vCartToSph = Rx * Rz * vSphToCart;
      arrayPitch = Modelica.Constants.pi / 2 - Modelica.Math.acos(vCartToSph[3, 1]);
      arrayYaw = (-1 * Modelica.Math.atan(vCartToSph[2, 1] / vCartToSph[1, 1])) - sign(vCartToSph[1, 1]) * Modelica.Constants.pi / 2;
      annotation(Diagram(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2})), Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Text(origin = {16.0156, 3.67356}, extent = {{-101.49, 60.28}, {73.98, -63.83}}, textString = "Transform Matrix")}), experiment(StartTime = 0, StopTime = 86400, Tolerance = 0.001, Interval = 86.5731));
    end RotationMatrixForSphericalCood;

    model CavityHeatBalance
      extends ICSolar.Parameters;
      Modelica.Thermal.HeatTransfer.Components.ThermalConductor Conduction_Exterior(G = 10.17809 * GlassArea) "Lumped Thermal Conduction between Exterior and Cavity" annotation(Placement(visible = true, transformation(origin = {-40, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a Interior annotation(Placement(visible = true, transformation(origin = {100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a Exterior annotation(Placement(visible = true, transformation(origin = {-100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Thermal.HeatTransfer.Components.HeatCapacitor CavityHeatCapacity(C = 2.072 * 1000) "Includes Air and ICS Components to add to the Heat Capacity of the Cavity" annotation(Placement(visible = true, transformation(origin = {0, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Thermal.HeatTransfer.Components.ThermalConductor Conduction_Interior(G = 3.309792 * GlassArea) "Conduction Heat Transfer between Cavity and Interior" annotation(Placement(visible = true, transformation(origin = {40, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 180)));
      Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_b ICS_Heat annotation(Placement(visible = true, transformation(origin = {0, -100}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {0, -100}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    equation
      connect(Conduction_Interior.port_a, Interior) annotation(Line(points = {{50, 20}, {101.78, 20}, {101.78, 20.4748}, {101.78, 20.4748}}));
      connect(ICS_Heat, CavityHeatCapacity.port) annotation(Line(points = {{0, -100}, {0.593472, -100}, {0.593472, 29.9703}, {0.593472, 29.9703}}));
      connect(Conduction_Interior.port_b, CavityHeatCapacity.port) annotation(Line(points = {{30, 20}, {0.296736, 20}, {0.296736, 29.3769}, {0.296736, 29.3769}}));
      connect(Conduction_Exterior.port_b, CavityHeatCapacity.port) annotation(Line(points = {{-30, 20}, {0.296736, 20}, {0.296736, 30.5638}, {0.296736, 30.5638}}));
      connect(Exterior, Conduction_Exterior.port_a) annotation(Line(points = {{-100, 20}, {-50.1484, 20}, {-50.1484, 20.4748}, {-50.1484, 20.4748}}));
      annotation(Diagram(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2})), Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Text(origin = {2.37855, 61.2725}, extent = {{-50.45, 33.98}, {50.45, -33.98}}, textString = "Cavity"), Text(origin = {0.742849, 12.7626}, extent = {{-52.37, 30.56}, {52.37, -30.56}}, textString = "Heat"), Text(origin = {2.22528, -43.7642}, extent = {{-61.28, 22.7}, {61.28, -22.7}}, textString = "Balance")}));
    end CavityHeatBalance;

    model DNIReduction_AreaFraction "Outputs area-based fraction of DNI that enters cassette but is not intercepted by modules, due to array geometry/transient orientation."
      Modelica.Blocks.Interfaces.RealOutput DNI_out "DNI after area fraction reduction" annotation(Placement(visible = true, transformation(origin = {100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput DNI_in "DNI before area fraction reduction" annotation(Placement(visible = true, transformation(origin = {-100, 80}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 80}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Math.Product product1 "Multiplication of DNI area fraction" annotation(Placement(visible = true, transformation(origin = {20, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput arrayPitch "pitch (up/down) angle of 2axis tracking array (rads)" annotation(Placement(visible = true, transformation(origin = {-100, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput arrayYaw "yaw (left/right) angle of tracking array (in radians)" annotation(Placement(visible = true, transformation(origin = {-100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Tables.CombiTable2D AreaFraction(table = [0.0, -1.5708, -0.41888, -0.40143, -0.38397, -0.36652, -0.34907, -0.33161, -0.31416, -0.29671, -0.27925, -0.2618, -0.24435, -0.22689, -0.20944, -0.19199, -0.17453, -0.15708, -0.13963, -0.12217, -0.10472, -0.08727, -0.06981, -0.05236, -0.03491, -0.01745, 0.0, 0.01745, 0.03491, 0.05236, 0.06981, 0.08727, 0.10472, 0.12217, 0.13963, 0.15708, 0.17453, 0.19199, 0.20944, 0.22689, 0.24435, 0.2618, 0.27925, 0.29671, 0.31416, 0.33161, 0.34907, 0.36652, 0.38397, 0.40143, 0.41888, 1.5708; -1.5708, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 0.01043, 0.02084, 0.03126, 0.04168, 0.05209, 0.06251, 0.07292999999999999, 0.08334, 0.09376, 0.10418, 0.11459, 0.12501, 0.13543, 0.14584, 0.15626, 0.16668, 0.15626, 0.14584, 0.13543, 0.12501, 0.11459, 0.10418, 0.09376, 0.08334, 0.07292999999999999, 0.06251, 0.05209, 0.04168, 0.03126, 0.02084, 0.01043, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005; -0.61087, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 0.01043, 0.02084, 0.03126, 0.04168, 0.05209, 0.06251, 0.07292999999999999, 0.08334, 0.09376, 0.10418, 0.11459, 0.12501, 0.13543, 0.14584, 0.15626, 0.16668, 0.15626, 0.14584, 0.13543, 0.12501, 0.11459, 0.10418, 0.09376, 0.08334, 0.07292999999999999, 0.06251, 0.05209, 0.04168, 0.03126, 0.02084, 0.01043, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005; -0.59341, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 0.01043, 0.02084, 0.03126, 0.04168, 0.05209, 0.06251, 0.07292999999999999, 0.08334, 0.09376, 0.10418, 0.11459, 0.12501, 0.13543, 0.14584, 0.15626, 0.16668, 0.15626, 0.14584, 0.13543, 0.12501, 0.11459, 0.10418, 0.09376, 0.08334, 0.07292999999999999, 0.06251, 0.05209, 0.04168, 0.03126, 0.02084, 0.01043, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005; -0.57596, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 0.01043, 0.02084, 0.03126, 0.04168, 0.05209, 0.06251, 0.07292999999999999, 0.08334, 0.09376, 0.10418, 0.11459, 0.12501, 0.13543, 0.14584, 0.15626, 0.16668, 0.15626, 0.14584, 0.13543, 0.12501, 0.11459, 0.10418, 0.09376, 0.08334, 0.07292999999999999, 0.06251, 0.05209, 0.04168, 0.03126, 0.02084, 0.01043, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005; -0.55851, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 0.01043, 0.02084, 0.03126, 0.04168, 0.05209, 0.06251, 0.07292999999999999, 0.08334, 0.09376, 0.10418, 0.11459, 0.12501, 0.13543, 0.14584, 0.15626, 0.16668, 0.15626, 0.14584, 0.13543, 0.12501, 0.11459, 0.10418, 0.09376, 0.08334, 0.07292999999999999, 0.06251, 0.05209, 0.04168, 0.03126, 0.02084, 0.01043, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005; -0.54105, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 0.01043, 0.02084, 0.03126, 0.04168, 0.05209, 0.06251, 0.07292999999999999, 0.08334, 0.09376, 0.10418, 0.11459, 0.12501, 0.13543, 0.14584, 0.15626, 0.16668, 0.15626, 0.14584, 0.13543, 0.12501, 0.11459, 0.10418, 0.09376, 0.08334, 0.07292999999999999, 0.06251, 0.05209, 0.04168, 0.03126, 0.02084, 0.01043, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005; -0.5236, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 0.01043, 0.02084, 0.03126, 0.04168, 0.05209, 0.06251, 0.07292999999999999, 0.08334, 0.09376, 0.10418, 0.11459, 0.12501, 0.13543, 0.14584, 0.15626, 0.16668, 0.15626, 0.14584, 0.13543, 0.12501, 0.11459, 0.10418, 0.09376, 0.08334, 0.07292999999999999, 0.06251, 0.05209, 0.04168, 0.03126, 0.02084, 0.01043, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005; -0.50615, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 0.01043, 0.02084, 0.03126, 0.04168, 0.05209, 0.06251, 0.07292999999999999, 0.08334, 0.09376, 0.10418, 0.11459, 0.12501, 0.13543, 0.14584, 0.15626, 0.16668, 0.15626, 0.14584, 0.13543, 0.12501, 0.11459, 0.10418, 0.09376, 0.08334, 0.07292999999999999, 0.06251, 0.05209, 0.04168, 0.03126, 0.02084, 0.01043, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005; -0.48869, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 0.01043, 0.02084, 0.03126, 0.04168, 0.05209, 0.06251, 0.07292999999999999, 0.08334, 0.09376, 0.10418, 0.11459, 0.12501, 0.13543, 0.14584, 0.15626, 0.16668, 0.15626, 0.14584, 0.13543, 0.12501, 0.11459, 0.10418, 0.09376, 0.08334, 0.07292999999999999, 0.06251, 0.05209, 0.04168, 0.03126, 0.02084, 0.01043, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005; -0.47124, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 0.01043, 0.02084, 0.03126, 0.04168, 0.05209, 0.06251, 0.07292999999999999, 0.08334, 0.09376, 0.10418, 0.11459, 0.12501, 0.13543, 0.14584, 0.15626, 0.16668, 0.15626, 0.14584, 0.13543, 0.12501, 0.11459, 0.10418, 0.09376, 0.08334, 0.07292999999999999, 0.06251, 0.05209, 0.04168, 0.03126, 0.02084, 0.01043, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005; -0.45379, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 0.01043, 0.02084, 0.03126, 0.04168, 0.05209, 0.06251, 0.07292999999999999, 0.08334, 0.09376, 0.10418, 0.11459, 0.12501, 0.13543, 0.14584, 0.15626, 0.16668, 0.15626, 0.14584, 0.13543, 0.12501, 0.11459, 0.10418, 0.09376, 0.08334, 0.07292999999999999, 0.06251, 0.05209, 0.04168, 0.03126, 0.02084, 0.01043, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005; -0.43633, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 0.01043, 0.02084, 0.03126, 0.04168, 0.05209, 0.06251, 0.07292999999999999, 0.08334, 0.09376, 0.10418, 0.11459, 0.12501, 0.13543, 0.14584, 0.15626, 0.16668, 0.15626, 0.14584, 0.13543, 0.12501, 0.11459, 0.10418, 0.09376, 0.08334, 0.07292999999999999, 0.06251, 0.05209, 0.04168, 0.03126, 0.02084, 0.01043, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005; -0.41888, 0.00523, 0.00523, 0.00523, 0.00523, 0.00523, 0.00523, 0.00523, 0.00523, 0.00523, 0.00523, 0.01559, 0.02595, 0.03631, 0.04668, 0.05704, 0.0674, 0.07776, 0.08813, 0.09848999999999999, 0.10885, 0.11921, 0.12958, 0.13994, 0.1503, 0.16066, 0.17102, 0.16066, 0.1503, 0.13994, 0.12958, 0.11921, 0.10885, 0.09848999999999999, 0.08813, 0.07776, 0.0674, 0.05704, 0.04668, 0.03631, 0.02595, 0.01559, 0.00523, 0.00523, 0.00523, 0.00523, 0.00523, 0.00523, 0.00523, 0.00523, 0.00523, 0.00523; -0.40143, 0.01044, 0.01044, 0.01044, 0.01044, 0.01044, 0.01044, 0.01044, 0.01044, 0.01044, 0.01044, 0.02075, 0.03106, 0.04137, 0.05168, 0.06198, 0.07228999999999999, 0.08260000000000001, 0.09291000000000001, 0.10322, 0.11352, 0.12383, 0.13414, 0.14445, 0.15476, 0.16506, 0.17537, 0.16506, 0.15476, 0.14445, 0.13414, 0.12383, 0.11352, 0.10322, 0.09291000000000001, 0.08260000000000001, 0.07228999999999999, 0.06198, 0.05168, 0.04137, 0.03106, 0.02075, 0.01044, 0.01044, 0.01044, 0.01044, 0.01044, 0.01044, 0.01044, 0.01044, 0.01044, 0.01044; -0.38397, 0.01566, 0.01566, 0.01566, 0.01566, 0.01566, 0.01566, 0.01566, 0.01566, 0.01566, 0.01566, 0.02592, 0.03617, 0.04642, 0.05668, 0.06693, 0.07718, 0.08744, 0.09769, 0.10794, 0.1182, 0.12845, 0.13871, 0.14896, 0.15921, 0.16947, 0.17972, 0.16947, 0.15921, 0.14896, 0.13871, 0.12845, 0.1182, 0.10794, 0.09769, 0.08744, 0.07718, 0.06693, 0.05668, 0.04642, 0.03617, 0.02592, 0.01566, 0.01566, 0.01566, 0.01566, 0.01566, 0.01566, 0.01566, 0.01566, 0.01566, 0.01566; -0.36652, 0.02088, 0.02088, 0.02088, 0.02088, 0.02088, 0.02088, 0.02088, 0.02088, 0.02088, 0.02088, 0.03108, 0.04128, 0.05148, 0.06168, 0.07188, 0.08208, 0.09227, 0.10247, 0.11267, 0.12287, 0.13307, 0.14327, 0.15347, 0.16367, 0.17387, 0.18407, 0.17387, 0.16367, 0.15347, 0.14327, 0.13307, 0.12287, 0.11267, 0.10247, 0.09227, 0.08208, 0.07188, 0.06168, 0.05148, 0.04128, 0.03108, 0.02088, 0.02088, 0.02088, 0.02088, 0.02088, 0.02088, 0.02088, 0.02088, 0.02088, 0.02088; -0.34907, 0.0261, 0.0261, 0.0261, 0.0261, 0.0261, 0.0261, 0.0261, 0.0261, 0.0261, 0.0261, 0.03624, 0.04639, 0.05653, 0.06668, 0.07682, 0.08697000000000001, 0.09711, 0.10726, 0.1174, 0.12755, 0.13769, 0.14784, 0.15798, 0.16813, 0.17827, 0.18842, 0.17827, 0.16813, 0.15798, 0.14784, 0.13769, 0.12755, 0.1174, 0.10726, 0.09711, 0.08697000000000001, 0.07682, 0.06668, 0.05653, 0.04639, 0.03624, 0.0261, 0.0261, 0.0261, 0.0261, 0.0261, 0.0261, 0.0261, 0.0261, 0.0261, 0.0261; -0.33161, 0.03131, 0.03131, 0.03131, 0.03131, 0.03131, 0.03131, 0.03131, 0.03131, 0.03131, 0.03131, 0.0414, 0.0515, 0.06159, 0.07167999999999999, 0.08177, 0.09186, 0.10195, 0.11204, 0.12213, 0.13222, 0.14231, 0.1524, 0.16249, 0.17258, 0.18267, 0.19276, 0.18267, 0.17258, 0.16249, 0.1524, 0.14231, 0.13222, 0.12213, 0.11204, 0.10195, 0.09186, 0.08177, 0.07167999999999999, 0.06159, 0.0515, 0.0414, 0.03131, 0.03131, 0.03131, 0.03131, 0.03131, 0.03131, 0.03131, 0.03131, 0.03131, 0.03131; -0.31416, 0.03653, 0.03653, 0.03653, 0.03653, 0.03653, 0.03653, 0.03653, 0.03653, 0.03653, 0.03653, 0.04657, 0.0566, 0.06664, 0.07668, 0.08671, 0.09675, 0.10679, 0.11682, 0.12686, 0.13689, 0.14693, 0.15697, 0.167, 0.17704, 0.18708, 0.19711, 0.18708, 0.17704, 0.167, 0.15697, 0.14693, 0.13689, 0.12686, 0.11682, 0.10679, 0.09675, 0.08671, 0.07668, 0.06664, 0.0566, 0.04657, 0.03653, 0.03653, 0.03653, 0.03653, 0.03653, 0.03653, 0.03653, 0.03653, 0.03653, 0.03653; -0.29671, 0.04175, 0.04175, 0.04175, 0.04175, 0.04175, 0.04175, 0.04175, 0.04175, 0.04175, 0.04175, 0.05173, 0.06171, 0.07169, 0.08168, 0.09166000000000001, 0.10164, 0.11162, 0.1216, 0.13159, 0.14157, 0.15155, 0.16153, 0.17151, 0.1815, 0.19148, 0.20146, 0.19148, 0.1815, 0.17151, 0.16153, 0.15155, 0.14157, 0.13159, 0.1216, 0.11162, 0.10164, 0.09166000000000001, 0.08168, 0.07169, 0.06171, 0.05173, 0.04175, 0.04175, 0.04175, 0.04175, 0.04175, 0.04175, 0.04175, 0.04175, 0.04175, 0.04175; -0.27925, 0.04697, 0.04697, 0.04697, 0.04697, 0.04697, 0.04697, 0.04697, 0.04697, 0.04697, 0.04697, 0.05689, 0.06682, 0.07675, 0.08667999999999999, 0.09660000000000001, 0.10653, 0.11646, 0.12639, 0.13631, 0.14624, 0.15617, 0.1661, 0.17602, 0.18595, 0.19588, 0.20581, 0.19588, 0.18595, 0.17602, 0.1661, 0.15617, 0.14624, 0.13631, 0.12639, 0.11646, 0.10653, 0.09660000000000001, 0.08667999999999999, 0.07675, 0.06682, 0.05689, 0.04697, 0.04697, 0.04697, 0.04697, 0.04697, 0.04697, 0.04697, 0.04697, 0.04697, 0.04697; -0.2618, 0.05218, 0.05218, 0.05218, 0.05218, 0.05218, 0.05218, 0.05218, 0.05218, 0.05218, 0.05218, 0.06206, 0.07192999999999999, 0.0818, 0.09168, 0.10155, 0.11142, 0.1213, 0.13117, 0.14104, 0.15092, 0.16079, 0.17066, 0.18054, 0.19041, 0.20028, 0.21015, 0.20028, 0.19041, 0.18054, 0.17066, 0.16079, 0.15092, 0.14104, 0.13117, 0.1213, 0.11142, 0.10155, 0.09168, 0.0818, 0.07192999999999999, 0.06206, 0.05218, 0.05218, 0.05218, 0.05218, 0.05218, 0.05218, 0.05218, 0.05218, 0.05218, 0.05218; -0.24435, 0.0574, 0.0574, 0.0574, 0.0574, 0.0574, 0.0574, 0.0574, 0.0574, 0.0574, 0.0574, 0.06722, 0.07704, 0.08686000000000001, 0.09668, 0.1065, 0.11631, 0.12613, 0.13595, 0.14577, 0.15559, 0.16541, 0.17523, 0.18505, 0.19487, 0.20468, 0.2145, 0.20468, 0.19487, 0.18505, 0.17523, 0.16541, 0.15559, 0.14577, 0.13595, 0.12613, 0.11631, 0.1065, 0.09668, 0.08686000000000001, 0.07704, 0.06722, 0.0574, 0.0574, 0.0574, 0.0574, 0.0574, 0.0574, 0.0574, 0.0574, 0.0574, 0.0574; -0.22689, 0.06262, 0.06262, 0.06262, 0.06262, 0.06262, 0.06262, 0.06262, 0.06262, 0.06262, 0.06262, 0.07238, 0.08215, 0.09191000000000001, 0.10168, 0.11144, 0.12121, 0.13097, 0.14073, 0.1505, 0.16026, 0.17003, 0.17979, 0.18956, 0.19932, 0.20909, 0.21885, 0.20909, 0.19932, 0.18956, 0.17979, 0.17003, 0.16026, 0.1505, 0.14073, 0.13097, 0.12121, 0.11144, 0.10168, 0.09191000000000001, 0.08215, 0.07238, 0.06262, 0.06262, 0.06262, 0.06262, 0.06262, 0.06262, 0.06262, 0.06262, 0.06262, 0.06262; -0.20944, 0.06784, 0.06784, 0.06784, 0.06784, 0.06784, 0.06784, 0.06784, 0.06784, 0.06784, 0.06784, 0.07754999999999999, 0.08726, 0.09697, 0.10668, 0.11639, 0.1261, 0.13581, 0.14552, 0.15523, 0.16494, 0.17465, 0.18436, 0.19407, 0.20378, 0.21349, 0.2232, 0.21349, 0.20378, 0.19407, 0.18436, 0.17465, 0.16494, 0.15523, 0.14552, 0.13581, 0.1261, 0.11639, 0.10668, 0.09697, 0.08726, 0.07754999999999999, 0.06784, 0.06784, 0.06784, 0.06784, 0.06784, 0.06784, 0.06784, 0.06784, 0.06784, 0.06784; -0.19199, 0.07305, 0.07305, 0.07305, 0.07305, 0.07305, 0.07305, 0.07305, 0.07305, 0.07305, 0.07305, 0.08271000000000001, 0.09236999999999999, 0.10202, 0.11168, 0.12133, 0.13099, 0.14064, 0.1503, 0.15996, 0.16961, 0.17927, 0.18892, 0.19858, 0.20823, 0.21789, 0.22755, 0.21789, 0.20823, 0.19858, 0.18892, 0.17927, 0.16961, 0.15996, 0.1503, 0.14064, 0.13099, 0.12133, 0.11168, 0.10202, 0.09236999999999999, 0.08271000000000001, 0.07305, 0.07305, 0.07305, 0.07305, 0.07305, 0.07305, 0.07305, 0.07305, 0.07305, 0.07305; -0.17453, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.08787, 0.09747, 0.10708, 0.11668, 0.12628, 0.13588, 0.14548, 0.15508, 0.16468, 0.17429, 0.18389, 0.19349, 0.20309, 0.21269, 0.22229, 0.23189, 0.22229, 0.21269, 0.20309, 0.19349, 0.18389, 0.17429, 0.16468, 0.15508, 0.14548, 0.13588, 0.12628, 0.11668, 0.10708, 0.09747, 0.08787, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001; -0.15708, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.09304, 0.10258, 0.11213, 0.12168, 0.13122, 0.14077, 0.15032, 0.15987, 0.16941, 0.17896, 0.18851, 0.19805, 0.2076, 0.21715, 0.22669, 0.23624, 0.22669, 0.21715, 0.2076, 0.19805, 0.18851, 0.17896, 0.16941, 0.15987, 0.15032, 0.14077, 0.13122, 0.12168, 0.11213, 0.10258, 0.09304, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999; -0.13963, 0.08871, 0.08871, 0.08871, 0.08871, 0.08871, 0.08871, 0.08871, 0.08871, 0.08871, 0.08871, 0.0982, 0.10769, 0.11718, 0.12668, 0.13617, 0.14566, 0.15515, 0.16465, 0.17414, 0.18363, 0.19313, 0.20262, 0.21211, 0.2216, 0.2311, 0.24059, 0.2311, 0.2216, 0.21211, 0.20262, 0.19313, 0.18363, 0.17414, 0.16465, 0.15515, 0.14566, 0.13617, 0.12668, 0.11718, 0.10769, 0.0982, 0.08871, 0.08871, 0.08871, 0.08871, 0.08871, 0.08871, 0.08871, 0.08871, 0.08871, 0.08871; -0.12217, 0.09392, 0.09392, 0.09392, 0.09392, 0.09392, 0.09392, 0.09392, 0.09392, 0.09392, 0.09392, 0.10336, 0.1128, 0.12224, 0.13168, 0.14112, 0.15055, 0.15999, 0.16943, 0.17887, 0.18831, 0.19775, 0.20718, 0.21662, 0.22606, 0.2355, 0.24494, 0.2355, 0.22606, 0.21662, 0.20718, 0.19775, 0.18831, 0.17887, 0.16943, 0.15999, 0.15055, 0.14112, 0.13168, 0.12224, 0.1128, 0.10336, 0.09392, 0.09392, 0.09392, 0.09392, 0.09392, 0.09392, 0.09392, 0.09392, 0.09392, 0.09392; -0.10472, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.10852, 0.11791, 0.12729, 0.13668, 0.14606, 0.15544, 0.16483, 0.17421, 0.1836, 0.19298, 0.20237, 0.21175, 0.22113, 0.23052, 0.2399, 0.24929, 0.2399, 0.23052, 0.22113, 0.21175, 0.20237, 0.19298, 0.1836, 0.17421, 0.16483, 0.15544, 0.14606, 0.13668, 0.12729, 0.11791, 0.10852, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001; -0.08727, 0.10436, 0.10436, 0.10436, 0.10436, 0.10436, 0.10436, 0.10436, 0.10436, 0.10436, 0.10436, 0.11369, 0.12302, 0.13235, 0.14168, 0.15101, 0.16034, 0.16967, 0.179, 0.18833, 0.19765, 0.20698, 0.21631, 0.22564, 0.23497, 0.2443, 0.25363, 0.2443, 0.23497, 0.22564, 0.21631, 0.20698, 0.19765, 0.18833, 0.179, 0.16967, 0.16034, 0.15101, 0.14168, 0.13235, 0.12302, 0.11369, 0.10436, 0.10436, 0.10436, 0.10436, 0.10436, 0.10436, 0.10436, 0.10436, 0.10436, 0.10436; -0.06981, 0.10958, 0.10958, 0.10958, 0.10958, 0.10958, 0.10958, 0.10958, 0.10958, 0.10958, 0.10958, 0.11885, 0.12813, 0.1374, 0.14668, 0.15595, 0.16523, 0.1745, 0.18378, 0.19305, 0.20233, 0.2116, 0.22088, 0.23015, 0.23943, 0.24871, 0.25798, 0.24871, 0.23943, 0.23015, 0.22088, 0.2116, 0.20233, 0.19305, 0.18378, 0.1745, 0.16523, 0.15595, 0.14668, 0.1374, 0.12813, 0.11885, 0.10958, 0.10958, 0.10958, 0.10958, 0.10958, 0.10958, 0.10958, 0.10958, 0.10958, 0.10958; -0.05236, 0.11479, 0.11479, 0.11479, 0.11479, 0.11479, 0.11479, 0.11479, 0.11479, 0.11479, 0.11479, 0.12401, 0.13323, 0.14246, 0.15168, 0.1609, 0.17012, 0.17934, 0.18856, 0.19778, 0.207, 0.21622, 0.22544, 0.23467, 0.24389, 0.25311, 0.26233, 0.25311, 0.24389, 0.23467, 0.22544, 0.21622, 0.207, 0.19778, 0.18856, 0.17934, 0.17012, 0.1609, 0.15168, 0.14246, 0.13323, 0.12401, 0.11479, 0.11479, 0.11479, 0.11479, 0.11479, 0.11479, 0.11479, 0.11479, 0.11479, 0.11479; -0.03491, 0.12001, 0.12001, 0.12001, 0.12001, 0.12001, 0.12001, 0.12001, 0.12001, 0.12001, 0.12001, 0.12918, 0.13834, 0.14751, 0.15668, 0.16584, 0.17501, 0.18418, 0.19334, 0.20251, 0.21168, 0.22084, 0.23001, 0.23918, 0.24834, 0.25751, 0.26668, 0.25751, 0.24834, 0.23918, 0.23001, 0.22084, 0.21168, 0.20251, 0.19334, 0.18418, 0.17501, 0.16584, 0.15668, 0.14751, 0.13834, 0.12918, 0.12001, 0.12001, 0.12001, 0.12001, 0.12001, 0.12001, 0.12001, 0.12001, 0.12001, 0.12001; -0.01745, 0.12523, 0.12523, 0.12523, 0.12523, 0.12523, 0.12523, 0.12523, 0.12523, 0.12523, 0.12523, 0.13434, 0.14345, 0.15256, 0.16168, 0.17079, 0.1799, 0.18901, 0.19813, 0.20724, 0.21635, 0.22546, 0.23458, 0.24369, 0.2528, 0.26191, 0.27102, 0.26191, 0.2528, 0.24369, 0.23458, 0.22546, 0.21635, 0.20724, 0.19813, 0.18901, 0.1799, 0.17079, 0.16168, 0.15256, 0.14345, 0.13434, 0.12523, 0.12523, 0.12523, 0.12523, 0.12523, 0.12523, 0.12523, 0.12523, 0.12523, 0.12523; 0.0, 0.13044, 0.13044, 0.13044, 0.13044, 0.13044, 0.13044, 0.13044, 0.13044, 0.13044, 0.13044, 0.1395, 0.14856, 0.15762, 0.16668, 0.17573, 0.18479, 0.19385, 0.20291, 0.21197, 0.22102, 0.23008, 0.23914, 0.2482, 0.25726, 0.26631, 0.27537, 0.26631, 0.25726, 0.2482, 0.23914, 0.23008, 0.22102, 0.21197, 0.20291, 0.19385, 0.18479, 0.17573, 0.16668, 0.15762, 0.14856, 0.1395, 0.13044, 0.13044, 0.13044, 0.13044, 0.13044, 0.13044, 0.13044, 0.13044, 0.13044, 0.13044; 0.01745, 0.12523, 0.12523, 0.12523, 0.12523, 0.12523, 0.12523, 0.12523, 0.12523, 0.12523, 0.12523, 0.13434, 0.14345, 0.15256, 0.16168, 0.17079, 0.1799, 0.18901, 0.19813, 0.20724, 0.21635, 0.22546, 0.23458, 0.24369, 0.2528, 0.26191, 0.27102, 0.26191, 0.2528, 0.24369, 0.23458, 0.22546, 0.21635, 0.20724, 0.19813, 0.18901, 0.1799, 0.17079, 0.16168, 0.15256, 0.14345, 0.13434, 0.12523, 0.12523, 0.12523, 0.12523, 0.12523, 0.12523, 0.12523, 0.12523, 0.12523, 0.12523; 0.03491, 0.12001, 0.12001, 0.12001, 0.12001, 0.12001, 0.12001, 0.12001, 0.12001, 0.12001, 0.12001, 0.12918, 0.13834, 0.14751, 0.15668, 0.16584, 0.17501, 0.18418, 0.19334, 0.20251, 0.21168, 0.22084, 0.23001, 0.23918, 0.24834, 0.25751, 0.26668, 0.25751, 0.24834, 0.23918, 0.23001, 0.22084, 0.21168, 0.20251, 0.19334, 0.18418, 0.17501, 0.16584, 0.15668, 0.14751, 0.13834, 0.12918, 0.12001, 0.12001, 0.12001, 0.12001, 0.12001, 0.12001, 0.12001, 0.12001, 0.12001, 0.12001; 0.05236, 0.11479, 0.11479, 0.11479, 0.11479, 0.11479, 0.11479, 0.11479, 0.11479, 0.11479, 0.11479, 0.12401, 0.13323, 0.14246, 0.15168, 0.1609, 0.17012, 0.17934, 0.18856, 0.19778, 0.207, 0.21622, 0.22544, 0.23467, 0.24389, 0.25311, 0.26233, 0.25311, 0.24389, 0.23467, 0.22544, 0.21622, 0.207, 0.19778, 0.18856, 0.17934, 0.17012, 0.1609, 0.15168, 0.14246, 0.13323, 0.12401, 0.11479, 0.11479, 0.11479, 0.11479, 0.11479, 0.11479, 0.11479, 0.11479, 0.11479, 0.11479; 0.06981, 0.10958, 0.10958, 0.10958, 0.10958, 0.10958, 0.10958, 0.10958, 0.10958, 0.10958, 0.10958, 0.11885, 0.12813, 0.1374, 0.14668, 0.15595, 0.16523, 0.1745, 0.18378, 0.19305, 0.20233, 0.2116, 0.22088, 0.23015, 0.23943, 0.24871, 0.25798, 0.24871, 0.23943, 0.23015, 0.22088, 0.2116, 0.20233, 0.19305, 0.18378, 0.1745, 0.16523, 0.15595, 0.14668, 0.1374, 0.12813, 0.11885, 0.10958, 0.10958, 0.10958, 0.10958, 0.10958, 0.10958, 0.10958, 0.10958, 0.10958, 0.10958; 0.08727, 0.10436, 0.10436, 0.10436, 0.10436, 0.10436, 0.10436, 0.10436, 0.10436, 0.10436, 0.10436, 0.11369, 0.12302, 0.13235, 0.14168, 0.15101, 0.16034, 0.16967, 0.179, 0.18833, 0.19765, 0.20698, 0.21631, 0.22564, 0.23497, 0.2443, 0.25363, 0.2443, 0.23497, 0.22564, 0.21631, 0.20698, 0.19765, 0.18833, 0.179, 0.16967, 0.16034, 0.15101, 0.14168, 0.13235, 0.12302, 0.11369, 0.10436, 0.10436, 0.10436, 0.10436, 0.10436, 0.10436, 0.10436, 0.10436, 0.10436, 0.10436; 0.10472, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.10852, 0.11791, 0.12729, 0.13668, 0.14606, 0.15544, 0.16483, 0.17421, 0.1836, 0.19298, 0.20237, 0.21175, 0.22113, 0.23052, 0.2399, 0.24929, 0.2399, 0.23052, 0.22113, 0.21175, 0.20237, 0.19298, 0.1836, 0.17421, 0.16483, 0.15544, 0.14606, 0.13668, 0.12729, 0.11791, 0.10852, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001, 0.09914000000000001; 0.12217, 0.09392, 0.09392, 0.09392, 0.09392, 0.09392, 0.09392, 0.09392, 0.09392, 0.09392, 0.09392, 0.10336, 0.1128, 0.12224, 0.13168, 0.14112, 0.15055, 0.15999, 0.16943, 0.17887, 0.18831, 0.19775, 0.20718, 0.21662, 0.22606, 0.2355, 0.24494, 0.2355, 0.22606, 0.21662, 0.20718, 0.19775, 0.18831, 0.17887, 0.16943, 0.15999, 0.15055, 0.14112, 0.13168, 0.12224, 0.1128, 0.10336, 0.09392, 0.09392, 0.09392, 0.09392, 0.09392, 0.09392, 0.09392, 0.09392, 0.09392, 0.09392; 0.13963, 0.08871, 0.08871, 0.08871, 0.08871, 0.08871, 0.08871, 0.08871, 0.08871, 0.08871, 0.08871, 0.0982, 0.10769, 0.11718, 0.12668, 0.13617, 0.14566, 0.15515, 0.16465, 0.17414, 0.18363, 0.19313, 0.20262, 0.21211, 0.2216, 0.2311, 0.24059, 0.2311, 0.2216, 0.21211, 0.20262, 0.19313, 0.18363, 0.17414, 0.16465, 0.15515, 0.14566, 0.13617, 0.12668, 0.11718, 0.10769, 0.0982, 0.08871, 0.08871, 0.08871, 0.08871, 0.08871, 0.08871, 0.08871, 0.08871, 0.08871, 0.08871; 0.15708, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.09304, 0.10258, 0.11213, 0.12168, 0.13122, 0.14077, 0.15032, 0.15987, 0.16941, 0.17896, 0.18851, 0.19805, 0.2076, 0.21715, 0.22669, 0.23624, 0.22669, 0.21715, 0.2076, 0.19805, 0.18851, 0.17896, 0.16941, 0.15987, 0.15032, 0.14077, 0.13122, 0.12168, 0.11213, 0.10258, 0.09304, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999, 0.08348999999999999; 0.17453, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.08787, 0.09747, 0.10708, 0.11668, 0.12628, 0.13588, 0.14548, 0.15508, 0.16468, 0.17429, 0.18389, 0.19349, 0.20309, 0.21269, 0.22229, 0.23189, 0.22229, 0.21269, 0.20309, 0.19349, 0.18389, 0.17429, 0.16468, 0.15508, 0.14548, 0.13588, 0.12628, 0.11668, 0.10708, 0.09747, 0.08787, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001, 0.07827000000000001; 0.19199, 0.07305, 0.07305, 0.07305, 0.07305, 0.07305, 0.07305, 0.07305, 0.07305, 0.07305, 0.07305, 0.08271000000000001, 0.09236999999999999, 0.10202, 0.11168, 0.12133, 0.13099, 0.14064, 0.1503, 0.15996, 0.16961, 0.17927, 0.18892, 0.19858, 0.20823, 0.21789, 0.22755, 0.21789, 0.20823, 0.19858, 0.18892, 0.17927, 0.16961, 0.15996, 0.1503, 0.14064, 0.13099, 0.12133, 0.11168, 0.10202, 0.09236999999999999, 0.08271000000000001, 0.07305, 0.07305, 0.07305, 0.07305, 0.07305, 0.07305, 0.07305, 0.07305, 0.07305, 0.07305; 0.20944, 0.06784, 0.06784, 0.06784, 0.06784, 0.06784, 0.06784, 0.06784, 0.06784, 0.06784, 0.06784, 0.07754999999999999, 0.08726, 0.09697, 0.10668, 0.11639, 0.1261, 0.13581, 0.14552, 0.15523, 0.16494, 0.17465, 0.18436, 0.19407, 0.20378, 0.21349, 0.2232, 0.21349, 0.20378, 0.19407, 0.18436, 0.17465, 0.16494, 0.15523, 0.14552, 0.13581, 0.1261, 0.11639, 0.10668, 0.09697, 0.08726, 0.07754999999999999, 0.06784, 0.06784, 0.06784, 0.06784, 0.06784, 0.06784, 0.06784, 0.06784, 0.06784, 0.06784; 0.22689, 0.06262, 0.06262, 0.06262, 0.06262, 0.06262, 0.06262, 0.06262, 0.06262, 0.06262, 0.06262, 0.07238, 0.08215, 0.09191000000000001, 0.10168, 0.11144, 0.12121, 0.13097, 0.14073, 0.1505, 0.16026, 0.17003, 0.17979, 0.18956, 0.19932, 0.20909, 0.21885, 0.20909, 0.19932, 0.18956, 0.17979, 0.17003, 0.16026, 0.1505, 0.14073, 0.13097, 0.12121, 0.11144, 0.10168, 0.09191000000000001, 0.08215, 0.07238, 0.06262, 0.06262, 0.06262, 0.06262, 0.06262, 0.06262, 0.06262, 0.06262, 0.06262, 0.06262; 0.24435, 0.0574, 0.0574, 0.0574, 0.0574, 0.0574, 0.0574, 0.0574, 0.0574, 0.0574, 0.0574, 0.06722, 0.07704, 0.08686000000000001, 0.09668, 0.1065, 0.11631, 0.12613, 0.13595, 0.14577, 0.15559, 0.16541, 0.17523, 0.18505, 0.19487, 0.20468, 0.2145, 0.20468, 0.19487, 0.18505, 0.17523, 0.16541, 0.15559, 0.14577, 0.13595, 0.12613, 0.11631, 0.1065, 0.09668, 0.08686000000000001, 0.07704, 0.06722, 0.0574, 0.0574, 0.0574, 0.0574, 0.0574, 0.0574, 0.0574, 0.0574, 0.0574, 0.0574; 0.2618, 0.05218, 0.05218, 0.05218, 0.05218, 0.05218, 0.05218, 0.05218, 0.05218, 0.05218, 0.05218, 0.06206, 0.07192999999999999, 0.0818, 0.09168, 0.10155, 0.11142, 0.1213, 0.13117, 0.14104, 0.15092, 0.16079, 0.17066, 0.18054, 0.19041, 0.20028, 0.21015, 0.20028, 0.19041, 0.18054, 0.17066, 0.16079, 0.15092, 0.14104, 0.13117, 0.1213, 0.11142, 0.10155, 0.09168, 0.0818, 0.07192999999999999, 0.06206, 0.05218, 0.05218, 0.05218, 0.05218, 0.05218, 0.05218, 0.05218, 0.05218, 0.05218, 0.05218; 0.27925, 0.04697, 0.04697, 0.04697, 0.04697, 0.04697, 0.04697, 0.04697, 0.04697, 0.04697, 0.04697, 0.05689, 0.06682, 0.07675, 0.08667999999999999, 0.09660000000000001, 0.10653, 0.11646, 0.12639, 0.13631, 0.14624, 0.15617, 0.1661, 0.17602, 0.18595, 0.19588, 0.20581, 0.19588, 0.18595, 0.17602, 0.1661, 0.15617, 0.14624, 0.13631, 0.12639, 0.11646, 0.10653, 0.09660000000000001, 0.08667999999999999, 0.07675, 0.06682, 0.05689, 0.04697, 0.04697, 0.04697, 0.04697, 0.04697, 0.04697, 0.04697, 0.04697, 0.04697, 0.04697; 0.29671, 0.04175, 0.04175, 0.04175, 0.04175, 0.04175, 0.04175, 0.04175, 0.04175, 0.04175, 0.04175, 0.05173, 0.06171, 0.07169, 0.08168, 0.09166000000000001, 0.10164, 0.11162, 0.1216, 0.13159, 0.14157, 0.15155, 0.16153, 0.17151, 0.1815, 0.19148, 0.20146, 0.19148, 0.1815, 0.17151, 0.16153, 0.15155, 0.14157, 0.13159, 0.1216, 0.11162, 0.10164, 0.09166000000000001, 0.08168, 0.07169, 0.06171, 0.05173, 0.04175, 0.04175, 0.04175, 0.04175, 0.04175, 0.04175, 0.04175, 0.04175, 0.04175, 0.04175; 0.31416, 0.03653, 0.03653, 0.03653, 0.03653, 0.03653, 0.03653, 0.03653, 0.03653, 0.03653, 0.03653, 0.04657, 0.0566, 0.06664, 0.07668, 0.08671, 0.09675, 0.10679, 0.11682, 0.12686, 0.13689, 0.14693, 0.15697, 0.167, 0.17704, 0.18708, 0.19711, 0.18708, 0.17704, 0.167, 0.15697, 0.14693, 0.13689, 0.12686, 0.11682, 0.10679, 0.09675, 0.08671, 0.07668, 0.06664, 0.0566, 0.04657, 0.03653, 0.03653, 0.03653, 0.03653, 0.03653, 0.03653, 0.03653, 0.03653, 0.03653, 0.03653; 0.33161, 0.03131, 0.03131, 0.03131, 0.03131, 0.03131, 0.03131, 0.03131, 0.03131, 0.03131, 0.03131, 0.0414, 0.0515, 0.06159, 0.07167999999999999, 0.08177, 0.09186, 0.10195, 0.11204, 0.12213, 0.13222, 0.14231, 0.1524, 0.16249, 0.17258, 0.18267, 0.19276, 0.18267, 0.17258, 0.16249, 0.1524, 0.14231, 0.13222, 0.12213, 0.11204, 0.10195, 0.09186, 0.08177, 0.07167999999999999, 0.06159, 0.0515, 0.0414, 0.03131, 0.03131, 0.03131, 0.03131, 0.03131, 0.03131, 0.03131, 0.03131, 0.03131, 0.03131; 0.34907, 0.0261, 0.0261, 0.0261, 0.0261, 0.0261, 0.0261, 0.0261, 0.0261, 0.0261, 0.0261, 0.03624, 0.04639, 0.05653, 0.06668, 0.07682, 0.08697000000000001, 0.09711, 0.10726, 0.1174, 0.12755, 0.13769, 0.14784, 0.15798, 0.16813, 0.17827, 0.18842, 0.17827, 0.16813, 0.15798, 0.14784, 0.13769, 0.12755, 0.1174, 0.10726, 0.09711, 0.08697000000000001, 0.07682, 0.06668, 0.05653, 0.04639, 0.03624, 0.0261, 0.0261, 0.0261, 0.0261, 0.0261, 0.0261, 0.0261, 0.0261, 0.0261, 0.0261; 0.36652, 0.02088, 0.02088, 0.02088, 0.02088, 0.02088, 0.02088, 0.02088, 0.02088, 0.02088, 0.02088, 0.03108, 0.04128, 0.05148, 0.06168, 0.07188, 0.08208, 0.09227, 0.10247, 0.11267, 0.12287, 0.13307, 0.14327, 0.15347, 0.16367, 0.17387, 0.18407, 0.17387, 0.16367, 0.15347, 0.14327, 0.13307, 0.12287, 0.11267, 0.10247, 0.09227, 0.08208, 0.07188, 0.06168, 0.05148, 0.04128, 0.03108, 0.02088, 0.02088, 0.02088, 0.02088, 0.02088, 0.02088, 0.02088, 0.02088, 0.02088, 0.02088; 0.38397, 0.01566, 0.01566, 0.01566, 0.01566, 0.01566, 0.01566, 0.01566, 0.01566, 0.01566, 0.01566, 0.02592, 0.03617, 0.04642, 0.05668, 0.06693, 0.07718, 0.08744, 0.09769, 0.10794, 0.1182, 0.12845, 0.13871, 0.14896, 0.15921, 0.16947, 0.17972, 0.16947, 0.15921, 0.14896, 0.13871, 0.12845, 0.1182, 0.10794, 0.09769, 0.08744, 0.07718, 0.06693, 0.05668, 0.04642, 0.03617, 0.02592, 0.01566, 0.01566, 0.01566, 0.01566, 0.01566, 0.01566, 0.01566, 0.01566, 0.01566, 0.01566; 0.40143, 0.01044, 0.01044, 0.01044, 0.01044, 0.01044, 0.01044, 0.01044, 0.01044, 0.01044, 0.01044, 0.02075, 0.03106, 0.04137, 0.05168, 0.06198, 0.07228999999999999, 0.08260000000000001, 0.09291000000000001, 0.10322, 0.11352, 0.12383, 0.13414, 0.14445, 0.15476, 0.16506, 0.17537, 0.16506, 0.15476, 0.14445, 0.13414, 0.12383, 0.11352, 0.10322, 0.09291000000000001, 0.08260000000000001, 0.07228999999999999, 0.06198, 0.05168, 0.04137, 0.03106, 0.02075, 0.01044, 0.01044, 0.01044, 0.01044, 0.01044, 0.01044, 0.01044, 0.01044, 0.01044, 0.01044; 0.41888, 0.00523, 0.00523, 0.00523, 0.00523, 0.00523, 0.00523, 0.00523, 0.00523, 0.00523, 0.00523, 0.01559, 0.02595, 0.03631, 0.04668, 0.05704, 0.0674, 0.07776, 0.08813, 0.09848999999999999, 0.10885, 0.11921, 0.12958, 0.13994, 0.1503, 0.16066, 0.17102, 0.16066, 0.1503, 0.13994, 0.12958, 0.11921, 0.10885, 0.09848999999999999, 0.08813, 0.07776, 0.0674, 0.05704, 0.04668, 0.03631, 0.02595, 0.01559, 0.00523, 0.00523, 0.00523, 0.00523, 0.00523, 0.00523, 0.00523, 0.00523, 0.00523, 0.00523; 0.43633, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 0.01043, 0.02084, 0.03126, 0.04168, 0.05209, 0.06251, 0.07292999999999999, 0.08334, 0.09376, 0.10418, 0.11459, 0.12501, 0.13543, 0.14584, 0.15626, 0.16668, 0.15626, 0.14584, 0.13543, 0.12501, 0.11459, 0.10418, 0.09376, 0.08334, 0.07292999999999999, 0.06251, 0.05209, 0.04168, 0.03126, 0.02084, 0.01043, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005; 0.45379, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 0.01043, 0.02084, 0.03126, 0.04168, 0.05209, 0.06251, 0.07292999999999999, 0.08334, 0.09376, 0.10418, 0.11459, 0.12501, 0.13543, 0.14584, 0.15626, 0.16668, 0.15626, 0.14584, 0.13543, 0.12501, 0.11459, 0.10418, 0.09376, 0.08334, 0.07292999999999999, 0.06251, 0.05209, 0.04168, 0.03126, 0.02084, 0.01043, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005; 0.47124, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 0.01043, 0.02084, 0.03126, 0.04168, 0.05209, 0.06251, 0.07292999999999999, 0.08334, 0.09376, 0.10418, 0.11459, 0.12501, 0.13543, 0.14584, 0.15626, 0.16668, 0.15626, 0.14584, 0.13543, 0.12501, 0.11459, 0.10418, 0.09376, 0.08334, 0.07292999999999999, 0.06251, 0.05209, 0.04168, 0.03126, 0.02084, 0.01043, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005; 0.48869, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 0.01043, 0.02084, 0.03126, 0.04168, 0.05209, 0.06251, 0.07292999999999999, 0.08334, 0.09376, 0.10418, 0.11459, 0.12501, 0.13543, 0.14584, 0.15626, 0.16668, 0.15626, 0.14584, 0.13543, 0.12501, 0.11459, 0.10418, 0.09376, 0.08334, 0.07292999999999999, 0.06251, 0.05209, 0.04168, 0.03126, 0.02084, 0.01043, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005; 0.50615, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 0.01043, 0.02084, 0.03126, 0.04168, 0.05209, 0.06251, 0.07292999999999999, 0.08334, 0.09376, 0.10418, 0.11459, 0.12501, 0.13543, 0.14584, 0.15626, 0.16668, 0.15626, 0.14584, 0.13543, 0.12501, 0.11459, 0.10418, 0.09376, 0.08334, 0.07292999999999999, 0.06251, 0.05209, 0.04168, 0.03126, 0.02084, 0.01043, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005; 0.5236, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 0.01043, 0.02084, 0.03126, 0.04168, 0.05209, 0.06251, 0.07292999999999999, 0.08334, 0.09376, 0.10418, 0.11459, 0.12501, 0.13543, 0.14584, 0.15626, 0.16668, 0.15626, 0.14584, 0.13543, 0.12501, 0.11459, 0.10418, 0.09376, 0.08334, 0.07292999999999999, 0.06251, 0.05209, 0.04168, 0.03126, 0.02084, 0.01043, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005; 0.54105, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 0.01043, 0.02084, 0.03126, 0.04168, 0.05209, 0.06251, 0.07292999999999999, 0.08334, 0.09376, 0.10418, 0.11459, 0.12501, 0.13543, 0.14584, 0.15626, 0.16668, 0.15626, 0.14584, 0.13543, 0.12501, 0.11459, 0.10418, 0.09376, 0.08334, 0.07292999999999999, 0.06251, 0.05209, 0.04168, 0.03126, 0.02084, 0.01043, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005; 0.55851, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 0.01043, 0.02084, 0.03126, 0.04168, 0.05209, 0.06251, 0.07292999999999999, 0.08334, 0.09376, 0.10418, 0.11459, 0.12501, 0.13543, 0.14584, 0.15626, 0.16668, 0.15626, 0.14584, 0.13543, 0.12501, 0.11459, 0.10418, 0.09376, 0.08334, 0.07292999999999999, 0.06251, 0.05209, 0.04168, 0.03126, 0.02084, 0.01043, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005; 0.57596, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 0.01043, 0.02084, 0.03126, 0.04168, 0.05209, 0.06251, 0.07292999999999999, 0.08334, 0.09376, 0.10418, 0.11459, 0.12501, 0.13543, 0.14584, 0.15626, 0.16668, 0.15626, 0.14584, 0.13543, 0.12501, 0.11459, 0.10418, 0.09376, 0.08334, 0.07292999999999999, 0.06251, 0.05209, 0.04168, 0.03126, 0.02084, 0.01043, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005; 0.59341, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 0.01043, 0.02084, 0.03126, 0.04168, 0.05209, 0.06251, 0.07292999999999999, 0.08334, 0.09376, 0.10418, 0.11459, 0.12501, 0.13543, 0.14584, 0.15626, 0.16668, 0.15626, 0.14584, 0.13543, 0.12501, 0.11459, 0.10418, 0.09376, 0.08334, 0.07292999999999999, 0.06251, 0.05209, 0.04168, 0.03126, 0.02084, 0.01043, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005; 0.61087, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 0.01043, 0.02084, 0.03126, 0.04168, 0.05209, 0.06251, 0.07292999999999999, 0.08334, 0.09376, 0.10418, 0.11459, 0.12501, 0.13543, 0.14584, 0.15626, 0.16668, 0.15626, 0.14584, 0.13543, 0.12501, 0.11459, 0.10418, 0.09376, 0.08334, 0.07292999999999999, 0.06251, 0.05209, 0.04168, 0.03126, 0.02084, 0.01043, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005; 1.5708, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 0.01043, 0.02084, 0.03126, 0.04168, 0.05209, 0.06251, 0.07292999999999999, 0.08334, 0.09376, 0.10418, 0.11459, 0.12501, 0.13543, 0.14584, 0.15626, 0.16668, 0.15626, 0.14584, 0.13543, 0.12501, 0.11459, 0.10418, 0.09376, 0.08334, 0.07292999999999999, 0.06251, 0.05209, 0.04168, 0.03126, 0.02084, 0.01043, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005, 1e-005]) "AreaFraction factors based on altitude and azimuth. bottoms out before 0 to avoid div by zero errors" annotation(Placement(visible = true, transformation(origin = {-40, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    equation
      connect(AreaFraction.y, product1.u2) annotation(Line(points = {{-29, -40}, {-15.5102, -40}, {-15.5102, 34.5578}, {7.89116, 34.5578}, {7.89116, 34.5578}}, color = {0, 0, 127}));
      connect(arrayPitch, AreaFraction.u1) annotation(Line(points = {{-100, -20}, {-84.39019999999999, -20}, {-84.39019999999999, -32.6829}, {-32, -34}, {-52, -34}}, color = {0, 0, 127}));
      connect(arrayYaw, AreaFraction.u2) annotation(Line(points = {{-100, -40}, {-88.2927, -40}, {-88.2927, -45.3659}, {-32, -46}, {-52, -46}}, color = {0, 0, 127}));
      //  product1.u2 = if AreaFraction.y < 0 then 0 else AreaFraction.y;
      connect(product1.y, DNI_out) "DNI after multiplication connected to output of model" annotation(Line(points = {{31, 40}, {58.5909, 40}, {58.5909, 19.7775}, {100, 19.7775}, {100, 20}}));
      connect(DNI_in, product1.u1) "Model input DNI connecting to product" annotation(Line(points = {{-100, 80}, {-36.3412, 80}, {-36.3412, 45.9827}, {8, 45.9827}, {8, 46}}));
      annotation(Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Text(origin = {-4.59, 2.51}, extent = {{-72.63, 35.36}, {72.63, -35.36}}, textString = "DNI x Area Fraction")}));
    end DNIReduction_AreaFraction;

    model ICS_EnvelopeCassette_Twelve "This model in the Envelope Cassette (Double-Skin Facade) that houses the ICSolar Stack and Modules. This presents a building envelope"
      extends ICSolar.Parameters;
      /// Redundant but here to true model
      Modelica.Blocks.Sources.CombiTimeTable IC_Data_all(tableOnFile = true, fileName = Path + "20150323\\ICSFdata.txt", tableName = "DNI_THTFin_vdot", nout = 3, columns = {2, 3, 4}) annotation(Placement(visible = true, transformation(origin = {-80, 0}, extent = {{-15, -15}, {15, 15}}, rotation = 0)));
      Real DNI_measured = IC_Data_all.y[1];
      Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a TAmb_in "Ambient cavity temperature" annotation(Placement(visible = true, transformation(origin = {-100, 80}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_a flowport_a(medium = mediumHTF) "Thermal fluid inflow port, before heat exchange" annotation(Placement(visible = true, transformation(origin = {-100, -80}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-95, -85}, extent = {{-5, -5}, {5, 5}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput DNI "DNI from weather file" annotation(Placement(visible = true, transformation(origin = {-100, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput AOI "Angle of incidence" annotation(Placement(visible = true, transformation(origin = {-100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput SunAlt "Altitude of the sun " annotation(Placement(visible = true, transformation(origin = {-100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput SunAzi "Azimuth of the sun " annotation(Placement(visible = true, transformation(origin = {-100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput SurfaceOrientation annotation(Placement(visible = true, transformation(origin = {-100, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput SurfaceTilt annotation(Placement(visible = true, transformation(origin = {-100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealOutput Power_Electric "Electric power generated" annotation(Placement(visible = true, transformation(origin = {100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 60}, extent = {{-20, -20}, {20, 20}}, rotation = 0)));
      Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_b flowport_b(medium = mediumHTF) "Thermal fluid outflow port, after heat exchange" annotation(Placement(visible = true, transformation(origin = {100, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      // Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_b Power_Heat "Heat power generated" annotation(Placement(visible = true, transformation(origin = {100,-60}, extent = {{-10,-10},{10,10}}, rotation = 0), iconTransformation(origin = {100,-60}, extent = {{-10,-10},{10,10}}, rotation = 0)));
      // Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort generated_enthalpy "Placeholder to make" annotation(Placement(visible = false));
      Modelica.Thermal.HeatTransfer.Sources.FixedTemperature T_indoors(T = Temp_Indoor) annotation(Placement(visible = true, transformation(origin = {-20, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      ICSolar.Envelope.CavityHeatBalance cavityheatbalance1 annotation(Placement(visible = true, transformation(origin = {20, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      // ICSolar.Envelope.ICS_GlazingLosses glazingLossesInner(Trans_glaz = 0.76) annotation(Placement(visible = true, transformation(origin = {60, -60}, extent = {{-15, -15}, {15, 15}}, rotation = 0)));
      ICSolar.Envelope.ICS_GlazingLosses glazingLossesOuter annotation(Placement(visible = true, transformation(origin = {-60, 60}, extent = {{-15, -15}, {15, 15}}, rotation = 0)));
      ICSolar.Envelope.RotationMatrixForSphericalCood rotationmatrixforsphericalcood1 annotation(Placement(visible = true, transformation(origin = {-60, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      // Modelica.Blocks.Interfaces.RealOutput DNI_toIndoors "the DNI that slips past the modules and gets through the interior-side glazing" annotation(Placement(visible = true, transformation(origin = {100, -80}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      // ICSolar.Envelope.DNIReduction_AreaFraction dnireduction_areafraction1 annotation(Placement(visible = true, transformation(origin = {-20, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      constant Real GND = 0 annotation(Placement(visible = true, transformation(origin = {-40, 0}, extent = {{-25, -25}, {25, 25}}, rotation = 0)));
      ICSolar.Stack.ICS_Stack_Twelve ics_stack2 annotation(Placement(visible = true, transformation(origin = {40, 0}, extent = {{-25, -25}, {25, 25}}, rotation = 0)));
      //  Modelica.Blocks.Sources.Constant GND(k = 0) = 0 "Ground input for stack power flow, Real" annotation(Placement(visible = true, transformation(origin = {-20, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      ICSolar.Stack.ICS_Stack_Twelve ics_stack1 annotation(Placement(visible = true, transformation(origin = {0, -60}, extent = {{-25, -25}, {25, 25}}, rotation = 0)));
      ICSolar.Receiver.subClasses.Tubing_Losses tubing_losses1 annotation(Placement(visible = true, transformation(origin = {60, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    equation
      connect(tubing_losses1.flowport_b1, ics_stack2.flowport_a1) annotation(Line(points = {{70, -60}, {72.0165, -60}, {72.0165, -27.9835}, {4.73251, -27.9835}, {4.73251, -15.4321}, {15.0206, -15.4321}, {15.0206, -15.4321}}, color = {255, 0, 0}));
      connect(ics_stack1.flowport_b1, tubing_losses1.flowport_a1) annotation(Line(points = {{25, -60}, {50, -60}, {50, -60.0823}, {50, -60.0823}}, color = {255, 0, 0}));
      //  pre-stacks
      //DNI into cavity
      connect(DNI, glazingLossesOuter.DNI) annotation(Line(points = {{-100, 60}, {-75, 60}, {-75, 64}, {-70, 69}, {-75, 69}}));
      connect(AOI, glazingLossesOuter.AOI) annotation(Line(points = {{-100, 40}, {-84, 40}, {-84, 45}, {-70, 51}, {-75, 51}}));
      connect(SunAlt, rotationmatrixforsphericalcood1.SunAlt) annotation(Line(points = {{-100, 20}, {-81.4634, 20}, {-81.2162, -16.5426}, {-69.7528, -16.445}, {-70, -16}}, color = {0, 0, 127}));
      connect(SunAzi, rotationmatrixforsphericalcood1.SunAzi) annotation(Line(points = {{-100, 0}, {-87.0732, 0}, {-86.826, -11.9084}, {-69.7528, -12.445}, {-70, -12}}, color = {0, 0, 127}));
      connect(SurfaceOrientation, rotationmatrixforsphericalcood1.SurfaceOrientation) annotation(Line(points = {{-100, -20}, {-83.9024, -20}, {-83.6552, -20.2011}, {-69.7528, -20.445}, {-70, -20}}, color = {0, 0, 127}));
      connect(SurfaceTilt, rotationmatrixforsphericalcood1.SurfaceTilt) annotation(Line(points = {{-100, -40}, {-85.6098, -40}, {-85.3626, -24.5913}, {-69.7528, -24.445}, {-70, -24}}, color = {0, 0, 127}));
      //how much self-shading
      //thermal balance
      connect(T_indoors.port, cavityheatbalance1.Interior) annotation(Line(points = {{-10, 60}, {-1.48368, 60}, {-1.48368, 55.7864}, {10, 55.7864}, {10, 56}}));
      connect(TAmb_in, cavityheatbalance1.Exterior) annotation(Line(points = {{-100, 80}, {5.04451, 80}, {5.04451, 65.8754}, {10, 66}, {10, 66}}));
      //
      connect(rotationmatrixforsphericalcood1.arrayYaw, ics_stack1.arrayYaw);
      connect(rotationmatrixforsphericalcood1.arrayPitch, ics_stack1.arrayPitch);
      connect(rotationmatrixforsphericalcood1.arrayYaw, ics_stack2.arrayYaw);
      connect(rotationmatrixforsphericalcood1.arrayPitch, ics_stack2.arrayPitch);
      //
      //prep the stacks inputs:
      ics_stack1.Power_in = 0;
      //connect(GND.y, ics_stack1.Power_in) annotation(Line(points = {{-9, -60}, {0.816327, -60}, {0.816327, -20.6803}, {17.1429, -20.6803}, {17.1429, -20.6803}}, color = {0, 0, 127}));
      connect(ics_stack1.Power_out, ics_stack2.Power_in);
      connect(ics_stack2.Power_out, Power_Electric);
      //these two are used with weatherdata input
      //  connect(glazingLossesOuter.SurfDirNor, ics_stack1.DNI);
      // connect(glazingLossesOuter.SurfDirNor, ics_stack2.DNI);
      //
      //these are used with experimental data:
      connect(DNI_measured, ics_stack1.DNI);
      connect(DNI_measured, ics_stack2.DNI);
      connect(ics_stack1.flowport_a1, flowport_a);
      connect(ics_stack2.flowport_b1, flowport_b);
      connect(ics_stack1.TAmb_in, cavityheatbalance1.ICS_Heat);
      connect(ics_stack2.TAmb_in, cavityheatbalance1.ICS_Heat);
      connect(tubing_losses1.port_a, cavityheatbalance1.ICS_Heat);
      //stacks:
      //make the connections between stacks: electrical
      //for i in 1:NumOfStacks - 1 loop
      //connect(ics_stack[i].Power_out, ics_stack[i + 1].Power_in);
      //end for;
      //make the connections for all stacks: Flow in, flow out, shading, heat port (loss)
      //for i in 1:NumOfStacks loop
      // ics_stack[i].StackNumber = i;
      //  connect(rotationmatrixforsphericalcood1.arrayYaw, ics_stack[i].arrayYaw);
      // connect(rotationmatrixforsphericalcood1.arrayPitch, ics_stack[i].arrayPitch);
      //  connect(glazingLossesOuter.SurfDirNor, ics_stack[i].DNI);
      //  connect(ics_stack[i].flowport_a1, flowport_a) annotation(Line(points = {{15, -15}, {5.78072, -15}, {5.78072, -13.5009}, {-100, -13.5009}, {-100, -80}}));
      // connect(ics_stack[i].flowport_b1, flowport_b) annotation(Line(points = {{65, 0}, {80, 0}, {80, -21.2245}, {100, -21.2245}, {100, -20}}, color = {255, 0, 0}));
      // connect(ics_stack[i].TAmb_in, cavityheatbalance1.ICS_Heat) annotation(Line(points = {{15, 20}, {0.593472, 20}, {0.593472, 20.178}, {20, 20.178}, {20, 50}}));
      // end for;
      //after the stacks
    end ICS_EnvelopeCassette_Twelve;
  end Envelope;

  package Stack "Package of all the necessary components to create an Integrated Concentrating Solar simulation"
    extends Modelica.Icons.Package;

    model ICS_Stack "This model represents an individual Integrated Concentrating Solar Stack"
      extends ICSolar.Parameters;
      Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_b flowport_b1(medium = mediumHTF) "Thermal fluid outflow port" annotation(Placement(visible = true, transformation(origin = {100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a TAmb_in "Ambient temperature of the cavity" annotation(Placement(visible = true, transformation(origin = {-100, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 80}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      output Modelica.Blocks.Interfaces.RealOutput Power_out "Electrical power generated" annotation(Placement(visible = true, transformation(origin = {100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_a flowport_a1(medium = mediumHTF) "Thermal fluid inflow port" annotation(Placement(visible = true, transformation(origin = {-100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      input Modelica.Blocks.Interfaces.RealInput Power_in(start = 0) "Power input to stack from (GND?)" annotation(Placement(visible = true, transformation(origin = {-100, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-90, -86}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput DNI "DNI in from Envelope (Parent)" annotation(Placement(visible = true, transformation(origin = {-100, 26}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-90, 46}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput arrayYaw annotation(Placement(visible = true, transformation(origin = {-100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput arrayPitch annotation(Placement(visible = true, transformation(origin = {-100, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Module.ICS_Module iCS_Module[StackHeight] annotation(Placement(visible = true, transformation(origin = {25.75, 36.25}, extent = {{-18.25, -16.25}, {18.25, 16.25}}, rotation = 0)));
      Modelica.Blocks.Tables.CombiTable2D Shading11(tableOnFile = true, fileName = "modelica://ICSolar/ShadingTable2014.txt", tableName = "ShadingTable2014");
      Modelica.Blocks.Tables.CombiTable2D Shading21(tableOnFile = true, fileName = "modelica://ICSolar/ShadingTable2014.txt", tableName = "ShadingTable2014");
      Modelica.Blocks.Tables.CombiTable2D Shading31(tableOnFile = true, fileName = "modelica://ICSolar/ShadingTable2014.txt", tableName = "ShadingTable2014");
      Modelica.Blocks.Tables.CombiTable2D Shading41(tableOnFile = true, fileName = "modelica://ICSolar/ShadingTable2014.txt", tableName = "ShadingTable2014");
      Modelica.Blocks.Tables.CombiTable2D Shading51(tableOnFile = true, fileName = "modelica://ICSolar/ShadingTable2014.txt", tableName = "ShadingTable2014");
      Modelica.Blocks.Tables.CombiTable2D Shading61(tableOnFile = true, fileName = "modelica://ICSolar/ShadingTable2014.txt", tableName = "ShadingTable2014");
      /*  Modelica.Blocks.Tables.CombiTable2D Shading1(tableOnFile = true, fileName = "modelica://ICSolar/shading/ICSF_shading_matrices_studio.txt", tableName = "1");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Modelica.Blocks.Tables.CombiTable2D Shading2(tableOnFile = true, fileName = "modelica://ICSolar/shading/ICSF_shading_matrices_studio.txt", tableName = "2");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Modelica.Blocks.Tables.CombiTable2D Shading3(tableOnFile = true, fileName = "modelica://ICSolar/shading/ICSF_shading_matrices_studio.txt", tableName = "3");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Modelica.Blocks.Tables.CombiTable2D Shading4(tableOnFile = true, fileName = "modelica://ICSolar/shading/ICSF_shading_matrices_studio.txt", tableName = "4");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Modelica.Blocks.Tables.CombiTable2D Shading5(tableOnFile = true, fileName = "modelica://ICSolar/shading/ICSF_shading_matrices_studio.txt", tableName = "5");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Modelica.Blocks.Tables.CombiTable2D Shading6(tableOnFile = true, fileName = "modelica://ICSolar/shading/ICSF_shading_matrices_studio.txt", tableName = "6");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              */
      Modelica.Blocks.Math.Product product11 "Multiplication of DNI and shading factor";
      Modelica.Blocks.Math.Product product21 "Multiplication of DNI and shading factor";
      Modelica.Blocks.Math.Product product31 "Multiplication of DNI and shading factor";
      Modelica.Blocks.Math.Product product41 "Multiplication of DNI and shading factor";
      Modelica.Blocks.Math.Product product51 "Multiplication of DNI and shading factor";
      Modelica.Blocks.Math.Product product61 "Multiplication of DNI and shading factor";
    equation
      //make the connections between modules: electrical and flow
      for i in 1:StackHeight - 1 loop
        connect(iCS_Module[i].flowport_b1, iCS_Module[i + 1].flowport_a1);
        connect(iCS_Module[i].Power_out, iCS_Module[i + 1].Power_in);
      end for;
      //make the connections between modules and the world: DNI, T_ambient
      for i in 1:StackHeight loop
        //chooseshadematrix1[i].ModuleColumn = 1;
        //chooseshadematrix1[i].ModuleRow = 1;
        //shading1[i].ShadingTable = chooseshadematrix1[i].ShadeMatrixEnum;
        //connect(arrayYaw, shading1[i].arrayYaw);
        //connect(arrayPitch, shading1[i].arrayPitch);
        //connect(DNI, shading1[i].DNI_in);
        //connect(shading1[i].DNI_out, iCS_Module[i].DNI);
        connect(iCS_Module[i].TAmb_in, TAmb_in);
      end for;
      connect(iCS_Module[1].flowport_a1, flowport_a1);
      connect(iCS_Module[StackHeight].flowport_b1, flowport_b1);
      connect(iCS_Module[1].Power_in, Power_in);
      connect(iCS_Module[StackHeight].Power_out, Power_out);
      //Manual connection of shading matrixes and products
      //Module1
      product11.u2 = if Shading11.y < 0 then 0 else Shading11.y;
      connect(product11.y, iCS_Module[1].DNI) "DNI after multiplication connected to output of model";
      connect(DNI, product11.u1) "Model input DNI connecting to product";
      connect(arrayYaw, Shading11.u2);
      connect(arrayPitch, Shading11.u1);
      //Module2
      product21.u2 = if Shading21.y < 0 then 0 else Shading21.y;
      connect(product21.y, iCS_Module[2].DNI) "DNI after multiplication connected to output of model";
      connect(DNI, product21.u1) "Model input DNI connecting to product";
      connect(arrayYaw, Shading21.u2);
      connect(arrayPitch, Shading21.u1);
      //Module3
      product31.u2 = if Shading31.y < 0 then 0 else Shading31.y;
      connect(product31.y, iCS_Module[3].DNI) "DNI after multiplication connected to output of model";
      connect(DNI, product31.u1) "Model input DNI connecting to product";
      connect(arrayYaw, Shading31.u2);
      connect(arrayPitch, Shading31.u1);
      //Module4
      product41.u2 = if Shading41.y < 0 then 0 else Shading41.y;
      connect(product41.y, iCS_Module[4].DNI) "DNI after multiplication connected to output of model";
      connect(DNI, product41.u1) "Model input DNI connecting to product";
      connect(arrayYaw, Shading41.u2);
      connect(arrayPitch, Shading41.u1);
      //Module5
      product51.u2 = if Shading51.y < 0 then 0 else Shading51.y;
      connect(product51.y, iCS_Module[5].DNI) "DNI after multiplication connected to output of model";
      connect(DNI, product51.u1) "Model input DNI connecting to product";
      connect(arrayYaw, Shading51.u2);
      connect(arrayPitch, Shading51.u1);
      //Module6
      product61.u2 = if Shading61.y < 0 then 0 else Shading61.y;
      connect(product61.y, iCS_Module[6].DNI) "DNI after multiplication connected to output of model";
      connect(DNI, product61.u1) "Model input DNI connecting to product";
      connect(arrayYaw, Shading61.u2);
      connect(arrayPitch, Shading61.u1);
      annotation(Placement(transformation(extent = {{-10, 64}, {10, 84}})), Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = false, initialScale = 0.1, grid = {2, 2}), graphics = {Rectangle(extent = {{-100, 100}, {100, -100}}, lineColor = {0, 0, 0}, fillPattern = FillPattern.VerticalCylinder, fillColor = {215, 215, 215}), Text(origin = {0.95, 5.29}, extent = {{-61.06, 40.08}, {61.06, -40.08}}, textString = "Stack"), Rectangle(extent = {{-100, 100}, {100, -100}}, lineColor = {0, 0, 0})}), experiment(StartTime = 0, StopTime = 315360, Tolerance = 1e-06, Interval = 3710.12), Diagram(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = false, initialScale = 0.1, grid = {2, 2}), graphics = {Rectangle(origin = {0, -0.288066}, extent = {{-100, 100}, {100, -100}})}));
    end ICS_Stack;

    model ICS_Stack2 "This model represents an individual Integrated Concentrating Solar Stack"
      extends ICSolar.Parameters;
      Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_b flowport_b1(medium = mediumHTF) "Thermal fluid outflow port" annotation(Placement(visible = true, transformation(origin = {100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a TAmb_in "Ambient temperature of the cavity" annotation(Placement(visible = true, transformation(origin = {-100, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 80}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      output Modelica.Blocks.Interfaces.RealOutput Power_out "Electrical power generated" annotation(Placement(visible = true, transformation(origin = {100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_a flowport_a1(medium = mediumHTF) "Thermal fluid inflow port" annotation(Placement(visible = true, transformation(origin = {-100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      input Modelica.Blocks.Interfaces.RealInput Power_in(start = 0) "Power input to stack from (GND?)" annotation(Placement(visible = true, transformation(origin = {-100, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-90, -86}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput DNI "DNI in from Envelope (Parent)" annotation(Placement(visible = true, transformation(origin = {-100, 26}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-90, 46}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput arrayYaw annotation(Placement(visible = true, transformation(origin = {-100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput arrayPitch annotation(Placement(visible = true, transformation(origin = {-100, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Module.ICS_Module iCS_Module[StackHeight] annotation(Placement(visible = true, transformation(origin = {25.75, 36.25}, extent = {{-18.25, -16.25}, {18.25, 16.25}}, rotation = 0)));
      Modelica.Blocks.Tables.CombiTable2D Shading12(tableOnFile = true, fileName = "modelica://ICSolar/ShadingTable2014.txt", tableName = "ShadingTable2014");
      Modelica.Blocks.Tables.CombiTable2D Shading22(tableOnFile = true, fileName = "modelica://ICSolar/ShadingTable2014.txt", tableName = "ShadingTable2014");
      Modelica.Blocks.Tables.CombiTable2D Shading32(tableOnFile = true, fileName = "modelica://ICSolar/ShadingTable2014.txt", tableName = "ShadingTable2014");
      Modelica.Blocks.Tables.CombiTable2D Shading42(tableOnFile = true, fileName = "modelica://ICSolar/ShadingTable2014.txt", tableName = "ShadingTable2014");
      Modelica.Blocks.Tables.CombiTable2D Shading52(tableOnFile = true, fileName = "modelica://ICSolar/ShadingTable2014.txt", tableName = "ShadingTable2014");
      Modelica.Blocks.Tables.CombiTable2D Shading62(tableOnFile = true, fileName = "modelica://ICSolar/ShadingTable2014.txt", tableName = "ShadingTable2014");
      //  Modelica.Blocks.Tables.CombiTable2D Shading12(tableOnFile = true, fileName = "modelica://ICSolar/shading/ICSF_shading_matrices_studio.txt", tableName = "7");
      //  Modelica.Blocks.Tables.CombiTable2D Shading22(tableOnFile = true, fileName = "modelica://ICSolar/shading/ICSF_shading_matrices_studio.txt", tableName = "8");
      //  Modelica.Blocks.Tables.CombiTable2D Shading32(tableOnFile = true, fileName = "modelica://ICSolar/shading/ICSF_shading_matrices_studio.txt", tableName = "9");
      //  Modelica.Blocks.Tables.CombiTable2D Shading42(tableOnFile = true, fileName = "modelica://ICSolar/shading/ICSF_shading_matrices_studio.txt", tableName = "10");
      //  Modelica.Blocks.Tables.CombiTable2D Shading52(tableOnFile = true, fileName = "modelica://ICSolar/shading/ICSF_shading_matrices_studio.txt", tableName = "11");
      //  Modelica.Blocks.Tables.CombiTable2D Shading62(tableOnFile = true, fileName = "modelica://ICSolar/shading/ICSF_shading_matrices_studio.txt", tableName = "12");
      Modelica.Blocks.Math.Product product1 "Multiplication of DNI and shading factor";
      Modelica.Blocks.Math.Product product2 "Multiplication of DNI and shading factor";
      Modelica.Blocks.Math.Product product3 "Multiplication of DNI and shading factor";
      Modelica.Blocks.Math.Product product4 "Multiplication of DNI and shading factor";
      Modelica.Blocks.Math.Product product5 "Multiplication of DNI and shading factor";
      Modelica.Blocks.Math.Product product6 "Multiplication of DNI and shading factor";
    equation
      //make the connections between modules: electrical and flow
      for i in 1:StackHeight - 1 loop
        connect(iCS_Module[i].flowport_b1, iCS_Module[i + 1].flowport_a1);
        connect(iCS_Module[i].Power_out, iCS_Module[i + 1].Power_in);
      end for;
      //make the connections between modules and the world: DNI, T_ambient
      for i in 1:StackHeight loop
        //chooseshadematrix1[i].ModuleColumn = 1;
        //chooseshadematrix1[i].ModuleRow = 1;
        //shading1[i].ShadingTable = chooseshadematrix1[i].ShadeMatrixEnum;
        //connect(arrayYaw, shading1[i].arrayYaw);
        //connect(arrayPitch, shading1[i].arrayPitch);
        //connect(DNI, shading1[i].DNI_in);
        //connect(shading1[i].DNI_out, iCS_Module[i].DNI);
        connect(iCS_Module[i].TAmb_in, TAmb_in);
      end for;
      connect(iCS_Module[1].flowport_a1, flowport_a1);
      connect(iCS_Module[StackHeight].flowport_b1, flowport_b1);
      connect(iCS_Module[1].Power_in, Power_in);
      connect(iCS_Module[StackHeight].Power_out, Power_out);
      //Manual connection of shading matrixes and products
      //Module1
      product1.u2 = if Shading12.y < 0 then 0 else Shading12.y;
      connect(product1.y, iCS_Module[1].DNI) "DNI after multiplication connected to output of model";
      connect(DNI, product1.u1) "Model input DNI connecting to product";
      connect(arrayYaw, Shading12.u2);
      connect(arrayPitch, Shading12.u1);
      //Module2
      product2.u2 = if Shading22.y < 0 then 0 else Shading22.y;
      connect(product2.y, iCS_Module[2].DNI) "DNI after multiplication connected to output of model";
      connect(DNI, product2.u1) "Model input DNI connecting to product";
      connect(arrayYaw, Shading22.u2);
      connect(arrayPitch, Shading22.u1);
      //Module3
      product3.u2 = if Shading32.y < 0 then 0 else Shading32.y;
      connect(product3.y, iCS_Module[3].DNI) "DNI after multiplication connected to output of model";
      connect(DNI, product3.u1) "Model input DNI connecting to product";
      connect(arrayYaw, Shading32.u2);
      connect(arrayPitch, Shading32.u1);
      //Module4
      product4.u2 = if Shading42.y < 0 then 0 else Shading42.y;
      connect(product4.y, iCS_Module[4].DNI) "DNI after multiplication connected to output of model";
      connect(DNI, product4.u1) "Model input DNI connecting to product";
      connect(arrayYaw, Shading42.u2);
      connect(arrayPitch, Shading42.u1);
      //Module5
      product5.u2 = if Shading52.y < 0 then 0 else Shading52.y;
      connect(product5.y, iCS_Module[5].DNI) "DNI after multiplication connected to output of model";
      connect(DNI, product5.u1) "Model input DNI connecting to product";
      connect(arrayYaw, Shading52.u2);
      connect(arrayPitch, Shading52.u1);
      //Module6
      product6.u2 = if Shading62.y < 0 then 0 else Shading62.y;
      connect(product6.y, iCS_Module[6].DNI) "DNI after multiplication connected to output of model";
      connect(DNI, product6.u1) "Model input DNI connecting to product";
      connect(arrayYaw, Shading62.u2);
      connect(arrayPitch, Shading62.u1);
      annotation(Placement(transformation(extent = {{-10, 64}, {10, 84}})), Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = false, initialScale = 0.1, grid = {2, 2}), graphics = {Rectangle(extent = {{-100, 100}, {100, -100}}, lineColor = {0, 0, 0}, fillPattern = FillPattern.VerticalCylinder, fillColor = {215, 215, 215}), Text(origin = {0.95, 5.29}, extent = {{-61.06, 40.08}, {61.06, -40.08}}, textString = "Stack"), Rectangle(extent = {{-100, 100}, {100, -100}}, lineColor = {0, 0, 0})}), experiment(StartTime = 0, StopTime = 315360, Tolerance = 1e-06, Interval = 3710.12), Diagram(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = false, initialScale = 0.1, grid = {2, 2}), graphics = {Rectangle(origin = {0, -0.288066}, extent = {{-100, 100}, {100, -100}})}));
    end ICS_Stack2;

    model Shading
      Modelica.Blocks.Interfaces.RealOutput DNI_out "DNI after shading factor multiplication" annotation(Placement(visible = true, transformation(origin = {100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Math.Product product1 "Multiplication of DNI and shading factor" annotation(Placement(visible = true, transformation(origin = {20, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      parameter Modelica.Blocks.Interfaces.IntegerInput ShadingTable annotation(Placement(visible = true, transformation(origin = {-100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      //for picking different shading matrices:
      //  final parameter String ShadingName = String(ShadingTable);
      Modelica.Blocks.Tables.CombiTable2D Shading_matrix(tableOnFile = true, fileName = "modelica://ICSolar/ShadingTable2014.txt", tableName = ShadingName) annotation(Placement(visible = true, transformation(origin = {-40, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput arrayPitch "pitch (up/down) angle of 2axis tracking array (rads)" annotation(Placement(visible = true, transformation(origin = {-100, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput arrayYaw "yaw (left/right) angle of tracking array (in radians)" annotation(Placement(visible = true, transformation(origin = {-100, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput DNI_in "DNI in before shading factor multiplication" annotation(Placement(visible = true, transformation(origin = {-100, 80}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 80}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    equation
      product1.u2 = if Shading_matrix.y < 0 then 0 else Shading_matrix.y;
      connect(product1.y, DNI_out) "DNI after multiplication connected to output of model" annotation(Line(points = {{31, 40}, {58.5909, 40}, {58.5909, 19.7775}, {100, 19.7775}, {100, 20}}));
      connect(DNI_in, product1.u1) "Model input DNI connecting to product" annotation(Line(points = {{-100, 80}, {-36.3412, 80}, {-36.3412, 45.9827}, {8, 45.9827}, {8, 46}}));
      connect(arrayYaw, Shading_matrix.u2);
      connect(arrayPitch, Shading_matrix.u1);
      annotation(Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Text(origin = {-4.59, 2.51}, extent = {{-72.63, 35.36}, {72.63, -35.36}}, textString = "Self Shading")}), Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2})), Diagram(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2})));
    end Shading;

    model ICS_Stack_Twelve "This model represents an individual Integrated Concentrating Solar Stack"
      extends ICSolar.Parameters;
      Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_b flowport_b1(medium = mediumHTF) "Thermal fluid outflow port" annotation(Placement(visible = true, transformation(origin = {100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a TAmb_in "Ambient temperature of the cavity" annotation(Placement(visible = true, transformation(origin = {-100, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 80}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      output Modelica.Blocks.Interfaces.RealOutput Power_out "Electrical power generated" annotation(Placement(visible = true, transformation(origin = {100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_a flowport_a1(medium = mediumHTF) "Thermal fluid inflow port" annotation(Placement(visible = true, transformation(origin = {-100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      input Modelica.Blocks.Interfaces.RealInput Power_in(start = 0) "Power input to stack from (GND?)" annotation(Placement(visible = true, transformation(origin = {-100, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-90, -86}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput DNI "DNI in from Envelope (Parent)" annotation(Placement(visible = true, transformation(origin = {-100, 26}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-90, 46}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput arrayYaw annotation(Placement(visible = true, transformation(origin = {-100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput arrayPitch annotation(Placement(visible = true, transformation(origin = {-100, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      //  Modelica.Blocks.Tables.CombiTable2D Shading11(tableOnFile = true, fileName = "modelica://ICSolar/ShadingTable2014.txt", tableName = "ShadingTable2014");
      ICSolar.Module.ICS_Module_Twelve ICS_Module_Twelve_1[StackHeight] annotation(Placement(visible = true, transformation(origin = {-60, -80}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    equation
      //make the connections between modules: electrical and flow
      for i in 1:StackHeight - 1 loop
        connect(ICS_Module_Twelve_1[i].flowport_b1, ICS_Module_Twelve_1[i + 1].flowport_a1);
        connect(ICS_Module_Twelve_1[i].Power_out, ICS_Module_Twelve_1[i + 1].Power_in);
      end for;
      //make the connections between modules and the world: DNI, T_ambient, pitch, yaw
      for i in 1:StackHeight loop
        connect(ICS_Module_Twelve_1[i].DNI, DNI);
        connect(ICS_Module_Twelve_1[i].arrayPitch, arrayPitch);
        connect(ICS_Module_Twelve_1[i].arrayYaw, arrayYaw);
        connect(ICS_Module_Twelve_1[i].TAmb_in, TAmb_in);
        ICS_Module_Twelve_1[i].modNum = i;
      end for;
      //connect the inlets and outlets of the stack
      connect(ICS_Module_Twelve_1[1].flowport_a1, flowport_a1);
      connect(ICS_Module_Twelve_1[StackHeight].flowport_b1, flowport_b1);
      connect(ICS_Module_Twelve_1[1].Power_in, Power_in);
      connect(ICS_Module_Twelve_1[StackHeight].Power_out, Power_out);
      //annotation
      annotation(Placement(transformation(extent = {{-10, 64}, {10, 84}})), Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = false, initialScale = 0.1, grid = {2, 2}), graphics = {Rectangle(extent = {{-100, 100}, {100, -100}}, lineColor = {0, 0, 0}, fillPattern = FillPattern.VerticalCylinder, fillColor = {215, 215, 215}), Text(origin = {0.95, 5.29}, extent = {{-61.06, 40.08}, {61.06, -40.08}}, textString = "Stack"), Rectangle(extent = {{-100, 100}, {100, -100}}, lineColor = {0, 0, 0})}), experiment(StartTime = 0, StopTime = 315360, Tolerance = 1e-06, Interval = 3710.12), Diagram(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = false, initialScale = 0.1, grid = {2, 2}), graphics = {Rectangle(origin = {0, -0.288066}, extent = {{-100, 100}, {100, -100}})}));
    end ICS_Stack_Twelve;
  end Stack;

  package Module "Package of all the necessary components to create an Integrated Concentrating Solar simulation"
    extends Modelica.Icons.Package;

    model ICS_Module "This model contains all the components and equations that simulate one module of Integrated Concentrating Solar"
      extends ICSolar.Parameters;
      parameter Modelica.SIunits.Length LensWidth = 0.25019 "Width of Fresnel Lens, meters";
      parameter Modelica.SIunits.Length CellWidth = 0.01 "Width of the PV cell, meters";
      //  parameter String FresMat = "PMMA" "'PMMA' or 'Silicon on Glass', use the exact spellings provided";
      //  parameter Real FNum = 0.85 "FNum determines the lens transmittance based on concentrating";
      //  Integer FMatNum "Integer used to pipe the material to other models";
      Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_b flowport_b1(medium = mediumHTF) "Outflow port of the thermal fluid (to Parent)" annotation(Placement(visible = true, transformation(origin = {100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_a flowport_a1(medium = mediumHTF) "Inflow port of the thermal fluid (from Parent)" annotation(Placement(visible = true, transformation(origin = {-100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput DNI "DNI into the Module" annotation(Placement(visible = true, transformation(origin = {-100, 18}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 18}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a TAmb_in "Ambient temperature of the cavity into Module model for use in the heat receiver" annotation(Placement(visible = true, transformation(origin = {-100, 78}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 78}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      ICSolar.Receiver.moduleReceiver modulereceiver1 "Heat Receiver to calculate the heat transfer between heat gen and heat transfered to thermal fluid" annotation(Placement(visible = true, transformation(origin = {65, -5}, extent = {{-15, -15}, {15, 15}}, rotation = 0)));
      input Modelica.Blocks.Interfaces.RealInput Power_in "electrical power in from previous module or GND" annotation(Placement(visible = true, transformation(origin = {-100, 46}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 46}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealOutput Power_out "Electrical generation outflow (to Parent)" annotation(Placement(visible = true, transformation(origin = {100, 54}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 54}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      ICSolar.Module.ICS_LensLosses ics_lenslosses1 annotation(Placement(visible = true, transformation(origin = {-60, -2}, extent = {{-15, -15}, {15, 15}}, rotation = 0)));
      ICSolar.Module.ICS_PVPerformance ics_pvperformance1 annotation(Placement(visible = true, transformation(origin = {0, 0}, extent = {{-16.25, -16.25}, {16.25, 16.25}}, rotation = 0)));
      Modelica.Blocks.Math.Add add annotation(Placement(transformation(extent = {{36, 32}, {46, 42}})));
    equation
      connect(modulereceiver1.flowport_b1, flowport_b1) annotation(Line(points = {{80, 5.71429}, {86.535, 5.71429}, {86.535, -40.2154}, {99.4614, -40.2154}, {99.4614, -40.2154}}, color = {255, 0, 0}));
      connect(TAmb_in, modulereceiver1.TAmb_in) annotation(Line(points = {{-100, 78}, {-2.90276, 78}, {-2.90276, 13.0624}, {50, 13.0624}, {50, 6.78571}}));
      connect(ics_pvperformance1.ThermalGen, modulereceiver1.ThermalGen) annotation(Line(points = {{16.25, -7.3125}, {45.38, -7.3125}, {45.38, 6.04915}, {50, 6.04915}, {50, -0.714286}}));
      connect(ics_lenslosses1.ConcentrationFactor, ics_pvperformance1.ConcentrationFactor) annotation(Line(points = {{-45, -11}, {-39.3195, -11}, {-39.3195, -9.82987}, {-16.25, -9.82987}, {-16.25, -9.75}}));
      connect(ics_lenslosses1.DNI_out, ics_pvperformance1.DNI_in) annotation(Line(points = {{-45, 4}, {-34.4045, 4}, {-34.4045, 0.378072}, {-16.25, 0.378072}, {-16.25, 0}}));
      connect(DNI, ics_lenslosses1.DNI_in) annotation(Line(points = {{-100, 18}, {-75, 18}, {-75, 7}}));
      connect(modulereceiver1.flowport_a1, flowport_a1) "Connect pump flow the heat receiver" annotation(Line(points = {{62, 10}, {39.4366, 10}, {39.4366, -40.1408}, {-100, -40.1408}, {-100, -40}}));
      //  if FresMat == "PMMA" then
      //    FMatNum = 1;
      //  elseif FresMat == "Silicon on Glass" then
      //    FMatNum = 2;
      //  else
      //  end if;
      //  ics_lens1.FMat = FMatNum "Connects FMatNum calculated in Module to Lens FMat input";
      ics_lenslosses1.LensWidth = LensWidth "Connects LensWidth defined in Module to Lens LensWidth";
      ics_lenslosses1.CellWidth = CellWidth "Connect CellWidth defined in Module to CellWidth in Lens";
      // ics_pvperformance1.CellWidth = CellWidth "Connect CellWidth defined in Module to CellWidth in PVPerformance for EIPC calc on Cell";
      // ics_lens1.FNum = FNum "Connects the FNumber defined in Module to FNum in Lens for concentration and transmission equations";
      connect(Power_in, add.u1) annotation(Line(points = {{-100, 46}, {-28, 46}, {-28, 40}, {35, 40}}, color = {0, 0, 127}, smooth = Smooth.None));
      connect(ics_pvperformance1.ElectricalGen, add.u2) annotation(Line(points = {{16.25, 6.5}, {16.25, 31.25}, {35, 31.25}, {35, 34}}, color = {0, 0, 127}, smooth = Smooth.None));
      connect(add.y, Power_out) annotation(Line(points = {{46.5, 37}, {69.25, 37}, {69.25, 54}, {100, 54}}, color = {0, 0, 127}, smooth = Smooth.None));
      annotation(Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Text(origin = {-1.41, 9.98}, extent = {{-67.14, 46.6}, {67.14, -46.6}}, textString = "Module")}), Diagram(coordinateSystem(preserveAspectRatio = false, extent = {{-100, -100}, {100, 100}}), graphics));
    end ICS_Module;

    model ICS_Lens "This model does the concentrating lens calculations: transmission losses and concentration. DNI_out is the DNI after concentration"
      Modelica.Blocks.Interfaces.RealInput DNI_in "DNI in from Module (Parent)" annotation(Placement(visible = true, transformation(origin = {-100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput FNum "F Number of concentrating Lens" annotation(Placement(visible = false, transformation(origin = {-100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput LensWidth "Width of Concentrating Lens" annotation(Placement(visible = false, transformation(origin = {-100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput CellWidth "Width of PV Cell" annotation(Placement(visible = false, transformation(origin = {-100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.IntegerInput FMat "Integer describing lens material and selecting tran losses equation accordingly" annotation(Placement(visible = false, transformation(origin = {-100, -80}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -80}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Real ModuleDepth = LensWidth * sqrt(2) * FNum;
      Real LensTrans "Lens transmittance variable";
      Modelica.Blocks.Interfaces.RealOutput DNI_out "Output DNI after Lens manipulation (including concentration)" annotation(Placement(visible = true, transformation(origin = {100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealOutput ConcentrationFactor = LensWidth ^ 2 / CellWidth ^ 2 "Concentration Factor determined from area of Lens in relation to area of Cell" annotation(Placement(visible = true, transformation(origin = {100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    equation
      if FMat == 1 then
        LensTrans = ((-20.833 * FNum ^ 3) - 23.214 * FNum ^ 2 + 106.1 * FNum + 23.207) / 100;
      else
        LensTrans = ((-104.17 * FNum ^ 3) + 171.43 * FNum ^ 2 - 40.744 * FNum + 57.236) / 100;
      end if;
      DNI_out = DNI_in * LensTrans * ConcentrationFactor "Calculating DNI after Lens Transmission Losses and Lens Concentration";
    end ICS_Lens;

    model ICS_PVPerformance "This model uses the EIPC (based on cell area) and PVEfficiency (based on ConcentrationFactor) to calculate the ElectricalGen and ThermalGen"
      extends ICSolar.Parameters;
      // parameter Real Eta_Observed = Exp_Observed "From ICSolar.Parameters, observed electrical efficiency of ICSFg8";
      // parameter Real Eta_nom_tweak = Exp_nom_tweak "From ICSolar.Parameters, matching the observed to modeled data, compensating for temperature 'unknown'. 0.364 matches the Nov25-13 data well when eta_observed is 0.215. set same as eta_obs for full-strength output.";
      Real CellWidth = 0.01 "Width of the PV Cell";
      Real CellEfficiency = 0.36436 + (52.5 - (ThermalGen.T - 273.15)) * 0.0005004 + (ConcentrationFactor - 627.5) * 1.9965e-006;
      //* Exp_Observed / Exp_nom_tweak "Equation to determine the PVEfficiency from the ConcentrationFactor and Cell Temperature";
      Real EIPC "Energy In Per Cell";
      Modelica.Blocks.Interfaces.RealInput ConcentrationFactor "Used to represent 'suns's for the calculation of PVEfficiency" annotation(Placement(visible = true, transformation(origin = {-100, -60}, extent = {{-25, -25}, {25, 25}}, rotation = 0), iconTransformation(origin = {-100, -60}, extent = {{-15, -15}, {15, 15}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealOutput ElectricalGen "Real output for piping the generated electrical energy out" annotation(Placement(visible = true, transformation(origin = {100, 20}, extent = {{-25, -25}, {25, 25}}, rotation = 0), iconTransformation(origin = {100, 40}, extent = {{-25, -25}, {25, 25}}, rotation = 0)));
      Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_b ThermalGen "Output heat port to pipe the generated heat out and to the heat receiver" annotation(Placement(visible = true, transformation(origin = {100, -60}, extent = {{-15, -15}, {15, 15}}, rotation = 0), iconTransformation(origin = {100, -45}, extent = {{-25, -25}, {25, 25}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput DNI_in "DNI in from the Lens model (include Concentration)" annotation(Placement(visible = true, transformation(origin = {-100, 20}, extent = {{-25, -25}, {25, 25}}, rotation = 0), iconTransformation(origin = {-100, 0}, extent = {{-15, -15}, {15, 15}}, rotation = 0)));
      Modelica.Blocks.Interfaces.IntegerInput modNum annotation(Placement(visible = true, transformation(origin = {-100, 80}, extent = {{-25, -25}, {25, 25}}, rotation = 0), iconTransformation(origin = {-80, 80}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    equation
      EIPC = DNI_in * CellWidth ^ 2 "Energy In Per Cell, used to calculate maximum energy on the cell";
      if PV_on[modNum] == 1 then
        ElectricalGen = EIPC * CellEfficiency "Electrical energy conversion";
        ThermalGen.Q_flow = -EIPC * (1 - CellEfficiency) "Energy left over after electrical gen is converted to heat";
      else
        ElectricalGen = 0;
        ThermalGen.Q_flow = -EIPC "Energy hitting cell is available for heat";
      end if;
      annotation(Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Text(origin = {-3.11195, -3.79298}, extent = {{-63.55, 45.8}, {63.55, -45.8}}, textString = "PV Performance")}), Diagram(coordinateSystem(preserveAspectRatio = false, extent = {{-100, -100}, {100, 100}}), graphics));
    end ICS_PVPerformance;

    model ICS_LensLosses "This model does the concentrating lens calculations: transmission losses and concentration. DNI_out is the DNI after concentration"
      extends ICSolar.Parameters;
      parameter Real Eff_Optic = OpticalEfficiency "Optical efficiency of the concentrating lens and optical device before the photovoltaic cell, value comes from ICSolar.Parameter";
      Modelica.Blocks.Interfaces.RealInput LensWidth annotation(Placement(visible = false, transformation(origin = {-100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput CellWidth annotation(Placement(visible = false, transformation(origin = {-100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealOutput DNI_out annotation(Placement(visible = true, transformation(origin = {100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealOutput ConcentrationFactor = LensWidth ^ 2 / CellWidth ^ 2 annotation(Placement(visible = true, transformation(origin = {100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput DNI_in annotation(Placement(visible = true, transformation(origin = {-100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    equation
      DNI_out = DNI_in * Eff_Optic * ConcentrationFactor;
      annotation(Documentation(info = "<HTML>
                                                                           <p><b> Tramission losses associated with the lens / optic elements. Ratio of power on the cell to power on the entry aperture.</b></p>

                                                                           <p>Optical efficiency from LBI Benitez <b>High performance Fresnel-based photovoltaic concentrator</b> where Eff_Opt(F#). Assuming anti-reflective coating on secondary optic element (SOE), current Gen8 module design Eff_Opt(0.84) = 88.2%</p> 

                                                                           <b>More Information:</b>
                                                                           <p> The F-number for a Fresnal-Khler lens is the ratio of the distance between cell and Fresenel lens to the diagonal measurement of the front lens. The concentrator optical efficiency is defined as the ratio of power on the cell to the power on the entry aperture when the sun is exactly on-axis.</p>
                                                                           </HTML>"), Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Text(origin = {0.694127, 36.2079}, extent = {{-72.52, 54.46}, {72.52, -54.46}}, textString = "Lens Losses")}));
    end ICS_LensLosses;

    model chooseShadeMatrix "based on a module's position in an array, choose it's shading matrix. Two modes of operation, based on the value of the isStudioExperiment boolean flag in Parameters"
      //  extends ICSolar.Envelope.ICS_EnvelopeCassette;
      //  extends ICSolar.Stack.ICS_Stack;
      extends ICSolar.Parameters;
      //  input String TestOutString (start = "initttt");
      output Modelica.Blocks.Interfaces.IntegerOutput ShadeMatrixEnum "Enumeration of shading matrix" annotation(Placement(visible = true, transformation(origin = {60, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-90, -86}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      parameter Modelica.Blocks.Interfaces.IntegerInput ModuleColumn "Module Column" annotation(Placement(visible = true, transformation(origin = {-60, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-90, -86}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      parameter Modelica.Blocks.Interfaces.IntegerInput ModuleRow "Module Row" annotation(Placement(visible = true, transformation(origin = {-60, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-90, -86}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    algorithm
      //step through the rows outer and columns inner, assigning shadeMatrix enumeration
      if isStudioExperiment then
        if ModuleRow == 1 then
          if ModuleColumn == 1 then
            ShadeMatrixEnum := 11;
          elseif ModuleColumn == 2 then
            ShadeMatrixEnum := 12;
          end if;
        elseif ModuleRow == 2 then
          if ModuleColumn == 1 then
            ShadeMatrixEnum := 21;
          elseif ModuleColumn == 2 then
            ShadeMatrixEnum := 22;
          end if;
        elseif ModuleRow == 3 then
          if ModuleColumn == 1 then
            ShadeMatrixEnum := 31;
          elseif ModuleColumn == 2 then
            ShadeMatrixEnum := 32;
          end if;
        elseif ModuleRow == 4 then
          if ModuleColumn == 1 then
            ShadeMatrixEnum := 41;
          elseif ModuleColumn == 2 then
            ShadeMatrixEnum := 42;
          end if;
        elseif ModuleRow == 5 then
          if ModuleColumn == 1 then
            ShadeMatrixEnum := 51;
          elseif ModuleColumn == 2 then
            ShadeMatrixEnum := 52;
          end if;
        elseif ModuleRow == 6 then
          if ModuleColumn == 1 then
            ShadeMatrixEnum := 61;
          elseif ModuleColumn == 2 then
            ShadeMatrixEnum := 62;
          end if;
        end if;
      else
        if ModuleRow == 1 then
          if ModuleColumn == 1 then
            ShadeMatrixEnum := 11;
          elseif ModuleColumn == 2 then
            ShadeMatrixEnum := 12;
          elseif ModuleColumn == NumOfStacks - 1 then
            ShadeMatrixEnum := 18;
          elseif ModuleColumn == NumOfStacks then
            ShadeMatrixEnum := 19;
          else
            ShadeMatrixEnum := 15;
          end if;
        elseif ModuleRow == 2 then
          if ModuleColumn == 1 then
            ShadeMatrixEnum := 21;
          elseif ModuleColumn == 2 then
            ShadeMatrixEnum := 22;
          elseif ModuleColumn == NumOfStacks - 1 then
            ShadeMatrixEnum := 28;
          elseif ModuleColumn == NumOfStacks then
            ShadeMatrixEnum := 29;
          else
            ShadeMatrixEnum := 25;
          end if;
        elseif ModuleRow == StackHeight - 1 then
          if ModuleColumn == 1 then
            ShadeMatrixEnum := 81;
          elseif ModuleColumn == 2 then
            ShadeMatrixEnum := 82;
          elseif ModuleColumn == NumOfStacks - 1 then
            ShadeMatrixEnum := 88;
          elseif ModuleColumn == NumOfStacks then
            ShadeMatrixEnum := 89;
          else
            ShadeMatrixEnum := 85;
          end if;
        elseif ModuleRow == StackHeight then
          if ModuleColumn == 1 then
            ShadeMatrixEnum := 91;
          elseif ModuleColumn == 2 then
            ShadeMatrixEnum := 92;
          elseif ModuleColumn == NumOfStacks - 1 then
            ShadeMatrixEnum := 98;
          elseif ModuleColumn == NumOfStacks then
            ShadeMatrixEnum := 99;
          else
            ShadeMatrixEnum := 95;
          end if;
        else
          ShadeMatrixEnum := 55;
        end if;
      end if;
      annotation(Icon(coordinateSystem(extent = {{-60, -60}, {60, 60}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2})), Diagram(coordinateSystem(extent = {{-60, -60}, {60, 60}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Rectangle(origin = {0, 0}, extent = {{-60, 60}, {60, -60}})}));
    end chooseShadeMatrix;

    model ICS_Module_Twelve "This model contains all the components and equations that simulate one module of Integrated Concentrating Solar"
      extends ICSolar.Parameters;
      parameter Modelica.SIunits.Length LensWidth = 0.25019 "Width of Fresnel Lens, meters";
      parameter Modelica.SIunits.Length CellWidth = 0.01 "Width of the PV cell, meters";
      //  parameter String FresMat = "PMMA" "'PMMA' or 'Silicon on Glass', use the exact spellings provided";
      //  parameter Real FNum = 0.85 "FNum determines the lens transmittance based on concentrating";
      //  Integer FMatNum "Integer used to pipe the material to other models";
      Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_b flowport_b1(medium = mediumHTF) "Outflow port of the thermal fluid (to Parent)" annotation(Placement(visible = true, transformation(origin = {100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_a flowport_a1(medium = mediumHTF) "Inflow port of the thermal fluid (from Parent)" annotation(Placement(visible = true, transformation(origin = {-100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a TAmb_in "Ambient temperature of the cavity into Module model for use in the heat receiver" annotation(Placement(visible = true, transformation(origin = {-100, 78}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 78}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      ICSolar.Receiver.moduleReceiver modulereceiver1 "Heat Receiver to calculate the heat transfer between heat gen and heat transfered to thermal fluid" annotation(Placement(visible = true, transformation(origin = {65, -5}, extent = {{-15, -15}, {15, 15}}, rotation = 0)));
      ICSolar.Module.ICS_LensLosses ics_lenslosses1 annotation(Placement(visible = true, transformation(origin = {-60, -2}, extent = {{-15, -15}, {15, 15}}, rotation = 0)));
      ICSolar.Module.ICS_PVPerformance ics_pvperformance1 annotation(Placement(visible = true, transformation(origin = {0, 0}, extent = {{-16.25, -16.25}, {16.25, 16.25}}, rotation = 0)));
      Modelica.Blocks.Math.Add add annotation(Placement(transformation(extent = {{36, 32}, {46, 42}})));
      Modelica.Blocks.Interfaces.RealOutput Power_out "Electrical generation outflow (to Parent)" annotation(Placement(visible = true, transformation(origin = {100, 54}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput arrayPitch "pass pitch to module" annotation(Placement(visible = true, transformation(origin = {-100, 30}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      input Modelica.Blocks.Interfaces.RealInput Power_in "electrical power in from previous module or GND" annotation(Placement(visible = true, transformation(origin = {-100, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput DNI "DNI into the Module" annotation(Placement(visible = true, transformation(origin = {-100, 18}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -80}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.RealInput arrayYaw "pass yaw to module" annotation(Placement(visible = true, transformation(origin = {-100, 50}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      ICSolar.Shading_Twelve shading_twelve1 annotation(Placement(visible = true, transformation(origin = {-60, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Blocks.Interfaces.IntegerInput modNum annotation(Placement(visible = true, transformation(origin = {-100, -80}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-80, -80}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    equation
      connect(shading_twelve1.DNI_out, ics_lenslosses1.DNI_in) annotation(Line(points = {{-50, 42}, {-43.6957, 42}, {-43.6957, 14.205}, {-83.377, 14.205}, {-83.377, 6.94808}, {-75.3481, 6.94808}, {-75.3481, 6.94808}}, color = {0, 0, 127}));
      connect(shading_twelve1.arrayPitch, arrayPitch) annotation(Line(points = {{-70, 40}, {-78.5905, 40}, {-78.5905, 30.4172}, {-95.8836, 30.4172}, {-95.8836, 30.4172}}, color = {0, 0, 127}));
      connect(shading_twelve1.arrayYaw, arrayYaw) annotation(Line(points = {{-70, 44}, {-77.9729, 44}, {-77.9729, 49.4086}, {-96.038, 49.4086}, {-96.038, 49.4086}}, color = {0, 0, 127}));
      connect(shading_twelve1.DNI_in, DNI) annotation(Line(points = {{-70, 48}, {-85.693, 48}, {-85.693, 17.6018}, {-95.7292, 17.6018}, {-95.7292, 17.6018}}, color = {0, 0, 127}));
      connect(Power_in, add.u1) annotation(Line(points = {{-100, 60}, {-28, 60}, {-28, 40}, {35, 40}}, color = {0, 0, 127}));
      connect(modulereceiver1.flowport_b1, flowport_b1) annotation(Line(points = {{80, 5.71429}, {86.535, 5.71429}, {86.535, -40.2154}, {99.4614, -40.2154}, {99.4614, -40.2154}}, color = {255, 0, 0}));
      connect(TAmb_in, modulereceiver1.TAmb_in) annotation(Line(points = {{-100, 78}, {-2.90276, 78}, {-2.90276, 13.0624}, {50, 13.0624}, {50, 6.78571}}));
      connect(ics_pvperformance1.ThermalGen, modulereceiver1.ThermalGen) annotation(Line(points = {{16.25, -7.3125}, {45.38, -7.3125}, {45.38, 6.04915}, {50, 6.04915}, {50, -0.714286}}));
      connect(ics_lenslosses1.ConcentrationFactor, ics_pvperformance1.ConcentrationFactor) annotation(Line(points = {{-45, -11}, {-39.3195, -11}, {-39.3195, -9.82987}, {-16.25, -9.82987}, {-16.25, -9.75}}));
      connect(ics_lenslosses1.DNI_out, ics_pvperformance1.DNI_in) annotation(Line(points = {{-45, 4}, {-34.4045, 4}, {-34.4045, 0.378072}, {-16.25, 0.378072}, {-16.25, 0}}));
      connect(modulereceiver1.flowport_a1, flowport_a1) "Connect pump flow the heat receiver" annotation(Line(points = {{62, 10}, {39.4366, 10}, {39.4366, -40.1408}, {-100, -40.1408}, {-100, -40}}));
      connect(modNum, ics_pvperformance1.modNum);
      //  if FresMat == "PMMA" then
      //    FMatNum = 1;
      //  elseif FresMat == "Silicon on Glass" then
      //    FMatNum = 2;
      //  else
      //  end if;
      //  ics_lens1.FMat = FMatNum "Connects FMatNum calculated in Module to Lens FMat input";
      ics_lenslosses1.LensWidth = LensWidth "Connects LensWidth defined in Module to Lens LensWidth";
      ics_lenslosses1.CellWidth = CellWidth "Connect CellWidth defined in Module to CellWidth in Lens";
      // ics_pvperformance1.CellWidth = CellWidth "Connect CellWidth defined in Module to CellWidth in PVPerformance for EIPC calc on Cell";
      // ics_lens1.FNum = FNum "Connects the FNumber defined in Module to FNum in Lens for concentration and transmission equations";
      connect(ics_pvperformance1.ElectricalGen, add.u2) annotation(Line(points = {{16.25, 6.5}, {16.25, 31.25}, {35, 31.25}, {35, 34}}, color = {0, 0, 127}, smooth = Smooth.None));
      connect(add.y, Power_out) annotation(Line(points = {{46.5, 37}, {69.25, 37}, {69.25, 54}, {100, 54}}, color = {0, 0, 127}, smooth = Smooth.None));
      annotation(Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Text(origin = {-1.41, 9.98}, extent = {{-67.14, 46.6}, {67.14, -46.6}}, textString = "Module")}), Diagram(coordinateSystem(preserveAspectRatio = false, extent = {{-100, -100}, {100, 100}}), graphics));
    end ICS_Module_Twelve;
  end Module;

  package Receiver "Package of all the necessary components to create an Integrated Concentrating Solar simulation"
    extends Modelica.Icons.Package;

    model moduleReceiver
      extends ICSolar.Parameters;
      ICSolar.Receiver.subClasses.receiverInternalEnergy receiverInternalEnergy1 annotation(Placement(visible = true, transformation(origin = {-158.447, -48.4473}, extent = {{-23.4473, -23.4473}, {23.4473, 23.4473}}, rotation = 0)));
      ICSolar.Receiver.subClasses.Water_Block_HX water_Block_HX1 annotation(Placement(visible = true, transformation(origin = {-28.4646, 3.4646}, extent = {{-33.4646, -33.4646}, {33.4646, 33.4646}}, rotation = 0)));
      ICSolar.Receiver.subClasses.Tubing_Losses tubing_Losses1(Tubing(medium = mediumHTF, m = 0.0023, T0 = 298.15, V_flowLaminar(displayUnit = "l/min") = 4.1666666666667e-006, dpLaminar(displayUnit = "kPa") = 1000, V_flowNominal(displayUnit = "l/min") = 0.00041666666666667, dpNominal(displayUnit = "kPa") = 100000, h_g = 0.3)) annotation(Placement(visible = true, transformation(origin = {61.4355, -1.4355}, extent = {{-31.4355, -31.4355}, {31.4355, 31.4355}}, rotation = 0)));
      Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_b flowport_b1(medium = mediumHTF) annotation(Placement(visible = true, transformation(origin = {200, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {200, 100}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a TAmb_in annotation(Placement(visible = true, transformation(origin = {-200, 170}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-200, 170}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a ThermalGen annotation(Placement(visible = true, transformation(origin = {-200, -10}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-200, 100}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_a flowport_a1(medium = mediumHTF) annotation(Placement(visible = true, transformation(origin = {-200, 40}, extent = {{-10, -10}, {10, 10}}, rotation = -90), iconTransformation(origin = {-40, 200}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    equation
      connect(water_Block_HX1.flowport_b1, tubing_Losses1.flowport_a1) annotation(Line(points = {{5.66929, 2.12602}, {16.7742, 2.12602}, {16.7742, -0.860215}, {30.5376, -0.860215}, {30.5376, -0.860215}}, color = {255, 0, 0}));
      connect(TAmb_in, tubing_Losses1.port_a) annotation(Line(points = {{-200, 170}, {123.541, 170}, {123.541, -23.164}, {92.2496, -23.164}, {92.2496, -23.164}}));
      connect(tubing_Losses1.flowport_b1, flowport_b1) annotation(Line(points = {{92.871, -1.4355}, {137.358, -1.4355}, {137.358, 58.1132}, {200, 58.1132}, {200, 60}}));
      connect(ThermalGen, water_Block_HX1.energyFrom_CCA) annotation(Line(points = {{-200, -10}, {-119.049, -10}, {-119.049, -9.75}, {-61.929, -9.75}, {-61.929, -9.92}}));
      connect(receiverInternalEnergy1.port_b, water_Block_HX1.heatCap_waterBlock) annotation(Line(visible = true, origin = {-79.7717, -20.413}, points = {{-55.228, -13.9659}, {-5.2283, -13.9659}, {-5.2283, -4.587}, {17.8425, -4.587}, {17.8425, -2.89408}}, color = {191, 0, 0}));
      connect(flowport_a1, water_Block_HX1.flowport_a1) annotation(Line(points = {{-200, 40}, {-130, 40}, {-130, 16.8504}, {-61.9292, 16.8504}}, color = {255, 0, 0}, smooth = Smooth.None));
      connect(TAmb_in, water_Block_HX1.heatLoss_to_ambient) annotation(Line(points = {{-200, 170}, {-140, 170}, {-140, 3.4646}, {-61.9292, 3.4646}}, color = {191, 0, 0}, smooth = Smooth.None));
      annotation(Diagram(coordinateSystem(extent = {{-200, -80}, {200, 200}}, preserveAspectRatio = false, initialScale = 0.1, grid = {10, 10}), graphics = {Text(origin = {12.5, 110}, fillPattern = FillPattern.Solid, extent = {{-42.5, -5}, {42.5, 5}}, textString = "Bring the Ambient Sources and pump Outside the Class ", fontName = "Arial")}), Icon(coordinateSystem(extent = {{-200, -80}, {200, 200}}, preserveAspectRatio = false, initialScale = 0.1, grid = {10, 10}), graphics = {Text(origin = {3.12, 117.49}, extent = {{-133.92, 40.92}, {133.92, -40.92}}, textString = "Heat"), Text(origin = {9.85451, 16.9292}, extent = {{-154.79, 56.03}, {154.79, -56.03}}, textString = "Receiver")}));
    end moduleReceiver;

    package subClasses "Contains the subClasses for receiver"
      extends Modelica.Icons.Package;

      connector Egen_port
        Modelica.SIunits.Power p "Power in Watts at the port" annotation(Diagram(coordinateSystem(preserveAspectRatio = false, extent = {{-100, -100}, {100, 100}}), graphics = {Polygon(points = {{100, 100}, {-100, 100}, {-100, -100}, {100, -100}, {100, 100}}, lineColor = {0, 0, 0}, fillColor = {0, 0, 0}, fillPattern = FillPattern.Solid), Text(extent = {{-150, -90}, {150, -150}}, lineColor = {0, 0, 0}, fillColor = {0, 0, 0}, fillPattern = FillPattern.Solid, textString = "%name"), Polygon(points = {{70, 70}, {-70, 70}, {-70, -70}, {70, -70}, {70, 70}}, lineColor = {255, 255, 255}, fillColor = {255, 255, 255}, fillPattern = FillPattern.Solid)}), Icon(coordinateSystem(preserveAspectRatio = false, extent = {{-100, -100}, {100, 100}}), graphics = {Polygon(points = {{100, 100}, {-100, 100}, {-100, -100}, {100, -100}, {100, 100}}, lineColor = {0, 0, 0}, fillColor = {0, 0, 0}, fillPattern = FillPattern.Solid), Polygon(points = {{70, 70}, {-70, 70}, {-70, -70}, {70, -70}, {70, 70}}, lineColor = {255, 255, 255}, fillColor = {255, 255, 255}, fillPattern = FillPattern.Solid)}));
      end Egen_port;

      class receiverInternalEnergy
        extends ICSolar.Parameters;
        Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_b port_b annotation(Placement(visible = true, transformation(origin = {100, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
        Modelica.Thermal.HeatTransfer.Components.HeatCapacitor heatcapacitor1(C = HeatCap_Receiver) "60 J/K is calculated in spreadsheet in 1-DOCS\\calculators ...thermal mass or heat capacity of receiver.xlsx" annotation(Placement(visible = true, transformation(origin = {-20, 0}, extent = {{-10, 10}, {10, -10}}, rotation = 0)));
      equation
        connect(heatcapacitor1.port, port_b) annotation(Line(points = {{-20, 10}, {-20.023, 10}, {-20.023, 60.5293}, {100, 60.5293}, {100, 60}}));
      end receiverInternalEnergy;

      class CCA_energyBalance
        Modelica.Blocks.Interfaces.RealInput wattsIn_perCell annotation(Placement(visible = true, transformation(origin = {-100, 60}, extent = {{-15, -15}, {15, 15}}, rotation = 0), iconTransformation(origin = {-100, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
        Modelica.Blocks.Interfaces.RealInput PV_eff annotation(Placement(visible = true, transformation(origin = {-100, -40}, extent = {{-15, -15}, {15, 15}}, rotation = 0), iconTransformation(origin = {-100, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
        Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_b port_b annotation(Placement(visible = true, transformation(origin = {100, -40}, extent = {{-15, -15}, {15, 15}}, rotation = 0), iconTransformation(origin = {100, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
        Modelica.Blocks.Interfaces.RealOutput Power_out annotation(Placement(visible = true, transformation(origin = {100, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      equation
        Power_out = wattsIn_perCell * PV_eff;
        port_b.Q_flow = -wattsIn_perCell * (1 - PV_eff);
      end CCA_energyBalance;

      class Water_Block_HX
        extends ICSolar.Parameters;
        Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_b flowport_b1(medium = mediumHTF) annotation(Placement(visible = true, transformation(origin = {100.0, 40.0}, extent = {{-10.0, -10.0}, {10.0, 10.0}}, rotation = 0), iconTransformation(origin = {102.0, -4.0}, extent = {{-10.0, -10.0}, {10.0, 10.0}}, rotation = 0)));
        Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_a flowport_a1(medium = mediumHTF) annotation(Placement(visible = true, transformation(origin = {-100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
        Modelica.Thermal.HeatTransfer.Components.ThermalConductor thermalconductor1(G = Cond_RecToEnv) annotation(Placement(visible = true, transformation(origin = {20, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
        Modelica.Thermal.HeatTransfer.Components.Convection convection1 annotation(Placement(visible = true, transformation(origin = {60, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
        Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a energyFrom_CCA annotation(Placement(visible = true, transformation(origin = {-100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
        Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a heatCap_waterBlock annotation(Placement(visible = true, transformation(origin = {-100, -80}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -80}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
        Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a heatLoss_to_ambient annotation(Placement(visible = true, transformation(origin = {-100, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
        Modelica.Thermal.HeatTransfer.Components.ThermalCollector thermalcollector1 annotation(Placement(visible = true, transformation(origin = {-20, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
        Modelica.Thermal.FluidHeatFlow.Components.HeatedPipe heatedpipe1(h_g = 0, T0 = TAmb, medium = mediumHTF, T(start = TAmb), pressureDrop(fixed = false), T0fixed = false, m = 0.003, dpNominal(displayUnit = "kPa") = 62270, V_flowLaminar(displayUnit = "l/min") = 1.6666666666667e-006, dpLaminar(displayUnit = "kPa") = 14690, V_flowNominal(displayUnit = "l/min") = 3.995e-006) annotation(Placement(visible = true, transformation(origin = {-20, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
        Modelica.Thermal.HeatTransfer.Components.ThermalResistor thermalresistor_waterblock(R = Resistivity_WaterPlate) annotation(Placement(visible = true, transformation(origin = {-20, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 90)));
        Modelica.Thermal.HeatTransfer.Components.ThermalResistor thermalresistor_celltoreceiver(R = Resistivity_Cell) annotation(Placement(visible = true, transformation(origin = {-60, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      equation
        connect(thermalconductor1.port_a, thermalcollector1.port_a[3]) annotation(Line(points = {{10, 0}, {-20.029, 0}, {-20.029, -10.1597}, {-20.029, -10.1597}}));
        connect(thermalresistor_waterblock.port_a, thermalcollector1.port_a[2]) annotation(Line(points = {{-20, 10}, {-20, -9.5791}, {-19.4485, -9.5791}, {-19.4485, -9.5791}}));
        connect(heatedpipe1.heatPort, thermalresistor_waterblock.port_b) annotation(Line(points = {{-20, 50}, {-19.7388, 50}, {-19.7388, 30.1887}, {-19.7388, 30.1887}}));
        connect(thermalresistor_celltoreceiver.port_b, thermalcollector1.port_a[1]) annotation(Line(points = {{-50, 0}, {-19.7388, 0}, {-19.7388, -9.86938}, {-19.7388, -9.86938}}));
        connect(energyFrom_CCA, thermalresistor_celltoreceiver.port_a) annotation(Line(points = {{-100, 0}, {-69.95650000000001, 0}, {-69.95650000000001, -0.290276}, {-69.95650000000001, -0.290276}}));
        connect(heatedpipe1.flowPort_b, flowport_b1) annotation(Line(points = {{-10, 60}, {31.3498, 60}, {31.3498, 40.3483}, {98.98399999999999, 40.3483}, {98.98399999999999, 40.3483}}));
        connect(flowport_a1, heatedpipe1.flowPort_a) annotation(Line(points = {{-100, 40}, {-62.6996, 40}, {-62.6996, 59.7968}, {-29.8984, 59.7968}, {-29.8984, 59.7968}}));
        connect(thermalresistor_waterblock.port_a, thermalcollector1.port_a[2]) annotation(Line(points = {{-20, 10}, {-20, -9.5791}, {-20, -9.5791}, {-20, -10}}));
        connect(thermalresistor_waterblock.port_b, heatedpipe1.heatPort) annotation(Line(points = {{-20, 30}, {-20, 49.6372}, {-20, 50}, {-20, 50}}));
        connect(heatCap_waterBlock, thermalcollector1.port_b) annotation(Line(points = {{-100, -80}, {-19.7929, -80}, {-20, -10}, {-20, -30}}));
        connect(heatLoss_to_ambient, convection1.fluid) annotation(Line(points = {{-100, -40}, {84.4649, -40}, {84.4649, 0}, {70, 0}}));
        connect(thermalconductor1.port_b, convection1.solid) annotation(Line(points = {{30, 0}, {50, 0}}));
        connect(Conv_Receiver, convection1.Gc) "Connects the Conv_Receiver from ICSolar.Parameter to the input for the convection coeffient of convection1";
        annotation(Diagram(coordinateSystem(preserveAspectRatio = false, extent = {{-100, -100}, {100, 100}}), graphics));
      end Water_Block_HX;

      class Tubing_Losses
        extends ICSolar.Parameters;
        Modelica.Thermal.FluidHeatFlow.Components.HeatedPipe Tubing(medium = mediumHTF, V_flowLaminar = OneBranchFlow, V_flowNominal = 1e-005, h_g = 0, m = 0.0025, T0 = T_HTF_start, dpLaminar = 0.45, dpNominal = 10) annotation(Placement(visible = true, transformation(origin = {-80, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 90)));
        Modelica.Thermal.HeatTransfer.Components.Convection convection1 annotation(Placement(visible = true, transformation(origin = {80.0, 0.0}, extent = {{-10.0, -10.0}, {10.0, 10.0}}, rotation = 0)));
        Modelica.Thermal.HeatTransfer.Components.Convection convection2 annotation(Placement(visible = true, transformation(origin = {-40, 0}, extent = {{10, -10}, {-10, 10}}, rotation = 0)));
        Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a port_a(T(start = 293)) annotation(Placement(visible = true, transformation(origin = {100.0, -60.0}, extent = {{-10.0, -10.0}, {10.0, 10.0}}, rotation = 0), iconTransformation(origin = {102.0, -70.0}, extent = {{-10.0, -10.0}, {10.0, 10.0}}, rotation = 0)));
        Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_b flowport_b1(medium = mediumHTF) annotation(Placement(visible = true, transformation(origin = {-80, 80}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
        Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_a flowport_a1(medium = mediumHTF) annotation(Placement(visible = true, transformation(origin = {-80.0, -80.0}, extent = {{-10.0, -10.0}, {10.0, 10.0}}, rotation = 0), iconTransformation(origin = {-100.0, 0.0}, extent = {{-10.0, -10.0}, {10.0, 10.0}}, rotation = 0)));
        Modelica.Thermal.HeatTransfer.Components.ThermalConductor Conduction_Insulation(G = Cond_Insulation) "Thermal conductivity of Tubing Insulation, from ICSolar.Parameter" annotation(Placement(visible = true, transformation(origin = {40, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
        Modelica.Thermal.HeatTransfer.Components.ThermalConductor Conduction_Tube(G = Cond_Tube) "Thermal conductivity of the silicone tubing, from ICSolar.Parameter" annotation(Placement(visible = true, transformation(origin = {0, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
      equation
        connect(convection2.solid, Conduction_Tube.port_a) annotation(Line(points = {{-30, 0}, {-9.920629999999999, 0}, {-10, 0}}));
        connect(Conduction_Tube.port_b, Conduction_Insulation.port_a) annotation(Line(points = {{10, 0}, {30.5556, 0}, {30, 0}}));
        connect(Conduction_Insulation.port_b, convection1.solid) annotation(Line(points = {{50, 0}, {70.4365, 0}, {70.4365, 0.1984}, {70, 0}}));
        connect(convection1.fluid, port_a) annotation(Line(visible = true, points = {{90.0, 0.0}, {97.8175, 0.0}, {97.8175, -43.8492}, {87.5, -43.8492}, {87.5, -60.9127}, {98.61109999999999, -60.9127}, {100.0, -60.0}}));
        connect(flowport_a1, Tubing.flowPort_a) annotation(Line(visible = true, points = {{-80.0, -80.0}, {-79.9603, -80.0}, {-79.9603, -10.3175}, {-80.0, -10.0}}));
        connect(flowport_b1, Tubing.flowPort_b) annotation(Line(points = {{-80, 80}, {-79.9615, 80}, {-79.9615, 10}, {-80, 10}}));
        connect(Tubing.heatPort, convection2.fluid) annotation(Line(points = {{-70, -6.12303e-016}, {-70, 0}, {-50, 0}}));
        connect(Conv_WaterTube, convection2.Gc);
        connect(Conv_InsulationAir, convection1.Gc);
        annotation(Diagram(coordinateSystem(preserveAspectRatio = false, extent = {{-100, -100}, {100, 100}}), graphics));
      end Tubing_Losses;
    end subClasses;
  end Receiver;

  model Parameters "Inputs for the ICSF model"
    ///////////////////////
    //////// PATH /////////
    ///////////////////////
    parameter String Path = "C:\\Users\\Kenton\\Documents\\GitHub\\RPI_CASE_ICS_Modelica\\";
    //////////////////////////////////
    //////// MODEL OPERATION /////////
    //////////////////////////////////
    parameter Boolean isStudioExperiment = true "True if this run is referring to the gen8 studio experiment";
    //////////////////////////////////
    ///// BUILDING CONFIGURATION /////
    //////////////////////////////////
    parameter Real BuildingOrientation = 40 * 3.14159 / 180 "Radians, 0 being south";
    parameter Real BuildingLatitude = 40.71 * Modelica.Constants.pi / 180 "Latitude (radians)";
    parameter Real ArrayTilt = 0 "Radians, 0 being wall";
    ////////////////////////
    ///// ARRAY SIZING /////
    ////////////////////////
    parameter Integer StackHeight = 6 "Number of Modules per stack";
    parameter Integer NumOfStacks = 2 "Number of stacks, controls the .Stack object";
    parameter Integer NumOfModules = StackHeight * NumOfStacks "ModulesPerStack * NumOfStacks Number of modules being simulated. Will be replaced with a calculation based on wall area in the future.";
    parameter Real GlassArea = NumOfModules * 0.3 * 0.3 "Glass Area exposed to either the interior or exterior. Could be replaced later with wall area";
    parameter Real CavityVolume = GlassArea * 0.5 "Volume of cavity for air calculations";
    ////////////////////////////////
    ///// OPTICAL EFFICIENCIES /////
    ////////////////////////////////
    parameter Real Trans_glazinglosses = 0.74 "Transmittance of outter glazing losses (single glass layer). Good glass: Guardian Ultraclear 6mm: 0.87. For our studio IGUs, measured 0.71. But give it 0.74, because we measured at ~28degrees, which will increase absorptance losses.";
    parameter Real OpticalEfficiency = 0.57 "The optical efficiency of the concentrating lens and optics prior to the photovoltaic cell";
    //parameter Real Exp_Observed = 0.215 "observed electrical efficiency of ICSFg8";
    //parameter Real Exp_nom_tweak = 0.364 * OpticalEfficiency "matching the observed to modeled data, compensating for temperature 'unknown'. 0.364 matches the Nov25-13 data well when eta_observed is 0.215. set same as eta_obs for full-strength output.";
    ///////////////////////
    ////// PV ON/OFF  /////
    ///////////////////////
    parameter Integer PV_on[6] = {1, 0, 0, 1, 1, 0};
    ////////////////////////
    ///// TEMPERATURES /////
    ////////////////////////
    parameter Real Temp_Indoor = 24 + 273.15 "Interior building zone temperature (Kelvin)";
    parameter Modelica.SIunits.Temperature TAmb(displayUnit = "degK") = 293.15 "Ambient temperature";
    parameter Real T_HTF_start = 330.0;
    ///////////////////////
    ////// ATMOSPHERE /////
    ///////////////////////
    parameter Modelica.SIunits.Pressure PAmb(displayUnit = "PA") = 101325 "Ambient pressure";
    /////////////////
    ///// FLUID /////
    /////////////////
    parameter Modelica.Thermal.FluidHeatFlow.Media.Medium mediumHTF = Modelica.Thermal.FluidHeatFlow.Media.Water() "Water" annotation(choicesAllMatching = true);
    parameter Real OneBranchFlow = 1.63533E-06;
    //////////////////////////////////////
    ///// HEAT TRANSFER COEFFICIENTS /////
    //////////////////////////////////////
    parameter Real Resistivity_WaterBlock = 5.69e-6 * OneBranchFlow ^ (-0.773) "Thermal resisitivity of the water block heat exchanger";
    //5.69e-6 * OneBranchFlow ^ (-0.773)
    parameter Real Resistivity_Cell = 0.2 "The thermal heat resistivity of the photovoltaic cell";
    parameter Real Resistivity_WaterPlate = 1.6 "Thermal resisitivity of the water plate heat exchanger";
    parameter Real Cond_RecToEnv = 10 "This is a thermal conductivity to determine the amount of heat lost to the environment from the receiver";
    parameter Real Conv_Receiver = 0.0534;
    // 0.07 "Convection Heat Transfer of Receiver to air h(=10)*A(=0.004m2)";
    //parameter Real Conv_Receiver = 0.0618321 "Convection Heat Transfer of Receiver to air h(=10)*A(=0.004m2)";
    parameter Real Conv_WaterTube = 3.66 * 0.58 / (2 * 0.003175) * 2 * Modelica.Constants.pi * 0.003175 * 0.3 "Convection Heat Transfer of Water to Piping = h*SurfArea = Nu(=3.66) * kofWater / Diameter * Surface Area";
    parameter Real Conv_InsulationAir = 3.66 * 0.023 / (2 * (0.003175 + 0.0015 + 0.09525)) * 2 * Modelica.Constants.pi * (0.003175 + 0.0015 + 0.01905) * 0.3 "Convection Heat Transfer of Piping to Air Nu(=3.66) * kofAir / Diameter * Surface Area";
    parameter Real Cond_Insulation = 1 / (Modelica.Math.log(14.2 / 4.675) / (2 * Modelica.Constants.pi * 0.037 * 0.3) * 2 * Modelica.Constants.pi * (0.003175 + 0.0015 + 0.01905) * 0.3) "Thermal conductivity of Tubing Insulation: ln((23.55e-3)/(4.5e-3))/(2*pi*0.037*0.3)";
    parameter Real Cond_Tube = 1 / (Modelica.Math.log(4.675 / 3.175) / (2 * Modelica.Constants.pi * 0.145 * 0.3) * 2 * Modelica.Constants.pi * (0.003175 + 0.0015) * 0.3) "Thermal conductivity of the silicone tubing: 1/(ln(4.5e-3/3e-3)/(2*pi*0.145*0.3))";
    parameter Real HeatCap_Receiver = 30;
    //30;
    annotation(Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2})), Diagram(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2})), experiment(StartTime = 47130, StopTime = 58120, Tolerance = 1e-06, Interval = 10), Documentation(info = "<html>
                                                                            Don't forget to:<br/>
                                                                            fix the shading matrices path in <code>Envelope.ICS_SelfShading</code>.<br/> </html>", revisions = "<html>
                                                                            <ul>
                                                                            <li>
                                                                            Jan2015, by Justin Shultz:<br/>
                                                                            First implementation.<br/>
                                                                            </li>
                                                                            </ul>
                                                                            </html>"));
  end Parameters;

  model HeatCapacitorPCMLike00 "Lumped thermal element storing heat with temperature-varying capacitance"
    //  extends Modelica.Thermal.HeatTransfer.Components.HeatCapacitor;
    Modelica.SIunits.HeatCapacity C "Heat capacity of element (= cp*m)";
    Modelica.SIunits.Temperature T(start = 293.15 + 40, displayUnit = "degC") "Temperature of element";
    Modelica.SIunits.TemperatureSlope der_T(start = 0) "Time derivative of temperature (= der(T))";
    // Modelica.SIunits.Mass m_h20;
    // Modelica.SIunits.Mass m_PCM;
    //   extends Modelica.Thermal.HeatTransfer.Components.HeatCapacitor;
    import Modelica.Media.Water.ConstantPropertyLiquidWater;
    //  import Modelica.SIunits.Temperature;
    //  import Modelica.SIunits.Mass;
    //  import Modelica.SIUnits.Volume;
    //  import Modelica.SIunits.Area;
    //  import SpecificHeat = Modelica.SIunits.SpecificHeatCapacity;
    type HeatFusion = Real(unit = "kJ/kg", min = 0.01);
    //  Modelica.SIunits.Volume V
    //    "functioning volume of storage element, in water and PCM";
    parameter Real cp_h2o = 4.177 "spec heat cap water";
    parameter Real cp_PCM = 2.9 "spec heat cap paraffin";
    parameter Real rho_h2o = 995 "density water";
    parameter Real rho_PCM = 900 "density PCM";
    parameter Real V_tank = 1 "density PCM";
    parameter Real fracPCM_vol = 0.6 "fraction of volume that is PCM";
    parameter HeatFusion hfg_pcm = 200;
    parameter Modelica.SIunits.Temperature T_sc = 293 + 65 "lowest subcooling temperature";
    parameter Modelica.SIunits.Temperature T_melt = 293 + 65 + 6 "highest melting temperature";
    Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a port annotation(Placement(transformation(origin = {0, -100}, extent = {{-10, -10}, {10, 10}}, rotation = 90)));
  equation
    T = port.T;
    der_T = der(T);
    C * der(T) = port.Q_flow;
    if T < T_sc then
      C = cp_h2o * V_tank * (1 - fracPCM_vol) * rho_h2o + cp_PCM * V_tank * fracPCM_vol * rho_PCM;
      //  C = (cp_const*(V*(1-fracPCM))*d_const) + (cp_const*(2.9/4.177)*(V*(fracPCM))*(d_const*(900/995)));
      //  C = (Modelica.Thermal.FluidHeatFlow.Media.Water.cp*(V*(1-fracPCM))*Modelica.Thermal.FluidHeatFlow.Media.Water.rho) + (Modelica.Thermal.FluidHeatFlow.Media.Water.cp*(2.9/4.177)*(V*(fracPCM))*(Modelica.Thermal.FluidHeatFlow.Media.Water.rho*(900/995)));
      //constant fractions are used to set the cp and rho values for paraffin relative to water. source: engineering toolbox online.
    elseif T > T_melt then
      C = cp_h2o * V_tank * (1 - fracPCM_vol) * rho_h2o + cp_PCM * V_tank * fracPCM_vol * rho_PCM;
      //  C = (cp_const*(V*(1-fracPCM))*d_const) + (cp_const*(2.9/4.177)*(V*(fracPCM))*(d_const*(900/995)));
      //  C = (Modelica.Thermal.Media.Water.cp*(V*(1-fracPCM))*Modelica.Thermal.FluidHeatFlow.Media.Water.rho) + (Modelica.Thermal.FluidHeatFlow.Media.Water.cp*(2.9/4.177)*(V*(fracPCM))*(Modelica.Thermal.FluidHeatFlow.Media.Water.rho*(900/995)));
      //constant fractions are used to set the cp and rho values for paraffin relative to water. source: engineering toolbox online.
    else
      C = cp_h2o * V_tank * (1 - fracPCM_vol) * rho_h2o + hfg_pcm / (T_melt - T_sc) * V_tank * fracPCM_vol * rho_h2o;
      //  C = (cp_const*(V*(1-fracPCM))*d_const) + (cp_const*(2.9/4.177)*(V*(fracPCM))*(d_const*(900/995)));
      //C = (Modelica.Thermal.FluidHeatFlow.Media.Water.cp*(V*(1-fracPCM))*Modelica.Thermal.FluidHeatFlow.Media.Water.rho) + ((hfg_pcm/(T_melt-T_sc))*V*fracPCM);
    end if;
    //  try = Modelica.Thermal.FluidHeatFlow.Media.Water.rho;
    annotation(Icon(coordinateSystem(preserveAspectRatio = true, extent = {{-100, -100}, {100, 100}}), graphics = {Text(extent = {{-150, 110}, {150, 70}}, textString = "%name", lineColor = {0, 0, 255}), Polygon(points = {{0, 67}, {-20, 63}, {-40, 57}, {-52, 43}, {-58, 35}, {-68, 25}, {-72, 13}, {-76, -1}, {-78, -15}, {-76, -31}, {-76, -43}, {-76, -53}, {-70, -65}, {-64, -73}, {-48, -77}, {-30, -83}, {-18, -83}, {-2, -85}, {8, -89}, {22, -89}, {32, -87}, {42, -81}, {54, -75}, {56, -73}, {66, -61}, {68, -53}, {70, -51}, {72, -35}, {76, -21}, {78, -13}, {78, 3}, {74, 15}, {66, 25}, {54, 33}, {44, 41}, {36, 57}, {26, 65}, {0, 67}}, lineColor = {160, 160, 164}, fillColor = {192, 192, 192}, fillPattern = FillPattern.Solid), Polygon(points = {{-58, 35}, {-68, 25}, {-72, 13}, {-76, -1}, {-78, -15}, {-76, -31}, {-76, -43}, {-76, -53}, {-70, -65}, {-64, -73}, {-48, -77}, {-30, -83}, {-18, -83}, {-2, -85}, {8, -89}, {22, -89}, {32, -87}, {42, -81}, {54, -75}, {42, -77}, {40, -77}, {30, -79}, {20, -81}, {18, -81}, {10, -81}, {2, -77}, {-12, -73}, {-22, -73}, {-30, -71}, {-40, -65}, {-50, -55}, {-56, -43}, {-58, -35}, {-58, -25}, {-60, -13}, {-60, -5}, {-60, 7}, {-58, 17}, {-56, 19}, {-52, 27}, {-48, 35}, {-44, 45}, {-40, 57}, {-58, 35}}, lineColor = {0, 0, 0}, fillColor = {160, 160, 164}, fillPattern = FillPattern.Solid), Text(extent = {{-69, 7}, {71, -24}}, lineColor = {0, 0, 0}, textString = "%C")}), Diagram(coordinateSystem(preserveAspectRatio = true, extent = {{-100, -100}, {100, 100}}), graphics = {Polygon(points = {{0, 67}, {-20, 63}, {-40, 57}, {-52, 43}, {-58, 35}, {-68, 25}, {-72, 13}, {-76, -1}, {-78, -15}, {-76, -31}, {-76, -43}, {-76, -53}, {-70, -65}, {-64, -73}, {-48, -77}, {-30, -83}, {-18, -83}, {-2, -85}, {8, -89}, {22, -89}, {32, -87}, {42, -81}, {54, -75}, {56, -73}, {66, -61}, {68, -53}, {70, -51}, {72, -35}, {76, -21}, {78, -13}, {78, 3}, {74, 15}, {66, 25}, {54, 33}, {44, 41}, {36, 57}, {26, 65}, {0, 67}}, lineColor = {160, 160, 164}, fillColor = {192, 192, 192}, fillPattern = FillPattern.Solid), Polygon(points = {{-58, 35}, {-68, 25}, {-72, 13}, {-76, -1}, {-78, -15}, {-76, -31}, {-76, -43}, {-76, -53}, {-70, -65}, {-64, -73}, {-48, -77}, {-30, -83}, {-18, -83}, {-2, -85}, {8, -89}, {22, -89}, {32, -87}, {42, -81}, {54, -75}, {42, -77}, {40, -77}, {30, -79}, {20, -81}, {18, -81}, {10, -81}, {2, -77}, {-12, -73}, {-22, -73}, {-30, -71}, {-40, -65}, {-50, -55}, {-56, -43}, {-58, -35}, {-58, -25}, {-60, -13}, {-60, -5}, {-60, 7}, {-58, 17}, {-56, 19}, {-52, 27}, {-48, 35}, {-44, 45}, {-40, 57}, {-58, 35}}, lineColor = {0, 0, 0}, fillColor = {160, 160, 164}, fillPattern = FillPattern.Solid), Ellipse(extent = {{-6, -1}, {6, -12}}, lineColor = {255, 0, 0}, fillColor = {191, 0, 0}, fillPattern = FillPattern.Solid), Text(extent = {{11, 13}, {50, -25}}, lineColor = {0, 0, 0}, textString = "T"), Line(points = {{0, -12}, {0, -96}}, color = {255, 0, 0})}), Documentation(info = "<HTML>
                                                                           <p>
                                                                           This is copied from:
                                                                           This is a generic model for the heat capacity of a material.
                                                                           No specific geometry is assumed beyond a total volume with
                                                                           uniform temperature for the entire volume.
                                                                           Furthermore, it is assumed that the heat capacity
                                                                           is constant (independent of temperature).
                                                                           </p>
                                                                           <p>
                                                                           The temperature T [Kelvin] of this component is a <b>state</b>.
                                                                           A default of T = 25 degree Celsius (= SIunits.Conversions.from_degC(25))
                                                                           is used as start value for initialization.
                                                                           This usually means that at start of integration the temperature of this
                                                                           component is 25 degrees Celsius. You may, of course, define a different
                                                                           temperature as start value for initialization. Alternatively, it is possible
                                                                           to set parameter <b>steadyStateStart</b> to <b>true</b>. In this case
                                                                           the additional equation '<b>der</b>(T) = 0' is used during
                                                                           initialization, i.e., the temperature T is computed in such a way that
                                                                           the component starts in <b>steady state</b>. This is useful in cases,
                                                                           where one would like to start simulation in a suitable operating
                                                                           point without being forced to integrate for a long time to arrive
                                                                           at this point.
                                                                           </p>
                                                                           <p>
                                                                           Note, that parameter <b>steadyStateStart</b> is not available in
                                                                           the parameter menu of the simulation window, because its value
                                                                           is utilized during translation to generate quite different
                                                                           equations depending on its setting. Therefore, the value of this
                                                                           parameter can only be changed before translating the model.
                                                                           </p>
                                                                           <p>
                                                                           This component may be used for complicated geometries where
                                                                           the heat capacity C is determined my measurements. If the component
                                                                           consists mainly of one type of material, the <b>mass m</b> of the
                                                                           component may be measured or calculated and multiplied with the
                                                                           <b>specific heat capacity cp</b> of the component material to
                                                                           compute C:
                                                                           </p>
                                                                           <pre>
                                                                              C = cp*m.
                                                                              Typical values for cp at 20 degC in J/(kg.K):
                                                                                 aluminium   896
                                                                                 concrete    840
                                                                                 copper      383
                                                                                 iron        452
                                                                                 silver      235
                                                                                 steel       420 ... 500 (V2A)
                                                                                 wood       2500
                                                                           </pre>
                                                                           </html>"));
  end HeatCapacitorPCMLike00;

  function EnthalpyDifferential
    input Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_a baseline_enthalpy annotation(Placement(visible = true, transformation(origin = {-100, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 60}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    input Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_a generated_enthalpy annotation(Placement(visible = true, transformation(origin = {-100, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    output Modelica.Thermal.FluidHeatFlow.Interfaces.FlowPort_b enthalpy_power annotation(Placement(visible = true, transformation(origin = {100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
  equation
    generated_enthalpy = if generated_enthalpy < 0 then -generated_enthalpy else generated_enthalpy;
    baseline_enthalpy = if baseline_enthalpy < 0 then -baseline_enthalpy else baseline_enthalpy;
    enthalpy_power = generated_enthalpy - baseline_enthalpy;
    annotation(Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2})), Diagram(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = false, initialScale = 0.1, grid = {2, 2}), graphics));
  end EnthalpyDifferential;

  model ICS_Skeleton_wStorage "This model calculates the electrical and thermal generation of ICSolar. This model is used as a skeleton piece to hold together the other models until it is packages as an FMU."
    parameter Real FLensWidth = 0.25019 "Lens width";
    parameter Real CellWidth = 0.01 "PV Cell width";
    parameter Modelica.SIunits.Pressure PAmb(displayUnit = "PA") = 101325 "Ambient pressure";
    ICSolar.ICS_Context ics_context1 annotation(Placement(visible = true, transformation(origin = {-80, 40}, extent = {{-25, -25}, {25, 25}}, rotation = 0)));
    ICSolar.Envelope.ICS_EnvelopeCassette ics_envelopecassette1 annotation(Placement(visible = true, transformation(origin = {0, 40}, extent = {{-25, -25}, {25, 25}}, rotation = 0)));
    Modelica.Thermal.FluidHeatFlow.Components.HeatedPipe heatedPipe(m = 50, T0 = 295.15, T0fixed = true, h_g = -1, V_flowLaminar = 8e-006, dpLaminar = 10000.0, V_flowNominal = 0.0008, dpNominal = 1000000.0, frictionLoss = 1) annotation(Placement(visible = true, transformation(origin = {60, -18}, extent = {{10, -10}, {-10, 10}}, rotation = 90)));
    Modelica.Thermal.FluidHeatFlow.Sources.PressureIncrease pressureIncrease(medium = mediumHTF, m = 0.1, constantPressureIncrease(displayUnit = "kPa") = 100000) annotation(Placement(transformation(extent = {{-66, -22}, {-46, -2}})));
    Modelica.Thermal.FluidHeatFlow.Sources.AbsolutePressure absolutepressure1(p = 1000) annotation(Placement(visible = true, transformation(origin = {-40, -80}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    Modelica.Thermal.HeatTransfer.Components.HeatCapacitor heatcapacitor1(C = 4000) annotation(Placement(visible = true, transformation(origin = {80, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
  equation
    connect(heatcapacitor1.port, heatedPipe.heatPort) annotation(Line(points = {{80, 30}, {80.0478, 30}, {80.0478, -18.399}, {70.2509, -18.399}, {70.2509, -18.399}}, color = {191, 0, 0}));
    connect(absolutepressure1.flowPort, pressureIncrease.flowPort_a) annotation(Line(points = {{-50, -80}, {-81.00360000000001, -80}, {-81.00360000000001, -11.9474}, {-65.9498, -11.9474}, {-65.9498, -11.9474}}, color = {255, 0, 0}));
    connect(ics_envelopecassette1.flowport_b, heatedPipe.flowPort_a) annotation(Line(points = {{25, 40}, {32, 40}, {60, 40}, {60, -8}}, color = {255, 0, 0}));
    connect(ics_context1.DNI, ics_envelopecassette1.DNI) annotation(Line(points = {{-55, 25}, {-24.1966, 25}, {-25, 25}}));
    connect(ics_context1.AOI, ics_envelopecassette1.AOI) annotation(Line(points = {{-55, 30}, {-24.9527, 30}, {-25, 30}}));
    connect(ics_context1.SunAzi, ics_envelopecassette1.SunAzi) annotation(Line(points = {{-55, 35}, {-24.9527, 35}, {-25, 35}}));
    connect(ics_context1.SunAlt, ics_envelopecassette1.SunAlt) annotation(Line(points = {{-55, 40}, {-24.5747, 40}, {-25, 40}}));
    connect(ics_context1.SurfOrientation_out, ics_envelopecassette1.SurfaceOrientation) annotation(Line(points = {{-55, 45}, {-25.7089, 45}, {-25, 45}}));
    connect(ics_context1.SurfTilt_out, ics_envelopecassette1.SurfaceTilt) annotation(Line(points = {{-55, 50}, {-25.7089, 50}, {-25, 50}}));
    connect(ics_context1.TDryBul, ics_envelopecassette1.TAmb_in) annotation(Line(points = {{-55, 55}, {-25.3308, 55}, {-25, 55}}));
    connect(ics_envelopecassette1.flowport_a, pressureIncrease.flowPort_b) annotation(Line(points = {{-23.75, 18.75}, {-23.75, -12}, {-46, -12}}, color = {255, 0, 0}, smooth = Smooth.None));
    connect(heatedPipe.flowPort_b, pressureIncrease.flowPort_a) annotation(Line(points = {{60, -28}, {60, -46}, {-92, -46}, {-92, -12}, {-66, -12}}, color = {255, 0, 0}, smooth = Smooth.None));
    annotation(experiment(StartTime = 16588800, StopTime = 16675200, Tolerance = 1e-006, Interval = 9.866390000000001), Diagram(coordinateSystem(preserveAspectRatio = false, extent = {{-100, -100}, {100, 100}}), graphics));
  end ICS_Skeleton_wStorage;

  model ICS_Skeleton_wStorage_woutICS "This model calculates the electrical and thermal generation of ICSolar. This model is used as a skeleton piece to hold together the other models until it is packages as an FMU."
    parameter Real FLensWidth = 0.25019 "Lens width";
    parameter Real CellWidth = 0.01 "PV Cell width";
    parameter Modelica.SIunits.Pressure PAmb(displayUnit = "PA") = 101325 "Ambient pressure";
    Modelica.Thermal.FluidHeatFlow.Sources.VolumeFlow Pump(medium = mediumHTF, m = 0.1, T0 = 293, useVolumeFlowInput = false, constantVolumeFlow(displayUnit = "m3/s") = 2e-006) "Fluid pump for thermal fluid" annotation(Placement(visible = true, transformation(origin = {-40, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    Modelica.Thermal.FluidHeatFlow.Components.HeatedPipe heatedPipe(m = 50, T0fixed = true, V_flowLaminar(displayUnit = "l/min") = 1.6666666666667e-005, V_flowNominal(displayUnit = "l/min") = 0.00016666666666667, frictionLoss = 1, dpLaminar(displayUnit = "kPa") = 100000, dpNominal(displayUnit = "kPa") = 1000000, T0 = 295.15, h_g = 1) annotation(Placement(transformation(extent = {{-10, -10}, {10, 10}}, rotation = 90, origin = {58, -18})));
    HeatCapacitorPCMLike00 heatCapacitorPCMLike00_1 annotation(Placement(transformation(extent = {{66, 32}, {86, 52}})));
  equation
    connect(heatedPipe.flowPort_b, Pump.flowPort_a) annotation(Line(points = {{58, -8}, {60, -8}, {60, 4}, {-82, 4}, {-82, -20}, {-50, -20}}, color = {255, 0, 0}, smooth = Smooth.None));
    connect(Pump.flowPort_b, heatedPipe.flowPort_a) annotation(Line(points = {{-30, -20}, {-14, -20}, {-14, -54}, {58, -54}, {58, -28}}, color = {255, 0, 0}, smooth = Smooth.None));
    connect(heatedPipe.heatPort, heatCapacitorPCMLike00_1.port) annotation(Line(points = {{68, -18}, {74, -18}, {74, 14}, {76, 14}, {76, 32}}, color = {191, 0, 0}, smooth = Smooth.None));
    annotation(experiment(StartTime = 16588800, StopTime = 16675200, Tolerance = 1e-006, Interval = 9.866390000000001), Diagram(coordinateSystem(preserveAspectRatio = false, extent = {{-100, -100}, {100, 100}}), graphics));
  end ICS_Skeleton_wStorage_woutICS;

  model ambientSink
    extends Modelica.Thermal.FluidHeatFlow.Sources.Ambient;
    annotation(Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2})), Diagram(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2})));
  end ambientSink;

  model measured_data "a container for the measured data vectors needed to simulate the experimental ICSF g8"
    /* //  Modelica.Thermal.FluidHeatFlow.Sources.Ambient SSource(medium = mediumHTF, useTemperatureInput = true, constantAmbientPressure = 101325, constantAmbientTemperature = TAmb) "Thermal fluid source" annotation(Placement(visible = true, transformation(origin = {40, -40}, extent = {{-10, -10}, {10, 10}}, rotation = 180)));
                              //  Modelica.Blocks.Sources.CombiTimeTable TT_HTF_in_measured_K(tableOnFile = true, fileName = "modelica://RPI_CASE_ICS_Modelica//20150323//ICSFData.txt", tableName = "DNI_THTFin_vdot", extrapolation = Modelica.Blocks.Types.Extrapolation.HoldLastPoint, smoothness = Modelica.Blocks.Types.Smoothness.ConstantSegments, columns = {3}) annotation(Placement(visible = true, transformation(origin = {-60, -40}, extent = {{-15, -15}, {15, 15}}, rotation = 0)));
                              Modelica.Blocks.Sources.CombiTimeTable T_HTF_in_measured_K(extrapolation = Modelica.Blocks.Types.Extrapolation.HoldLastPoint, smoothness = Modelica.Blocks.Types.Smoothness.ConstantSegments, columns = {2}, table = [0, 273.15; 7132953, 297.14; 7132963, 297.13; 7132973, 297.13; 7132983, 297.14; 7132993, 297.13; 7133003, 297.13; 7133013, 297.13; 7133023, 296.93; 7133033, 296.74; 7133043, 297.11; 7133053, 297.72; 7133063, 298.01; 7133073, 298.35; 7133083, 298.76; 7133093, 299.19; 7133103, 299.88; 7133113, 301.91; 7133123, 304.44; 7133133, 307.52; 7133143, 310.92; 7133153, 314.18; 7133163, 316.92; 7133173, 319.47; 7133183, 323.07; 7133193, 326.52; 7133203, 327.40; 7133213, 328.72; 7133223, 331.48; 7133233, 332.89; 7133243, 333.94; 7133253, 334.28; 7133263, 335.54; 7133273, 335.94; 7133283, 336.25; 7133293, 336.53; 7133303, 339.23; 7133313, 342.18; 7133323, 342.74; 7133333, 343.36; 7133343, 343.81; 7133353, 344.12; 7133363, 344.48; 7133373, 344.69; 7133383, 344.88; 7133393, 344.83; 7133403, 344.40; 7133413, 344.05; 7133423, 343.69; 7133433, 343.24; 7133443, 342.87; 7133453, 342.64; 7133463, 342.51; 7133473, 342.44; 7133483, 342.39; 7133493, 342.37; 7133503, 342.37; 7133513, 342.39; 7133523, 342.40; 7133533, 342.43; 7133543, 342.48; 7133553, 342.51; 7133563, 342.53; 7133573, 342.56; 7133583, 342.60; 7133593, 342.61; 7133603, 342.66; 7133613, 342.70; 7133623, 342.73; 7133633, 342.75; 7133643, 342.77; 7133653, 342.80; 7133663, 342.82; 7133673, 342.85; 7133683, 342.89; 7133693, 342.91; 7133703, 342.94; 7133713, 342.95; 7133723, 342.98; 7133733, 342.99; 7133743, 343.00; 7133753, 343.03; 7133763, 343.05; 7133773, 343.07; 7133783, 343.09; 7133793, 343.11; 7133803, 343.12; 7133813, 343.14; 7133823, 343.14; 7133833, 343.15; 7133843, 343.18; 7133853, 343.19; 7133863, 343.21; 7133873, 343.21; 7133883, 343.22; 7133893, 343.22; 7133903, 343.22; 7133913, 343.23; 7133923, 343.24; 7133933, 343.22; 7133943, 343.24; 7133953, 343.24; 7133963, 343.23; 7133973, 343.23; 7133983, 343.23; 7133993, 343.23; 7134003, 343.22; 7134013, 343.22; 7134023, 343.22; 7134033, 343.20; 7134043, 343.21; 7134053, 343.21; 7134063, 343.20; 7134073, 343.20; 7134083, 343.20; 7134093, 343.19; 7134103, 343.19; 7134113, 343.18; 7134123, 343.15; 7134133, 343.16; 7134143, 343.15; 7134153, 343.14; 7134163, 343.14; 7134173, 343.12; 7134183, 343.13; 7134193, 343.11; 7134203, 343.11; 7134213, 343.11; 7134223, 343.09; 7134233, 343.09; 7134243, 343.09; 7134253, 343.07; 7134263, 343.05; 7134273, 343.03; 7134283, 343.03; 7134293, 343.04; 7134303, 343.02; 7134313, 343.01; 7134323, 343.00; 7134333, 342.99; 7134343, 342.97; 7134353, 342.96; 7134363, 342.94; 7134373, 342.94; 7134383, 342.92; 7134393, 342.91; 7134403, 342.90; 7134413, 342.89; 7134423, 342.87; 7134433, 342.85; 7134443, 342.85; 7134453, 342.85; 7134463, 342.84; 7134473, 342.83; 7134483, 342.82; 7134493, 342.80; 7134503, 342.78; 7134513, 342.75; 7134523, 342.74; 7134533, 342.71; 7134543, 342.70; 7134553, 342.69; 7134563, 342.66; 7134573, 342.65; 7134583, 342.63; 7134593, 342.62; 7134603, 342.60; 7134613, 342.57; 7134623, 342.55; 7134633, 342.54; 7134643, 342.51; 7134653, 342.49; 7134663, 342.49; 7134673, 342.47; 7134683, 342.46; 7134693, 342.44; 7134703, 342.41; 7134713, 342.40; 7134723, 342.38; 7134733, 342.37; 7134743, 342.36; 7134753, 342.34; 7134763, 342.32; 7134773, 342.30; 7134783, 342.28; 7134793, 342.26; 7134803, 342.24; 7134813, 342.22; 7134823, 342.20; 7134833, 342.19; 7134843, 342.17; 7134853, 342.16; 7134863, 342.13; 7134873, 342.12; 7134883, 342.12; 7134893, 342.08; 7134903, 342.06; 7134913, 342.03; 7134923, 342.01; 7134933, 341.99; 7134943, 341.98; 7134953, 341.96; 7134963, 341.94; 7134973, 341.93; 7134983, 341.89; 7134993, 341.87; 7135003, 341.85; 7135013, 341.84; 7135023, 341.82; 7135033, 341.80; 7135043, 341.77; 7135053, 341.71; 7135063, 341.72; 7135073, 341.71; 7135083, 341.70; 7135093, 341.69; 7135103, 341.66; 7135113, 341.64; 7135123, 341.64; 7135133, 341.62; 7135143, 341.60; 7135153, 341.59; 7135163, 341.56; 7135173, 341.54; 7135183, 341.54; 7135193, 341.51; 7135203, 341.50; 7135213, 341.48; 7135223, 341.44; 7135233, 341.43; 7135243, 341.41; 7135253, 341.39; 7135263, 341.39; 7135273, 341.36; 7135283, 341.35; 7135293, 341.32; 7135303, 341.30; 7135313, 341.28; 7135323, 341.27; 7135333, 341.25; 7135343, 341.22; 7135353, 341.20; 7135363, 341.18; 7135373, 341.15; 7135383, 341.13; 7135393, 341.12; 7135403, 341.10; 7135413, 341.08; 7135423, 341.06; 7135433, 341.04; 7135443, 341.01; 7135453, 341.00; 7135463, 341.01; 7135473, 341.01; 7135483, 341.02; 7135493, 341.04; 7135503, 341.06; 7135513, 341.09; 7135523, 341.13; 7135533, 341.13; 7135543, 341.15; 7135553, 341.17; 7135563, 341.17; 7135573, 341.17; 7135583, 341.19; 7135593, 341.17; 7135603, 341.16; 7135613, 341.15; 7135623, 341.14; 7135633, 341.13; 7135643, 341.11; 7135653, 341.10; 7135663, 341.09; 7135673, 341.07; 7135683, 341.05; 7135693, 341.04; 7135703, 341.02; 7135713, 341.00; 7135723, 340.99; 7135733, 340.97; 7135743, 340.95; 7135753, 340.93; 7135763, 340.92; 7135773, 340.90; 7135783, 340.91; 7135793, 340.90; 7135803, 340.89; 7135813, 340.89; 7135823, 340.88; 7135833, 340.87; 7135843, 340.86; 7135853, 340.84; 7135863, 340.84; 7135873, 340.82; 7135883, 340.80; 7135893, 340.79; 7135903, 340.78; 7135913, 340.75; 7135923, 340.73; 7135933, 340.73; 7135943, 340.72; 7135953, 340.71; 7135963, 340.74; 7135973, 340.74; 7135983, 340.76; 7135993, 340.78; 7136003, 340.81; 7136013, 340.83; 7136023, 340.86; 7136033, 340.89; 7136043, 340.90; 7136053, 340.91; 7136063, 340.92; 7136073, 340.91; 7136083, 340.91; 7136093, 340.89; 7136103, 340.89; 7136113, 340.87; 7136123, 340.86; 7136133, 340.83; 7136143, 340.82; 7136153, 340.80; 7136163, 340.79; 7136173, 340.77; 7136183, 340.76; 7136193, 340.74; 7136203, 340.73; 7136213, 340.72; 7136223, 340.70; 7136233, 340.67; 7136243, 340.67; 7136253, 340.63; 7136263, 340.63; 7136273, 340.61; 7136283, 340.60; 7136293, 340.58; 7136303, 340.57; 7136313, 340.54; 7136323, 340.54; 7136333, 340.51; 7136343, 340.49; 7136353, 340.48; 7136363, 340.48; 7136373, 340.45; 7136383, 340.47; 7136393, 340.47; 7136403, 340.48; 7136413, 340.50; 7136423, 340.53; 7136433, 340.52; 7136443, 340.56; 7136453, 340.60; 7136463, 340.61; 7136473, 340.62; 7136483, 340.64; 7136493, 340.67; 7136503, 340.67; 7136513, 340.67; 7136523, 340.65; 7136533, 340.64; 7136543, 340.64; 7136553, 340.62; 7136563, 340.60; 7136573, 340.59; 7136583, 340.57; 7136593, 340.56; 7136603, 340.53; 7136613, 340.53; 7136623, 340.50; 7136633, 340.49; 7136643, 340.49; 7136653, 340.47; 7136663, 340.44; 7136673, 340.42; 7136683, 340.40; 7136693, 340.40; 7136703, 340.38; 7136713, 340.37; 7136723, 340.35; 7136733, 340.34; 7136743, 340.33; 7136753, 340.32; 7136763, 340.29; 7136773, 340.29; 7136783, 340.28; 7136793, 340.27; 7136803, 340.27; 7136813, 340.27; 7136823, 340.29; 7136833, 340.31; 7136843, 340.35; 7136853, 340.38; 7136863, 340.42; 7136873, 340.43; 7136883, 340.47; 7136893, 340.47; 7136903, 340.47; 7136913, 340.47; 7136923, 340.46; 7136933, 340.44; 7136943, 340.44; 7136953, 340.44; 7136963, 340.42; 7136973, 340.42; 7136983, 340.39; 7136993, 340.39; 7137003, 340.39; 7137013, 340.38; 7137023, 340.35; 7137033, 340.34; 7137043, 340.33; 7137053, 340.31; 7137063, 340.30; 7137073, 340.29; 7137083, 340.26; 7137093, 340.25; 7137103, 340.26; 7137113, 340.24; 7137123, 340.22; 7137133, 340.20; 7137143, 340.19; 7137153, 340.18; 7137163, 340.16; 7137173, 340.15; 7137183, 340.15; 7137193, 340.15; 7137203, 340.15; 7137213, 340.17; 7137223, 340.20; 7137233, 340.21; 7137243, 340.26; 7137253, 340.28; 7137263, 340.30; 7137273, 340.33; 7137283, 340.35; 7137293, 340.37; 7137303, 340.37; 7137313, 340.39; 7137323, 340.38; 7137333, 340.38; 7137343, 340.38; 7137353, 340.36; 7137363, 340.36; 7137373, 340.34; 7137383, 340.31; 7137393, 340.30; 7137403, 340.29; 7137413, 340.28; 7137423, 340.26; 7137433, 340.25; 7137443, 340.24; 7137453, 340.22; 7137463, 340.21; 7137473, 340.19; 7137483, 340.19; 7137493, 340.18; 7137503, 340.16; 7137513, 340.15; 7137523, 340.13; 7137533, 340.14; 7137543, 340.13; 7137553, 340.11; 7137563, 340.11; 7137573, 340.10; 7137583, 340.13; 7137593, 340.14; 7137603, 340.17; 7137613, 340.20; 7137623, 340.24; 7137633, 340.28; 7137643, 340.33; 7137653, 340.37; 7137663, 340.41; 7137673, 340.47; 7137683, 340.49; 7137693, 340.51; 7137703, 340.52; 7137713, 340.53; 7137723, 340.52; 7137733, 340.52; 7137743, 340.53; 7137753, 340.53; 7137763, 340.51; 7137773, 340.52; 7137783, 340.50; 7137793, 340.49; 7137803, 340.50; 7137813, 340.48; 7137823, 340.47; 7137833, 340.46; 7137843, 340.47; 7137853, 340.45; 7137863, 340.44; 7137873, 340.43; 7137883, 340.42; 7137893, 340.41; 7137903, 340.40; 7137913, 340.40; 7137923, 340.39; 7137933, 340.39; 7137943, 340.40; 7137953, 340.39; 7137963, 340.38; 7137973, 340.39; 7137983, 340.39; 7137993, 340.38; 7138003, 340.41; 7138013, 340.41; 7138023, 340.45; 7138033, 340.47; 7138043, 340.50; 7138053, 340.54; 7138063, 340.56; 7138073, 340.59; 7138083, 340.63; 7138093, 340.65; 7138103, 340.66; 7138113, 340.67; 7138123, 340.67; 7138133, 340.70; 7138143, 340.68; 7138153, 340.69; 7138163, 340.70; 7138173, 340.69; 7138183, 340.68; 7138193, 340.67; 7138203, 340.67; 7138213, 340.66; 7138223, 340.64; 7138233, 340.64; 7138243, 340.64; 7138253, 340.63; 7138263, 340.60; 7138273, 340.60; 7138283, 340.59; 7138293, 340.57; 7138303, 340.57; 7138313, 340.57; 7138323, 340.56; 7138333, 340.55; 7138343, 340.53; 7138353, 340.53; 7138363, 340.52; 7138373, 340.51; 7138383, 340.50; 7138393, 340.48; 7138403, 340.48; 7138413, 340.47; 7138423, 340.48; 7138433, 340.51; 7138443, 340.54; 7138453, 340.58; 7138463, 340.60; 7138473, 340.64; 7138483, 340.66; 7138493, 340.71; 7138503, 340.74; 7138513, 340.79; 7138523, 340.84; 7138533, 340.87; 7138543, 340.90; 7138553, 340.93; 7138563, 340.95; 7138573, 340.96; 7138583, 340.97; 7138593, 340.98; 7138603, 340.98; 7138613, 340.99; 7138623, 340.99; 7138633, 340.98; 7138643, 340.98; 7138653, 340.97; 7138663, 340.96; 7138673, 340.96; 7138683, 340.97; 7138693, 340.97; 7138703, 340.97; 7138713, 340.96; 7138723, 340.97; 7138733, 340.96; 7138743, 340.94; 7138753, 340.94; 7138763, 340.91; 7138773, 340.91; 7138783, 340.91; 7138793, 340.90; 7138803, 340.89; 7138813, 340.88; 7138823, 340.86; 7138833, 340.87; 7138843, 340.85; 7138853, 340.84; 7138863, 340.84; 7138873, 340.83; 7138883, 340.83; 7138893, 340.80; 7138903, 340.83; 7138913, 340.84; 7138923, 340.86; 7138933, 340.89; 7138943, 340.92; 7138953, 340.95; 7138963, 340.98; 7138973, 341.02; 7138983, 341.06; 7138993, 341.10; 7139003, 341.16; 7139013, 341.19; 7139023, 341.21; 7139033, 341.25; 7139043, 341.26; 7139053, 341.26; 7139063, 341.26; 7139073, 341.25; 7139083, 341.25; 7139093, 341.24; 7139103, 341.24; 7139113, 341.22; 7139123, 341.21; 7139133, 341.20; 7139143, 341.18; 7139153, 341.18; 7139163, 341.17; 7139173, 341.15; 7139183, 341.14; 7139193, 341.12; 7139203, 341.11; 7139213, 341.10; 7139223, 341.09; 7139233, 341.08; 7139243, 341.05; 7139253, 341.05; 7139263, 341.03; 7139273, 341.01; 7139283, 341.01; 7139293, 340.99; 7139303, 340.97; 7139313, 340.95; 7139323, 340.93; 7139333, 340.93; 7139343, 340.91; 7139353, 340.90; 7139363, 340.90; 7139373, 340.89; 7139383, 340.87; 7139393, 340.87; 7139403, 340.85; 7139413, 340.84; 7139423, 340.84; 7139433, 340.83; 7139443, 340.84; 7139453, 340.85; 7139463, 340.87; 7139473, 340.89; 7139483, 340.92; 7139493, 340.93; 7139503, 340.97; 7139513, 341.00; 7139523, 341.04; 7139533, 341.08; 7139543, 341.12; 7139553, 341.14; 7139563, 341.17; 7139573, 341.19; 7139583, 341.21; 7139593, 341.23; 7139603, 341.22; 7139613, 341.23; 7139623, 341.22; 7139633, 341.23; 7139643, 341.25; 7139653, 341.22; 7139663, 341.22; 7139673, 341.21; 7139683, 341.21; 7139693, 341.20; 7139703, 341.20; 7139713, 341.20; 7139723, 341.19; 7139733, 341.18; 7139743, 341.17; 7139753, 341.17; 7139763, 341.17; 7139773, 341.15; 7139783, 341.14; 7139793, 341.12; 7139803, 341.12; 7139813, 341.11; 7139823, 341.10; 7139833, 341.10; 7139843, 341.08; 7139853, 341.09; 7139863, 341.08; 7139873, 341.07; 7139883, 341.05; 7139893, 341.05; 7139903, 341.04; 7139913, 341.04; 7139923, 341.03; 7139933, 341.02; 7139943, 341.01; 7139953, 341.00; 7139963, 340.99; 7139973, 341.00; 7139983, 340.98; 7139993, 340.98; 7140003, 340.97; 7140013, 340.98; 7140023, 340.96; 7140033, 340.97; 7140043, 340.96; 7140053, 340.98; 7140063, 340.99; 7140073, 341.02; 7140083, 341.04; 7140093, 341.07; 7140103, 341.09; 7140113, 341.14; 7140123, 341.17; 7140133, 341.22; 7140143, 341.24; 7140153, 341.27; 7140163, 341.29; 7140173, 341.30; 7140183, 341.30; 7140193, 341.31; 7140203, 341.31; 7140213, 341.31; 7140223, 341.30; 7140233, 341.31; 7140243, 341.31; 7140253, 341.30; 7140263, 341.31; 7140273, 341.30; 7140283, 341.29; 7140293, 341.28; 7140303, 341.29; 7140313, 341.27; 7140323, 341.27; 7140333, 341.24; 7140343, 341.24; 7140353, 341.23; 7140363, 341.22; 7140373, 341.21; 7140383, 341.21; 7140393, 341.19; 7140403, 341.19; 7140413, 341.19; 7140423, 341.18; 7140433, 341.17; 7140443, 341.17; 7140453, 341.16; 7140463, 341.15; 7140473, 341.14; 7140483, 341.13; 7140493, 341.13; 7140503, 341.11; 7140513, 341.11; 7140523, 341.07; 7140533, 341.08; 7140543, 341.06; 7140553, 341.06; 7140563, 341.02; 7140573, 341.02; 7140583, 341.02; 7140593, 341.01; 7140603, 341.00; 7140613, 341.01; 7140623, 341.02; 7140633, 341.03; 7140643, 341.06; 7140653, 341.08; 7140663, 341.12; 7140673, 341.15; 7140683, 341.18; 7140693, 341.21; 7140703, 341.23; 7140713, 341.25; 7140723, 341.27; 7140733, 341.26; 7140743, 341.28; 7140753, 341.29; 7140763, 341.28; 7140773, 341.27; 7140783, 341.27; 7140793, 341.27; 7140803, 341.27; 7140813, 341.26; 7140823, 341.25; 7140833, 341.25; 7140843, 341.25; 7140853, 341.25; 7140863, 341.23; 7140873, 341.24; 7140883, 341.22; 7140893, 341.23; 7140903, 341.22; 7140913, 341.20; 7140923, 341.20; 7140933, 341.18; 7140943, 341.17; 7140953, 341.19; 7140963, 341.17; 7140973, 341.17; 7140983, 341.17; 7140993, 341.16; 7141003, 341.15; 7141013, 341.13; 7141023, 341.12; 7141033, 341.12; 7141043, 341.12; 7141053, 341.10; 7141063, 341.09; 7141073, 341.08; 7141083, 341.07; 7141093, 341.07; 7141103, 341.05; 7141113, 341.03; 7141123, 341.04; 7141133, 341.02; 7141143, 341.00; 7141153, 341.00; 7141163, 340.98; 7141173, 341.00; 7141183, 341.00; 7141193, 341.04; 7141203, 341.07; 7141213, 341.10; 7141223, 341.13; 7141233, 341.13; 7141243, 341.17; 7141253, 341.19; 7141263, 341.22; 7141273, 341.24; 7141283, 341.24; 7141293, 341.24; 7141303, 341.25; 7141313, 341.25; 7141323, 341.25; 7141333, 341.24; 7141343, 341.22; 7141353, 341.22; 7141363, 340.98; 7141373, 340.51; 7141383, 340.24; 7141393, 339.99; 7141403, 339.68; 7141413, 339.37; 7141423, 338.96; 7141433, 338.60; 7141443, 338.24; 7141453, 337.90; 7141463, 337.58; 7141473, 337.22; 7141483, 336.76; 7141493, 336.40; 7141503, 336.01; 7141513, 335.62; 7141523, 335.21; 7141533, 334.70; 7141543, 334.31; 7141553, 333.91; 7141563, 333.53; 7141573, 333.17; 31557186, 0.00]);
                              Modelica.Blocks.Sources.CombiTimeTable vDot_measured_m3s(extrapolation = Modelica.Blocks.Types.Extrapolation.HoldLastPoint, smoothness = Modelica.Blocks.Types.Smoothness.ConstantSegments, columns = {2}, table = [0, 0; 7133413, 0.000000000; 7133423, 0.000001385; 7133433, 0.000001384; 7133443, 0.000001384; 7133453, 0.000001383; 7133463, 0.000001383; 7133473, 0.000001383; 7133483, 0.000001382; 7133493, 0.000001382; 7133503, 0.000001382; 7133513, 0.000001382; 7133523, 0.000001382; 7133533, 0.000001382; 7133543, 0.000001381; 7133553, 0.000001381; 7133563, 0.000001381; 7133573, 0.000001381; 7133583, 0.000001381; 7133593, 0.000001381; 7133603, 0.000001381; 7133613, 0.000001381; 7133623, 0.000001381; 7133633, 0.000001381; 7133643, 0.000001381; 7133653, 0.000001381; 7133663, 0.000001381; 7133673, 0.000001381; 7133683, 0.000001381; 7133693, 0.000001381; 7133703, 0.000001381; 7133713, 0.000001381; 7133723, 0.000001381; 7133733, 0.000001381; 7133743, 0.000001381; 7133753, 0.000001381; 7133763, 0.000001381; 7133773, 0.000001381; 7133783, 0.000001381; 7133793, 0.000001381; 7133803, 0.000001381; 7133813, 0.000001381; 7133823, 0.000001381; 7133833, 0.000001381; 7133843, 0.000001381; 7133853, 0.000001381; 7133863, 0.000001381; 7133873, 0.000001381; 7133883, 0.000001381; 7133893, 0.000001381; 7133903, 0.000001381; 7133913, 0.000001381; 7133923, 0.000001381; 7133933, 0.000001381; 7133943, 0.000001381; 7133953, 0.000001381; 7133963, 0.000001381; 7133973, 0.000001381; 7133983, 0.000001381; 7133993, 0.000001381; 7134003, 0.000001381; 7134013, 0.000001381; 7134023, 0.000001381; 7134033, 0.000001381; 7134043, 0.000001381; 7134053, 0.000001381; 7134063, 0.000001381; 7134073, 0.000001381; 7134083, 0.000001381; 7134093, 0.000001381; 7134103, 0.000001381; 7134113, 0.000001381; 7134123, 0.000001381; 7134133, 0.000001381; 7134143, 0.000001381; 7134153, 0.000001381; 7134163, 0.000001381; 7134173, 0.000001381; 7134183, 0.000001381; 7134193, 0.000001381; 7134203, 0.000001381; 7134213, 0.000001381; 7134223, 0.000001381; 7134233, 0.000001382; 7134243, 0.000001382; 7134253, 0.000001382; 7134263, 0.000001382; 7134273, 0.000001382; 7134283, 0.000001382; 7134293, 0.000001382; 7134303, 0.000001382; 7134313, 0.000001382; 7134323, 0.000001382; 7134333, 0.000001382; 7134343, 0.000001382; 7134353, 0.000001382; 7134363, 0.000001382; 7134373, 0.000001382; 7134383, 0.000001382; 7134393, 0.000001382; 7134403, 0.000001382; 7134413, 0.000001382; 7134423, 0.000001382; 7134433, 0.000001382; 7134443, 0.000001382; 7134453, 0.000001382; 7134463, 0.000001382; 7134473, 0.000001382; 7134483, 0.000001382; 7134493, 0.000001382; 7134503, 0.000001382; 7134513, 0.000001382; 7134523, 0.000001382; 7134533, 0.000001383; 7134543, 0.000001383; 7134553, 0.000001383; 7134563, 0.000001383; 7134573, 0.000001383; 7134583, 0.000001383; 7134593, 0.000001383; 7134603, 0.000001383; 7134613, 0.000001383; 7134623, 0.000001383; 7134633, 0.000001383; 7134643, 0.000001383; 7134653, 0.000001383; 7134663, 0.000001383; 7134673, 0.000001383; 7134683, 0.000001383; 7134693, 0.000001383; 7134703, 0.000001383; 7134713, 0.000001383; 7134723, 0.000001383; 7134733, 0.000001383; 7134743, 0.000001383; 7134753, 0.000001383; 7134763, 0.000001383; 7134773, 0.000001383; 7134783, 0.000001383; 7134793, 0.000001383; 7134803, 0.000001383; 7134813, 0.000001384; 7134823, 0.000001384; 7134833, 0.000001384; 7134843, 0.000001384; 7134853, 0.000001384; 7134863, 0.000001384; 7134873, 0.000001384; 7134883, 0.000001384; 7134893, 0.000001384; 7134903, 0.000001384; 7134913, 0.000001384; 7134923, 0.000001384; 7134933, 0.000001384; 7134943, 0.000001384; 7134953, 0.000001384; 7134963, 0.000001384; 7134973, 0.000001384; 7134983, 0.000001384; 7134993, 0.000001384; 7135003, 0.000001384; 7135013, 0.000001384; 7135023, 0.000001384; 7135033, 0.000001384; 7135043, 0.000001384; 7135053, 0.000001385; 7135063, 0.000001385; 7135073, 0.000001385; 7135083, 0.000001385; 7135093, 0.000001385; 7135103, 0.000001385; 7135113, 0.000001385; 7135123, 0.000001385; 7135133, 0.000001385; 7135143, 0.000001385; 7135153, 0.000001385; 7135163, 0.000001385; 7135173, 0.000001385; 7135183, 0.000001385; 7135193, 0.000001385; 7135203, 0.000001385; 7135213, 0.000001385; 7135223, 0.000001385; 7135233, 0.000001385; 7135243, 0.000001385; 7135253, 0.000001385; 7135263, 0.000001385; 7135273, 0.000001385; 7135283, 0.000001386; 7135293, 0.000001386; 7135303, 0.000001386; 7135313, 0.000001386; 7135323, 0.000001386; 7135333, 0.000001386; 7135343, 0.000001386; 7135353, 0.000001386; 7135363, 0.000001386; 7135373, 0.000001386; 7135383, 0.000001386; 7135393, 0.000001386; 7135403, 0.000001386; 7135413, 0.000001386; 7135423, 0.000001386; 7135433, 0.000001386; 7135443, 0.000001386; 7135453, 0.000001386; 7135463, 0.000001386; 7135473, 0.000001386; 7135483, 0.000001386; 7135493, 0.000001386; 7135503, 0.000001386; 7135513, 0.000001386; 7135523, 0.000001386; 7135533, 0.000001386; 7135543, 0.000001386; 7135553, 0.000001386; 7135563, 0.000001386; 7135573, 0.000001386; 7135583, 0.000001386; 7135593, 0.000001386; 7135603, 0.000001386; 7135613, 0.000001386; 7135623, 0.000001386; 7135633, 0.000001386; 7135643, 0.000001386; 7135653, 0.000001386; 7135663, 0.000001386; 7135673, 0.000001386; 7135683, 0.000001386; 7135693, 0.000001386; 7135703, 0.000001386; 7135713, 0.000001386; 7135723, 0.000001386; 7135733, 0.000001386; 7135743, 0.000001386; 7135753, 0.000001386; 7135763, 0.000001386; 7135773, 0.000001386; 7135783, 0.000001386; 7135793, 0.000001386; 7135803, 0.000001387; 7135813, 0.000001387; 7135823, 0.000001387; 7135833, 0.000001387; 7135843, 0.000001387; 7135853, 0.000001387; 7135863, 0.000001387; 7135873, 0.000001387; 7135883, 0.000001387; 7135893, 0.000001387; 7135903, 0.000001387; 7135913, 0.000001387; 7135923, 0.000001387; 7135933, 0.000001387; 7135943, 0.000001387; 7135953, 0.000001387; 7135963, 0.000001387; 7135973, 0.000001387; 7135983, 0.000001387; 7135993, 0.000001387; 7136003, 0.000001387; 7136013, 0.000001387; 7136023, 0.000001387; 7136033, 0.000001387; 7136043, 0.000001387; 7136053, 0.000001386; 7136063, 0.000001387; 7136073, 0.000001387; 7136083, 0.000001387; 7136093, 0.000001387; 7136103, 0.000001387; 7136113, 0.000001387; 7136123, 0.000001387; 7136133, 0.000001387; 7136143, 0.000001387; 7136153, 0.000001387; 7136163, 0.000001387; 7136173, 0.000001387; 7136183, 0.000001387; 7136193, 0.000001387; 7136203, 0.000001387; 7136213, 0.000001387; 7136223, 0.000001387; 7136233, 0.000001387; 7136243, 0.000001387; 7136253, 0.000001387; 7136263, 0.000001387; 7136273, 0.000001387; 7136283, 0.000001387; 7136293, 0.000001387; 7136303, 0.000001387; 7136313, 0.000001387; 7136323, 0.000001387; 7136333, 0.000001387; 7136343, 0.000001387; 7136353, 0.000001387; 7136363, 0.000001387; 7136373, 0.000001387; 7136383, 0.000001387; 7136393, 0.000001387; 7136403, 0.000001387; 7136413, 0.000001387; 7136423, 0.000001387; 7136433, 0.000001387; 7136443, 0.000001387; 7136453, 0.000001387; 7136463, 0.000001387; 7136473, 0.000001387; 7136483, 0.000001387; 7136493, 0.000001387; 7136503, 0.000001387; 7136513, 0.000001387; 7136523, 0.000001387; 7136533, 0.000001387; 7136543, 0.000001387; 7136553, 0.000001387; 7136563, 0.000001387; 7136573, 0.000001387; 7136583, 0.000001387; 7136593, 0.000001387; 7136603, 0.000001387; 7136613, 0.000001388; 7136623, 0.000001388; 7136633, 0.000001388; 7136643, 0.000001388; 7136653, 0.000001388; 7136663, 0.000001388; 7136673, 0.000001388; 7136683, 0.000001388; 7136693, 0.000001388; 7136703, 0.000001388; 7136713, 0.000001388; 7136723, 0.000001388; 7136733, 0.000001388; 7136743, 0.000001388; 7136753, 0.000001388; 7136763, 0.000001388; 7136773, 0.000001388; 7136783, 0.000001388; 7136793, 0.000001388; 7136803, 0.000001388; 7136813, 0.000001388; 7136823, 0.000001388; 7136833, 0.000001388; 7136843, 0.000001388; 7136853, 0.000001388; 7136863, 0.000001388; 7136873, 0.000001388; 7136883, 0.000001388; 7136893, 0.000001388; 7136903, 0.000001388; 7136913, 0.000001388; 7136923, 0.000001388; 7136933, 0.000001388; 7136943, 0.000001388; 7136953, 0.000001388; 7136963, 0.000001388; 7136973, 0.000001388; 7136983, 0.000001388; 7136993, 0.000001388; 7137003, 0.000001388; 7137013, 0.000001388; 7137023, 0.000001388; 7137033, 0.000001388; 7137043, 0.000001388; 7137053, 0.000001388; 7137063, 0.000001388; 7137073, 0.000001388; 7137083, 0.000001388; 7137093, 0.000001388; 7137103, 0.000001388; 7137113, 0.000001388; 7137123, 0.000001388; 7137133, 0.000001388; 7137143, 0.000001388; 7137153, 0.000001388; 7137163, 0.000001388; 7137173, 0.000001387; 7137183, 0.000001387; 7137193, 0.000001387; 7137203, 0.000001387; 7137213, 0.000001386; 7137223, 0.000001386; 7137233, 0.000001386; 7137243, 0.000001386; 7137253, 0.000001385; 7137263, 0.000001385; 7137273, 0.000001385; 7137283, 0.000001385; 7137293, 0.000001385; 7137303, 0.000001385; 7137313, 0.000001384; 7137323, 0.000001384; 7137333, 0.000001384; 7137343, 0.000001384; 7137353, 0.000001384; 7137363, 0.000001384; 7137373, 0.000001384; 7137383, 0.000001384; 7137393, 0.000001384; 7137403, 0.000001384; 7137413, 0.000001384; 7137423, 0.000001384; 7137433, 0.000001384; 7137443, 0.000001384; 7137453, 0.000001384; 7137463, 0.000001384; 7137473, 0.000001384; 7137483, 0.000001384; 7137493, 0.000001384; 7137503, 0.000001384; 7137513, 0.000001384; 7137523, 0.000001384; 7137533, 0.000001384; 7137543, 0.000001384; 7137553, 0.000001384; 7137563, 0.000001384; 7137573, 0.000001384; 7137583, 0.000001383; 7137593, 0.000001383; 7137603, 0.000001383; 7137613, 0.000001383; 7137623, 0.000001383; 7137633, 0.000001383; 7137643, 0.000001383; 7137653, 0.000001383; 7137663, 0.000001383; 7137673, 0.000001383; 7137683, 0.000001383; 7137693, 0.000001382; 7137703, 0.000001382; 7137713, 0.000001382; 7137723, 0.000001382; 7137733, 0.000001382; 7137743, 0.000001382; 7137753, 0.000001382; 7137763, 0.000001382; 7137773, 0.000001383; 7137783, 0.000001383; 7137793, 0.000001383; 7137803, 0.000001383; 7137813, 0.000001383; 7137823, 0.000001383; 7137833, 0.000001383; 7137843, 0.000001383; 7137853, 0.000001383; 7137863, 0.000001383; 7137873, 0.000001383; 7137883, 0.000001383; 7137893, 0.000001383; 7137903, 0.000001383; 7137913, 0.000001383; 7137923, 0.000001383; 7137933, 0.000001383; 7137943, 0.000001383; 7137953, 0.000001383; 7137963, 0.000001383; 7137973, 0.000001382; 7137983, 0.000001382; 7137993, 0.000001382; 7138003, 0.000001382; 7138013, 0.000001382; 7138023, 0.000001382; 7138033, 0.000001382; 7138043, 0.000001382; 7138053, 0.000001382; 7138063, 0.000001382; 7138073, 0.000001382; 7138083, 0.000001382; 7138093, 0.000001382; 7138103, 0.000001382; 7138113, 0.000001382; 7138123, 0.000001382; 7138133, 0.000001382; 7138143, 0.000001382; 7138153, 0.000001382; 7138163, 0.000001382; 7138173, 0.000001382; 7138183, 0.000001382; 7138193, 0.000001382; 7138203, 0.000001382; 7138213, 0.000001382; 7138223, 0.000001382; 7138233, 0.000001382; 7138243, 0.000001382; 7138253, 0.000001382; 7138263, 0.000001382; 7138273, 0.000001382; 7138283, 0.000001382; 7138293, 0.000001382; 7138303, 0.000001382; 7138313, 0.000001382; 7138323, 0.000001382; 7138333, 0.000001382; 7138343, 0.000001382; 7138353, 0.000001382; 7138363, 0.000001382; 7138373, 0.000001382; 7138383, 0.000001382; 7138393, 0.000001382; 7138403, 0.000001382; 7138413, 0.000001382; 7138423, 0.000001382; 7138433, 0.000001382; 7138443, 0.000001382; 7138453, 0.000001382; 7138463, 0.000001382; 7138473, 0.000001382; 7138483, 0.000001381; 7138493, 0.000001381; 7138503, 0.000001381; 7138513, 0.000001381; 7138523, 0.000001381; 7138533, 0.000001381; 7138543, 0.000001381; 7138553, 0.000001381; 7138563, 0.000001381; 7138573, 0.000001381; 7138583, 0.000001381; 7138593, 0.000001381; 7138603, 0.000001381; 7138613, 0.000001381; 7138623, 0.000001381; 7138633, 0.000001381; 7138643, 0.000001381; 7138653, 0.000001381; 7138663, 0.000001381; 7138673, 0.000001381; 7138683, 0.000001381; 7138693, 0.000001381; 7138703, 0.000001381; 7138713, 0.000001381; 7138723, 0.000001381; 7138733, 0.000001381; 7138743, 0.000001381; 7138753, 0.000001381; 7138763, 0.000001381; 7138773, 0.000001381; 7138783, 0.000001381; 7138793, 0.000001381; 7138803, 0.000001381; 7138813, 0.000001381; 7138823, 0.000001381; 7138833, 0.000001381; 7138843, 0.000001381; 7138853, 0.000001381; 7138863, 0.000001381; 7138873, 0.000001381; 7138883, 0.000001381; 7138893, 0.000001381; 7138903, 0.000001381; 7138913, 0.000001381; 7138923, 0.000001381; 7138933, 0.000001381; 7138943, 0.000001381; 7138953, 0.000001381; 7138963, 0.000001381; 7138973, 0.000001380; 7138983, 0.000001380; 7138993, 0.000001380; 7139003, 0.000001380; 7139013, 0.000001380; 7139023, 0.000001380; 7139033, 0.000001380; 7139043, 0.000001380; 7139053, 0.000001380; 7139063, 0.000001380; 7139073, 0.000001380; 7139083, 0.000001380; 7139093, 0.000001380; 7139103, 0.000001380; 7139113, 0.000001380; 7139123, 0.000001380; 7139133, 0.000001380; 7139143, 0.000001380; 7139153, 0.000001381; 7139163, 0.000001381; 7139173, 0.000001381; 7139183, 0.000001381; 7139193, 0.000001381; 7139203, 0.000001381; 7139213, 0.000001381; 7139223, 0.000001381; 7139233, 0.000001381; 7139243, 0.000001381; 7139253, 0.000001381; 7139263, 0.000001381; 7139273, 0.000001381; 7139283, 0.000001381; 7139293, 0.000001381; 7139303, 0.000001381; 7139313, 0.000001381; 7139323, 0.000001381; 7139333, 0.000001381; 7139343, 0.000001381; 7139353, 0.000001381; 7139363, 0.000001381; 7139373, 0.000001381; 7139383, 0.000001381; 7139393, 0.000001381; 7139403, 0.000001381; 7139413, 0.000001381; 7139423, 0.000001381; 7139433, 0.000001381; 7139443, 0.000001381; 7139453, 0.000001381; 7139463, 0.000001381; 7139473, 0.000001380; 7139483, 0.000001380; 7139493, 0.000001380; 7139503, 0.000001380; 7139513, 0.000001380; 7139523, 0.000001380; 7139533, 0.000001380; 7139543, 0.000001380; 7139553, 0.000001380; 7139563, 0.000001380; 7139573, 0.000001380; 7139583, 0.000001380; 7139593, 0.000001380; 7139603, 0.000001380; 7139613, 0.000001380; 7139623, 0.000001380; 7139633, 0.000001380; 7139643, 0.000001380; 7139653, 0.000001380; 7139663, 0.000001380; 7139673, 0.000001380; 7139683, 0.000001380; 7139693, 0.000001380; 7139703, 0.000001380; 7139713, 0.000001380; 7139723, 0.000001380; 7139733, 0.000001380; 7139743, 0.000001380; 7139753, 0.000001380; 7139763, 0.000001380; 7139773, 0.000001380; 7139783, 0.000001380; 7139793, 0.000001380; 7139803, 0.000001380; 7139813, 0.000001380; 7139823, 0.000001380; 7139833, 0.000001380; 7139843, 0.000001380; 7139853, 0.000001380; 7139863, 0.000001380; 7139873, 0.000001380; 7139883, 0.000001380; 7139893, 0.000001380; 7139903, 0.000001380; 7139913, 0.000001380; 7139923, 0.000001380; 7139933, 0.000001380; 7139943, 0.000001380; 7139953, 0.000001380; 7139963, 0.000001380; 7139973, 0.000001380; 7139983, 0.000001380; 7139993, 0.000001380; 7140003, 0.000001380; 7140013, 0.000001380; 7140023, 0.000001380; 7140033, 0.000001380; 7140043, 0.000001380; 7140053, 0.000001380; 7140063, 0.000001380; 7140073, 0.000001380; 7140083, 0.000001380; 7140093, 0.000001380; 7140103, 0.000001380; 7140113, 0.000001380; 7140123, 0.000001380; 7140133, 0.000001380; 7140143, 0.000001380; 7140153, 0.000001380; 7140163, 0.000001380; 7140173, 0.000001380; 7140183, 0.000001380; 7140193, 0.000001380; 7140203, 0.000001380; 7140213, 0.000001380; 7140223, 0.000001380; 7140233, 0.000001380; 7140243, 0.000001380; 7140253, 0.000001380; 7140263, 0.000001380; 7140273, 0.000001380; 7140283, 0.000001380; 7140293, 0.000001380; 7140303, 0.000001380; 7140313, 0.000001380; 7140323, 0.000001380; 7140333, 0.000001380; 7140343, 0.000001380; 7140353, 0.000001380; 7140363, 0.000001380; 7140373, 0.000001380; 7140383, 0.000001380; 7140393, 0.000001380; 7140403, 0.000001380; 7140413, 0.000001380; 7140423, 0.000001380; 7140433, 0.000001380; 7140443, 0.000001380; 7140453, 0.000001380; 7140463, 0.000001380; 7140473, 0.000001380; 7140483, 0.000001380; 7140493, 0.000001380; 7140503, 0.000001380; 7140513, 0.000001380; 7140523, 0.000001380; 7140533, 0.000001380; 7140543, 0.000001380; 7140553, 0.000001380; 7140563, 0.000001380; 7140573, 0.000001380; 7140583, 0.000001380; 7140593, 0.000001380; 7140603, 0.000001380; 7140613, 0.000001380; 7140623, 0.000001380; 7140633, 0.000001380; 7140643, 0.000001380; 7140653, 0.000001380; 7140663, 0.000001379; 7140673, 0.000001379; 7140683, 0.000001379; 7140693, 0.000001379; 7140703, 0.000001379; 7140713, 0.000001379; 7140723, 0.000001379; 7140733, 0.000001379; 7140743, 0.000001379; 7140753, 0.000001379; 7140763, 0.000001379; 7140773, 0.000001379; 7140783, 0.000001379; 7140793, 0.000001379; 7140803, 0.000001379; 7140813, 0.000001379; 7140823, 0.000001379; 7140833, 0.000001379; 7140843, 0.000001379; 7140853, 0.000001379; 7140863, 0.000001379; 7140873, 0.000001379; 7140883, 0.000001379; 7140893, 0.000001379; 7140903, 0.000001379; 7140913, 0.000001379; 7140923, 0.000001380; 7140933, 0.000001380; 7140943, 0.000001380; 7140953, 0.000001380; 7140963, 0.000001380; 7140973, 0.000001380; 7140983, 0.000001380; 7140993, 0.000001380; 7141003, 0.000001380; 7141013, 0.000001380; 7141023, 0.000001380; 7141033, 0.000001380; 7141043, 0.000001380; 7141053, 0.000001380; 7141063, 0.000001380; 7141073, 0.000001380; 7141083, 0.000001380; 7141093, 0.000001381; 7141103, 0.000001381; 7141113, 0.000001381; 7141123, 0.000001381; 7141133, 0.000001382; 7141143, 0.000001382; 7141153, 0.000001382; 7141163, 0.000001383; 7141173, 0.000001383; 7141183, 0.000001383; 7141193, 0.000001383; 7141203, 0.000001384; 7141213, 0.000001384; 7141223, 0.000001384; 7141233, 0.000001384; 7141243, 0.000001384; 7141253, 0.000001384; 7141263, 0.000001384; 7141273, 0.000001384; 7141283, 0.000001385; 7141293, 0.000001385; 7141303, 0.000001385; 7141313, 0.000001385; 7141323, 0.000001385; 7141333, 0.000001385; 7141343, 0.000001385; 7141353, 0.000001385; 7141363, 0.000001386; 7141373, 0.000001387; 7141383, 0.000001388; 7141393, 0.000001388; 7141403, 0.000001388; 7141413, 0.000001389; 7141423, 0.000001389; 7141433, 0.000001390; 7141443, 0.000001390; 7141453, 0.000001390; 7141463, 0.000001391; 7141473, 0.000001391; 7141483, 0.000001391; 7141493, 0.000001392; 7141503, 0.000001392; 7141513, 0.000001392; 7141523, 0.000001392; 7141533, 0.000001393; 7141543, 0.000001393; 7141553, 0.000001393; 7141563, 0.000001394; 7141573, 0.000001394; 31557186, 0.000000000]);
                              Modelica.Blocks.Sources.CombiTimeTable DNI_measured(extrapolation = Modelica.Blocks.Types.Extrapolation.HoldLastPoint, smoothness = Modelica.Blocks.Types.Smoothness.ConstantSegments, columns = {2}, table = [0, 0; 7136983, 1; 7136993, 1; 7137003, 1; 7137013, 1; 7137023, 181; 7137033, 202; 7137043, 660; 7137053, 663; 7137063, 663; 7137073, 664; 7137083, 665; 7137093, 664; 7137103, 664; 7137113, 665; 7137123, 666; 7137133, 666; 7137143, 666; 7137153, 666; 7137163, 666; 7137173, 666; 7137183, 666; 7137193, 666; 7137203, 666; 7137213, 667; 7137223, 666; 7137233, 667; 7137243, 666; 7137253, 666; 7137263, 666; 7137273, 666; 7137283, 666; 7137293, 666; 7137303, 666; 7137313, 665; 7137323, 664; 7137333, 665; 7137343, 664; 7137353, 663; 7137363, 662; 7137373, 663; 7137383, 663; 7137393, 662; 7137403, 664; 7137413, 664; 7137423, 664; 7137433, 665; 7137443, 663; 7137453, 664; 7137463, 666; 7137473, 669; 7137483, 669; 7137493, 669; 7137503, 668; 7137513, 668; 7137523, 668; 7137533, 669; 7137543, 668; 7137553, 669; 7137563, 669; 7137573, 668; 7137583, 668; 7137593, 668; 7137603, 669; 7137613, 670; 7137623, 669; 7137633, 669; 7137643, 669; 7137653, 669; 7137663, 668; 7137673, 668; 7137683, 667; 7137693, 667; 7137703, 666; 7137713, 666; 7137723, 665; 7137733, 667; 7137743, 666; 7137753, 667; 7137763, 667; 7137773, 668; 7137783, 668; 7137793, 668; 7137803, 668; 7137813, 667; 7137823, 667; 7137833, 665; 7137843, 666; 7137853, 667; 7137863, 667; 7137873, 666; 7137883, 667; 7137893, 669; 7137903, 669; 7137913, 669; 7137923, 668; 7137933, 667; 7137943, 668; 7137953, 670; 7137963, 673; 7137973, 674; 7137983, 674; 7137993, 674; 7138003, 673; 7138013, 673; 7138023, 673; 7138033, 672; 7138043, 672; 7138053, 673; 7138063, 674; 7138073, 674; 7138083, 674; 7138093, 674; 7138103, 675; 7138113, 675; 7138123, 674; 7138133, 674; 7138143, 674; 7138153, 674; 7138163, 673; 7138173, 672; 7138183, 672; 7138193, 671; 7138203, 671; 7138213, 671; 7138223, 672; 7138233, 671; 7138243, 671; 7138253, 671; 7138263, 670; 7138273, 672; 7138283, 670; 7138293, 670; 7138303, 670; 7138313, 669; 7138323, 670; 7138333, 669; 7138343, 670; 7138353, 670; 7138363, 670; 7138373, 670; 7138383, 669; 7138393, 669; 7138403, 670; 7138413, 669; 7138423, 669; 7138433, 669; 7138443, 670; 7138453, 670; 7138463, 670; 7138473, 670; 7138483, 670; 7138493, 669; 7138503, 669; 7138513, 668; 7138523, 667; 7138533, 667; 7138543, 666; 7138553, 666; 7138563, 665; 7138573, 664; 7138583, 664; 7138593, 664; 7138603, 663; 7138613, 663; 7138623, 663; 7138633, 663; 7138643, 664; 7138653, 664; 7138663, 664; 7138673, 665; 7138683, 664; 7138693, 665; 7138703, 666; 7138713, 667; 7138723, 669; 7138733, 671; 7138743, 671; 7138753, 671; 7138763, 673; 7138773, 673; 7138783, 674; 7138793, 674; 7138803, 675; 7138813, 675; 7138823, 675; 7138833, 675; 7138843, 675; 7138853, 676; 7138863, 677; 7138873, 676; 7138883, 676; 7138893, 677; 7138903, 677; 7138913, 675; 7138923, 676; 7138933, 676; 7138943, 675; 7138953, 674; 7138963, 673; 7138973, 674; 7138983, 674; 7138993, 673; 7139003, 674; 7139013, 674; 7139023, 672; 7139033, 672; 7139043, 672; 7139053, 671; 7139063, 670; 7139073, 671; 7139083, 671; 7139093, 670; 7139103, 670; 7139113, 669; 7139123, 670; 7139133, 670; 7139143, 670; 7139153, 669; 7139163, 669; 7139173, 670; 7139183, 669; 7139193, 670; 7139203, 670; 7139213, 670; 7139223, 670; 7139233, 669; 7139243, 669; 7139253, 670; 7139263, 669; 7139273, 670; 7139283, 670; 7139293, 672; 7139303, 673; 7139313, 675; 7139323, 673; 7139333, 674; 7139343, 675; 7139353, 675; 7139363, 675; 7139373, 676; 7139383, 676; 7139393, 678; 7139403, 678; 7139413, 677; 7139423, 676; 7139433, 677; 7139443, 676; 7139453, 676; 7139463, 677; 7139473, 676; 7139483, 677; 7139493, 676; 7139503, 677; 7139513, 677; 7139523, 677; 7139533, 678; 7139543, 678; 7139553, 678; 7139563, 680; 7139573, 681; 7139583, 682; 7139593, 682; 7139603, 683; 7139613, 683; 7139623, 683; 7139633, 683; 7139643, 682; 7139653, 683; 7139663, 681; 7139673, 681; 7139683, 680; 7139693, 681; 7139703, 681; 7139713, 682; 7139723, 681; 7139733, 680; 7139743, 681; 7139753, 680; 7139763, 679; 7139773, 679; 7139783, 679; 7139793, 678; 7139803, 678; 7139813, 678; 7139823, 676; 7139833, 677; 7139843, 676; 7139853, 676; 7139863, 674; 7139873, 674; 7139883, 674; 7139893, 673; 7139903, 673; 7139913, 673; 7139923, 673; 7139933, 673; 7139943, 672; 7139953, 670; 7139963, 671; 7139973, 672; 7139983, 672; 7139993, 671; 7140003, 670; 7140013, 670; 7140023, 670; 7140033, 669; 7140043, 668; 7140053, 670; 7140063, 670; 7140073, 671; 7140083, 671; 7140093, 673; 7140103, 674; 7140113, 674; 7140123, 674; 7140133, 674; 7140143, 673; 7140153, 673; 7140163, 673; 7140173, 673; 7140183, 672; 7140193, 672; 7140203, 673; 7140213, 673; 7140223, 673; 7140233, 673; 7140243, 673; 7140253, 673; 7140263, 671; 7140273, 672; 7140283, 671; 7140293, 671; 7140303, 671; 7140313, 671; 7140323, 671; 7140333, 671; 7140343, 671; 7140353, 670; 7140363, 671; 7140373, 671; 7140383, 669; 7140393, 670; 7140403, 671; 7140413, 670; 7140423, 671; 7140433, 670; 7140443, 671; 7140453, 671; 7140463, 671; 7140473, 670; 7140483, 670; 7140493, 670; 7140503, 670; 7140513, 670; 7140523, 670; 7140533, 670; 7140543, 669; 7140553, 669; 7140563, 670; 7140573, 671; 7140583, 671; 7140593, 671; 7140603, 672; 7140613, 672; 7140623, 673; 7140633, 673; 7140643, 673; 7140653, 673; 7140663, 673; 7140673, 673; 7140683, 673; 7140693, 674; 7140703, 675; 7140713, 675; 7140723, 675; 7140733, 675; 7140743, 675; 7140753, 676; 7140763, 675; 7140773, 676; 7140783, 675; 7140793, 676; 7140803, 675; 7140813, 676; 7140823, 675; 7140833, 675; 7140843, 675; 7140853, 674; 7140863, 673; 7140873, 673; 7140883, 672; 7140893, 671; 7140903, 671; 7140913, 671; 7140923, 669; 7140933, 670; 7140943, 669; 7140953, 668; 7140963, 667; 7140973, 668; 7140983, 668; 7140993, 667; 7141003, 667; 7141013, 666; 7141023, 665; 7141033, 665; 7141043, 655; 7141053, 625; 7141063, 590; 7141073, 549; 7141083, 503; 7141093, 453; 7141103, 400; 7141113, 346; 7141123, 292; 7141133, 225; 7141143, 175; 7141153, 127; 7141163, 85; 7141173, 49; 7141183, 20; 7141193, 4; 7141203, 2; 7141213, 2; 7141223, 2; 7141233, 2; 7141243, 2; 7141253, 2; 7141263, 2; 7141273, 2; 7141283, 1; 7141293, 1; 7141303, 1; 7141313, 1; 7141323, 1; 7141333, 1; 7141343, 1; 7141353, 1; 7141363, 1; 7141373, 1; 7141383, 1; 7141393, 1; 7141403, 1; 7141413, 1; 7141423, 1; 7141433, 1; 7141443, 1; 7141453, 1; 7141463, 1; 7141473, 1; 7141483, 1; 7141493, 1; 7141503, 1; 7141513, 1; 7141523, 1; 7141533, 1; 7141543, 1; 7141553, 1; 7141563, 1; 7141573, 1; 31557186, 0]);
                              annotation(Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2})), Diagram(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2})), experiment(StartTime = 7.137e+06, StopTime = 7.1412e+06, Tolerance = 1e-06, Interval = 60)); */
  end measured_data;

  model Shading_Twelve "reduce DNI by factor according to shading"
    extends ICSolar.ShadingLUT0;
    Modelica.Blocks.Interfaces.RealOutput DNI_out "DNI after shading factor multiplication" annotation(Placement(visible = true, transformation(origin = {100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {100, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    Modelica.Blocks.Math.Product product1 "Multiplication of DNI and shading factor" annotation(Placement(visible = true, transformation(origin = {20, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    parameter Modelica.Blocks.Interfaces.IntegerInput ShadingTable annotation(Placement(visible = true, transformation(origin = {-100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    //for picking different shading matrices:
    //  final parameter String ShadingName = String(ShadingTable);
    //  Modelica.Blocks.Tables.CombiTable2D Shading_matrix(tableOnFile = true, smoothness = Modelica.Blocks.Types.Smoothness.LinearSegments, fileName = "modelica://ICSolar/ShadingTable2014.txt", tableName = "ShadingTable2014") annotation(Placement(visible = true, transformation(origin = {-40, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    Modelica.Blocks.Interfaces.RealInput arrayPitch "pitch (up/down) angle of 2axis tracking array (rads)" annotation(Placement(visible = true, transformation(origin = {-100, -20}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 0}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    Modelica.Blocks.Interfaces.RealInput arrayYaw "yaw (left/right) angle of tracking array (in radians)" annotation(Placement(visible = true, transformation(origin = {-100, -60}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 40}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    Modelica.Blocks.Interfaces.RealInput DNI_in "DNI in before shading factor multiplication" annotation(Placement(visible = true, transformation(origin = {-100, 80}, extent = {{-10, -10}, {10, 10}}, rotation = 0), iconTransformation(origin = {-100, 80}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
  equation
    product1.u2 = if Shading_matrix.y < 0 then 0 else Shading_matrix.y;
    connect(product1.y, DNI_out) "DNI after multiplication connected to output of model" annotation(Line(points = {{31, 40}, {58.5909, 40}, {58.5909, 19.7775}, {100, 19.7775}, {100, 20}}));
    connect(DNI_in, product1.u1) "Model input DNI connecting to product" annotation(Line(points = {{-100, 80}, {-36.3412, 80}, {-36.3412, 45.9827}, {8, 45.9827}, {8, 46}}));
    connect(arrayYaw, Shading_matrix.u2);
    connect(arrayPitch, Shading_matrix.u1);
    annotation(Diagram(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2})), Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2}), graphics = {Text(origin = {-4.59, 2.51}, extent = {{-72.63, 35.36}, {72.63, -35.36}}, textString = "Self Shading"), Rectangle(origin = {0, 0}, extent = {{-100, 100}, {100, -100}})}));
  end Shading_Twelve;

  model ShadingLUT0
    Modelica.Blocks.Tables.CombiTable2D Shading_matrix(smoothness = Modelica.Blocks.Types.Smoothness.LinearSegments, table = [0, -3.1415926, -1.04719, -0.959927, -0.872667, -0.785397, -0.698127, -0.610867, -0.523597, -0.436327, -0.349067, -0.261797, -0.174837, -0.0872673, 0, 0.0872673, 0.174837, 0.261797, 0.349067, 0.436327, 0.523597, 0.610867, 0.698127, 0.785397, 0.872667, 0.959927, 1.04719, 3.1415926; -0.872665, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0; -0.785398, 0, 0, 0.515733288, 0.582273933, 0.644111335, 0.700774874, 0.751833306, 0.796898047, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.796898047, 0.751833306, 0.700774874, 0.644111335, 0.582273933, 0.515733288, 0, 0; -0.698132, 0, 0, 0.558719885, 0.630806722, 0.697798298, 0.759184768, 0.814498944, 0.86331985, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.86331985, 0.814498944, 0.759184768, 0.697798298, 0.630806722, 0.558719885, 0, 0; -0.610865, 0, 0, 0.597454286, 0.674538691, 0.746174596, 0.811816808, 0.870965752, 0.923171268, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.923171268, 0.870965752, 0.811816808, 0.746174596, 0.674538691, 0.597454286, 0, 0; -0.523599, 0, 0, 0.6316417, 0.713137013, 0.788872054, 0.858270433, 0.920803986, 0.975996795, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.975996795, 0.920803986, 0.858270433, 0.788872054, 0.713137013, 0.6316417, 0, 0; -0.436332, 0, 0, 0.639557866, 0.722074534, 0.798758738, 0.869026865, 0.932344131, 0.988228655, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.988228655, 0.932344131, 0.869026865, 0.798758738, 0.722074534, 0.639557866, 0, 0; -0.349066, 0, 0, 0.639557866, 0.722074534, 0.798758738, 0.869026865, 0.932344131, 0.988228655, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.988228655, 0.932344131, 0.869026865, 0.798758738, 0.722074534, 0.639557866, 0, 0; -0.261799, 0, 0, 0.639557866, 0.722074534, 0.798758738, 0.869026865, 0.932344131, 0.988228655, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.988228655, 0.932344131, 0.869026865, 0.798758738, 0.722074534, 0.639557866, 0, 0; -0.174533, 0, 0, 0.639557866, 0.722074534, 0.798758738, 0.869026865, 0.932344131, 0.988228655, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.988228655, 0.932344131, 0.869026865, 0.798758738, 0.722074534, 0.639557866, 0, 0; -0.087266, 0, 0, 0.639557866, 0.722074534, 0.798758738, 0.869026865, 0.932344131, 0.988228655, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.988228655, 0.932344131, 0.869026865, 0.798758738, 0.722074534, 0.639557866, 0, 0; 0, 0, 0, 0.639557866, 0.722074534, 0.798758738, 0.869026865, 0.932344131, 0.988228655, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.988228655, 0.932344131, 0.869026865, 0.798758738, 0.722074534, 0.639557866, 0, 0; 0.087266, 0, 0, 0.639557866, 0.722074534, 0.798758738, 0.869026865, 0.932344131, 0.988228655, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.988228655, 0.932344131, 0.869026865, 0.798758738, 0.722074534, 0.639557866, 0, 0; 0.174533, 0, 0, 0.639557866, 0.722074534, 0.798758738, 0.869026865, 0.932344131, 0.988228655, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.988228655, 0.932344131, 0.869026865, 0.798758738, 0.722074534, 0.639557866, 0, 0; 0.261799, 0, 0, 0.639557866, 0.722074534, 0.798758738, 0.869026865, 0.932344131, 0.988228655, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.988228655, 0.932344131, 0.869026865, 0.798758738, 0.722074534, 0.639557866, 0, 0; 0.349066, 0, 0, 0.639557866, 0.722074534, 0.798758738, 0.869026865, 0.932344131, 0.988228655, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.988228655, 0.932344131, 0.869026865, 0.798758738, 0.722074534, 0.639557866, 0, 0; 0.436332, 0, 0, 0.639557866, 0.722074534, 0.798758738, 0.869026865, 0.932344131, 0.988228655, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.988228655, 0.932344131, 0.869026865, 0.798758738, 0.722074534, 0.639557866, 0, 0; 0.523599, 0, 0, 0.6316417, 0.713137013, 0.788872054, 0.858270433, 0.920803986, 0.975996795, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.98762244, 0.975996795, 0.920803986, 0.858270433, 0.788872054, 0.713137013, 0.6316417, 0, 0; 0.610865, 0, 0, 0.597454286, 0.674538691, 0.746174596, 0.811816808, 0.870965752, 0.923171268, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.934167678, 0.923171268, 0.870965752, 0.811816808, 0.746174596, 0.674538691, 0.597454286, 0, 0; 0.698132, 0, 0, 0.558719885, 0.630806722, 0.697798298, 0.759184768, 0.814498944, 0.86331985, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.873603336, 0.86331985, 0.814498944, 0.759184768, 0.697798298, 0.630806722, 0.558719885, 0, 0; 0.785398, 0, 0, 0.515733288, 0.582273933, 0.644111335, 0.700774874, 0.751833306, 0.796898047, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.806390346, 0.796898047, 0.751833306, 0.700774874, 0.644111335, 0.582273933, 0.515733288, 0, 0; 0.872665, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]) annotation(Placement(visible = true, transformation(origin = {0, 20}, extent = {{-10, -10}, {10, 10}}, rotation = 0)));
    //(extrapolation = Modelica.Blocks.Types.Extrapolation.HoldLastPoint, smoothness = Modelica.Blocks.Types.Smoothness.ConstantSegments, columns = {2}, table = [0, 27
    annotation(Icon(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {2, 2})), Diagram(coordinateSystem(extent = {{-100, -100}, {100, 100}}, preserveAspectRatio = true, initialScale = 0.1, grid = {1, 1})));
  end ShadingLUT0;
  annotation(uses(Modelica(version = "3.2.1"), Buildings(version = "1.6")), experiment(StartTime = 7.137e6, StopTime = 7.1412e6, Tolerance = 1e-06, Interval = 60));
end ICSolar;